import{d as h,r as u,i as _,o as y,u as x,c,a as s,z as C,b as L,v as m,x as p,t as v,E as S,g as f}from"./index.standard-DHpxIVC0.js";import{u as k}from"./useAuth-wzWGH3hv.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"login-container"},V={class:"login-wrapper"},B={class:"form-item"},D=["disabled"],z={class:"form-item"},E=["disabled"],F={key:0,class:"error-message"},N=["loading","disabled"],R=h({__name:"index",setup(U){const n=k(),d=x(),w=S(),a=u({username:"",password:""}),t=u(!1),o=u(""),g=_(()=>a.value.username.trim()&&a.value.password.trim()&&!t.value),b=()=>a.value.username.trim()?a.value.password.trim()?a.value.password.length<6?(o.value="密码长度不能少于6位",!1):!0:(o.value="请输入密码",!1):(o.value="请输入用户名",!1),i=async()=>{var l;if(b()){t.value=!0,o.value="";try{const e=await n.loginAdmin(a.value);if(e.success){console.log("✅ 管理员登录成功:",(l=e.user)==null?void 0:l.name);const r=w.query.redirect||"/admin/dashboard";typeof window<"u"&&window.location?d.push(r):uni.reLaunch({url:r.replace("/admin","/pages/admin")})}else o.value=e.error||"登录失败"}catch(e){console.error("Login error:",e),o.value="网络错误，请稍后重试"}finally{t.value=!1}}};return y(async()=>{await n.initializeAuth(),n.isAdmin&&(console.log("✅ 已登录用户访问登录页，自动重定向"),typeof window<"u"&&window.location?d.push("/admin/dashboard"):uni.reLaunch({url:"/pages/admin/dashboard/index"}))}),(l,e)=>(f(),c("view",M,[s("view",V,[e[4]||(e[4]=s("view",{class:"login-header"},[s("image",{class:"logo",src:"/static/logo.png",mode:"aspectFit"}),s("text",{class:"title"},"耶氏台球报价系统"),s("text",{class:"subtitle"},"管理员登录")],-1)),s("form",{class:"login-form",onSubmit:C(i,["prevent"])},[s("view",B,[e[2]||(e[2]=s("view",{class:"form-label"},"用户名",-1)),m(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.username=r),class:"form-input",type:"text",placeholder:"请输入用户名",disabled:t.value,onConfirm:i},null,40,D),[[p,a.value.username]])]),s("view",z,[e[3]||(e[3]=s("view",{class:"form-label"},"密码",-1)),m(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.password=r),class:"form-input",type:"password",placeholder:"请输入密码",disabled:t.value,onConfirm:i},null,40,E),[[p,a.value.password]])]),o.value?(f(),c("view",F,v(o.value),1)):L("",!0),s("button",{class:"login-button",type:"primary",loading:t.value,disabled:!g.value,onClick:i},v(t.value?"登录中...":"登 录"),9,N)],32),e[5]||(e[5]=s("view",{class:"login-footer"},[s("text",{class:"copyright"},"© 2024 耶氏台球斗南销售中心")],-1))])]))}}),T=A(R,[["__scopeId","data-v-546e02ec"]]);export{T as default};
