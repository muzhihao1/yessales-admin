import{a as B,S as m}from"./SalesButton-Bck0Vs7e.js";import{d as I,r as _,o as V,c as l,j as u,b as n,a as t,t as a,k as p,e as y,n as z,F as A,f as L,p as d,g as i}from"./index.standard-DHpxIVC0.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={class:"quote-preview"},E={key:0,class:"loading-container"},O={key:1,class:"error-container"},j={class:"error-text"},U={key:2,class:"quote-document"},H={class:"document-header"},W={class:"header-row"},X={class:"company-section"},Y={class:"quote-info"},G={class:"quote-number"},J={class:"quote-meta"},K={class:"meta-item"},R={class:"meta-item"},Z={class:"info-section"},tt={class:"info-card"},et={class:"info-content"},st={class:"info-row"},at={class:"info-value"},ot={class:"info-row"},lt={class:"info-value"},it={key:0,class:"info-row"},nt={class:"info-value"},rt={key:1,class:"info-row"},ct={class:"info-value"},ut={key:2,class:"info-row"},dt={class:"info-value"},vt={class:"info-row"},mt={class:"info-value"},_t={key:3,class:"info-row"},pt={class:"info-value"},wt={class:"products-section"},xt={class:"products-table"},yt={class:"table-cell product-name"},ft={class:"cell-title"},gt={class:"table-cell product-model"},bt={class:"cell-content"},ht={key:0,class:"cell-sku"},kt={class:"table-cell product-quantity"},qt={class:"cell-content"},Ct={class:"table-cell product-price"},Tt={class:"cell-content"},Dt={class:"table-cell product-total"},St={class:"cell-total"},Ft={class:"summary-section"},Nt={class:"summary-card"},Mt={class:"summary-rows"},Pt={class:"summary-row"},Bt={class:"summary-value"},It={key:0,class:"summary-row discount-row"},Vt={class:"summary-label"},zt={class:"discount-detail"},At={class:"summary-value discount-value"},Lt={class:"summary-row subtotal-row"},Qt={class:"summary-value"},$t={key:1,class:"summary-row"},Et={class:"summary-value"},Ot={key:2,class:"summary-row"},jt={class:"summary-value"},Ut={key:3,class:"summary-row"},Ht={class:"summary-value"},Wt={key:4,class:"summary-row"},Xt={class:"summary-label"},Yt={class:"summary-value"},Gt={class:"summary-row total-row"},Jt={class:"summary-value total-value"},Kt={class:"terms-section"},Rt={class:"terms-content"},Zt={class:"terms-row"},te={class:"terms-value"},ee={key:0,class:"terms-row"},se={class:"terms-value"},ae={key:1,class:"terms-row"},oe={class:"terms-value"},le={class:"standard-terms"},ie={class:"terms-text"},ne={key:3,class:"quote-actions"},re={class:"actions-row"},ce={class:"actions-row"},ue=I({__name:"preview",setup(de){const w=_(!0),x=_(!1),v=_(""),s=_(null),f=_("");V(()=>{const o=getCurrentPages(),c=o[o.length-1].options;c.id?(f.value=c.id,g()):v.value="缺少报价单ID参数"});const g=async()=>{try{w.value=!0,v.value="",await new Promise(o=>setTimeout(o,800)),s.value={id:f.value,status:"draft",createdAt:new Date().toISOString(),customer:{name:"张先生",phone:"13800138000",wechat:"zhangsan2024",email:"zhang@example.com",province:"云南省",city:"昆明市",address:"五华区东风西路123号",type:"individual",remark:"需要专业安装服务"},items:[{product_id:"1",product_name:"星牌台球桌",product_model:"XW116-9A",sku_name:"标准版",quantity:1,unit_price:15800,total_price:15800},{product_id:"2",product_name:"专业台球杆",product_model:"Master Pro",quantity:2,unit_price:850,total_price:1700}],pricing:{subtotal:17500,discount:{type:"percentage",value:5,amount:875},tax:{rate:13,amount:2161.25,included:!1},additionalCharges:{deliveryFee:300,installationFee:500,otherCharges:[],total:800},finalTotal:19586.25},quote:{quoteNumber:`YS-${new Date().toISOString().slice(0,10).replace(/-/g,"")}-0001`,validityDays:30,paymentTerms:"immediate",specialTerms:"需要提前预约安装时间",notes:"所有产品均为全新正品，提供质保服务"}}}catch(o){console.error("Failed to load quote data:",o),v.value="加载报价单失败，请重试"}finally{w.value=!1}},b=()=>{if(!s.value)return"";const o=new Date(s.value.createdAt);return o.setDate(o.getDate()+s.value.quote.validityDays),o.toLocaleDateString("zh-CN")},h=()=>s.value?s.value.pricing.additionalCharges.otherCharges.reduce((o,e)=>e.type==="percentage"?o+s.value.pricing.subtotal*e.amount/100:o+e.amount,0):0,k=o=>new Date(o).toLocaleDateString("zh-CN"),r=o=>o.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","),q=o=>({draft:"草稿",sent:"已发送",approved:"已确认",rejected:"已拒绝"})[o]||"未知状态",C=o=>({individual:"个人客户",company:"企业客户",dealer:"经销商",club:"俱乐部"})[o]||"未知类型",T=o=>({immediate:"立即付款","30days":"30天账期","60days":"60天账期",cod:"货到付款"})[o]||"其他",D=()=>{uni.navigateBack()},S=()=>{window.print(),uni.showToast({title:"请使用浏览器打开进行打印",icon:"none"})},F=async()=>{try{x.value=!0,await new Promise(o=>setTimeout(o,1e3)),uni.showToast({title:"报价单保存成功",icon:"success"}),setTimeout(()=>{uni.navigateTo({url:"/pages/sales/history/index"})},1500)}catch{uni.showToast({title:"保存失败，请重试",icon:"none"})}finally{x.value=!1}},N=()=>{uni.showActionSheet({itemList:["微信发送","邮件发送","短信发送","复制链接"],success:o=>{const e=["微信","邮件","短信","链接"];uni.showToast({title:`通过${e[o.tapIndex]}发送`,icon:"success"})}})},M=()=>{console.warn("Company logo failed to load")};return(o,e)=>(i(),l("view",$,[u(B,{title:"报价单预览","show-back":!0,fixed:!0}),w.value?(i(),l("view",E,e[0]||(e[0]=[t("view",{class:"loading-spinner"},null,-1),t("text",{class:"loading-text"},"加载报价单...",-1)]))):v.value?(i(),l("view",O,[t("text",j,a(v.value),1),u(m,{onClick:g},{default:p(()=>e[1]||(e[1]=[d("重试",-1)])),_:1,__:[1]})])):s.value?(i(),l("view",U,[t("view",H,[t("view",W,[t("view",X,[t("image",{class:"company-logo",src:"/static/logo.png",mode:"aspectFit",onError:M},null,32),e[2]||(e[2]=y('<view class="company-info" data-v-9f95cb2d><text class="company-name" data-v-9f95cb2d>耶氏台球斗南销售中心</text><text class="company-subtitle" data-v-9f95cb2d>专业台球设备供应商</text><text class="company-contact" data-v-9f95cb2d>电话：400-888-8888</text><text class="company-address" data-v-9f95cb2d>地址：昆明市斗南花卉市场</text></view>',1))]),t("view",Y,[e[3]||(e[3]=t("text",{class:"quote-title"},"报价单",-1)),t("text",G,a(s.value.quote.quoteNumber),1),t("view",J,[t("text",K,"日期："+a(k(s.value.createdAt)),1),t("text",R,"有效期至："+a(b()),1),t("view",{class:z(["quote-status",`status-${s.value.status||"draft"}`])},a(q(s.value.status||"draft")),3)])])])]),t("view",Z,[t("view",tt,[e[11]||(e[11]=t("text",{class:"info-title"},"客户信息",-1)),t("view",et,[t("view",st,[e[4]||(e[4]=t("text",{class:"info-label"},"客户姓名",-1)),t("text",at,a(s.value.customer.name),1)]),t("view",ot,[e[5]||(e[5]=t("text",{class:"info-label"},"联系电话",-1)),t("text",lt,a(s.value.customer.phone),1)]),s.value.customer.wechat?(i(),l("view",it,[e[6]||(e[6]=t("text",{class:"info-label"},"微信号",-1)),t("text",nt,a(s.value.customer.wechat),1)])):n("",!0),s.value.customer.email?(i(),l("view",rt,[e[7]||(e[7]=t("text",{class:"info-label"},"邮箱",-1)),t("text",ct,a(s.value.customer.email),1)])):n("",!0),s.value.customer.address?(i(),l("view",ut,[e[8]||(e[8]=t("text",{class:"info-label"},"地址",-1)),t("text",dt,a(s.value.customer.province)+a(s.value.customer.city)+a(s.value.customer.address),1)])):n("",!0),t("view",vt,[e[9]||(e[9]=t("text",{class:"info-label"},"客户类型",-1)),t("text",mt,a(C(s.value.customer.type)),1)]),s.value.customer.remark?(i(),l("view",_t,[e[10]||(e[10]=t("text",{class:"info-label"},"备注",-1)),t("text",pt,a(s.value.customer.remark),1)])):n("",!0)])])]),t("view",wt,[e[13]||(e[13]=t("text",{class:"section-title"},"产品明细",-1)),t("view",xt,[e[12]||(e[12]=y('<view class="table-header" data-v-9f95cb2d><text class="header-cell product-name" data-v-9f95cb2d>产品名称</text><text class="header-cell product-model" data-v-9f95cb2d>型号规格</text><text class="header-cell product-quantity" data-v-9f95cb2d>数量</text><text class="header-cell product-price" data-v-9f95cb2d>单价</text><text class="header-cell product-total" data-v-9f95cb2d>小计</text></view>',1)),(i(!0),l(A,null,L(s.value.items,(c,P)=>(i(),l("view",{key:P,class:"table-row"},[t("view",yt,[t("text",ft,a(c.product_name),1)]),t("view",gt,[t("text",bt,a(c.product_model),1),c.sku_name?(i(),l("text",ht,a(c.sku_name),1)):n("",!0)]),t("view",kt,[t("text",qt,a(c.quantity),1)]),t("view",Ct,[t("text",Tt,"¥"+a(r(c.unit_price)),1)]),t("view",Dt,[t("text",St,"¥"+a(r(c.total_price)),1)])]))),128))])]),t("view",Ft,[t("view",Nt,[e[21]||(e[21]=t("text",{class:"summary-title"},"价格汇总",-1)),t("view",Mt,[t("view",Pt,[e[14]||(e[14]=t("text",{class:"summary-label"},"产品小计",-1)),t("text",Bt,"¥"+a(r(s.value.pricing.subtotal)),1)]),s.value.pricing.discount.amount>0?(i(),l("view",It,[t("text",Vt,[e[15]||(e[15]=d(" 折扣优惠 ",-1)),t("text",zt," ("+a(s.value.pricing.discount.type==="percentage"?`${s.value.pricing.discount.value}%`:`¥${r(s.value.pricing.discount.value)}`)+") ",1)]),t("text",At,"-¥"+a(r(s.value.pricing.discount.amount)),1)])):n("",!0),t("view",Lt,[e[16]||(e[16]=t("text",{class:"summary-label"},"折扣后小计",-1)),t("text",Qt,"¥"+a(r(s.value.pricing.subtotal-s.value.pricing.discount.amount)),1)]),s.value.pricing.additionalCharges.deliveryFee>0?(i(),l("view",$t,[e[17]||(e[17]=t("text",{class:"summary-label"},"配送费",-1)),t("text",Et,"+¥"+a(r(s.value.pricing.additionalCharges.deliveryFee)),1)])):n("",!0),s.value.pricing.additionalCharges.installationFee>0?(i(),l("view",Ot,[e[18]||(e[18]=t("text",{class:"summary-label"},"安装费",-1)),t("text",jt,"+¥"+a(r(s.value.pricing.additionalCharges.installationFee)),1)])):n("",!0),s.value.pricing.additionalCharges.otherCharges.length>0?(i(),l("view",Ut,[e[19]||(e[19]=t("text",{class:"summary-label"},"其他费用",-1)),t("text",Ht,"+¥"+a(r(h())),1)])):n("",!0),s.value.pricing.tax.amount>0?(i(),l("view",Wt,[t("text",Xt,"税费 ("+a(s.value.pricing.tax.rate)+"%)",1),t("text",Yt,"+¥"+a(r(s.value.pricing.tax.amount)),1)])):n("",!0),t("view",Gt,[e[20]||(e[20]=t("text",{class:"summary-label"},"合计金额",-1)),t("text",Jt,"¥"+a(r(s.value.pricing.finalTotal)),1)])])])]),t("view",Kt,[e[29]||(e[29]=t("text",{class:"section-title"},"付款条件与说明",-1)),t("view",Rt,[t("view",Zt,[e[22]||(e[22]=t("text",{class:"terms-label"},"付款条件：",-1)),t("text",te,a(T(s.value.quote.paymentTerms)),1)]),s.value.quote.specialTerms?(i(),l("view",ee,[e[23]||(e[23]=t("text",{class:"terms-label"},"特殊条款：",-1)),t("text",se,a(s.value.quote.specialTerms),1)])):n("",!0),s.value.quote.notes?(i(),l("view",ae,[e[24]||(e[24]=t("text",{class:"terms-label"},"备注说明：",-1)),t("text",oe,a(s.value.quote.notes),1)])):n("",!0),t("view",le,[e[25]||(e[25]=t("text",{class:"terms-title"},"标准条款：",-1)),t("text",ie,"1. 本报价单有效期为 "+a(s.value.quote.validityDays)+" 天。",1),e[26]||(e[26]=t("text",{class:"terms-text"},"2. 产品价格以报价单确认时为准，如有变动以书面通知为准。",-1)),e[27]||(e[27]=t("text",{class:"terms-text"},"3. 配送及安装服务需提前预约，具体时间双方协商确定。",-1)),e[28]||(e[28]=t("text",{class:"terms-text"},"4. 产品质量保证按照国家相关标准执行。",-1))])])]),e[30]||(e[30]=y('<view class="document-footer" data-v-9f95cb2d><view class="signature-section" data-v-9f95cb2d><view class="signature-block" data-v-9f95cb2d><text class="signature-label" data-v-9f95cb2d>销售代表：</text><view class="signature-line" data-v-9f95cb2d></view><text class="signature-date" data-v-9f95cb2d>日期：________________</text></view><view class="signature-block" data-v-9f95cb2d><text class="signature-label" data-v-9f95cb2d>客户确认：</text><view class="signature-line" data-v-9f95cb2d></view><text class="signature-date" data-v-9f95cb2d>日期：________________</text></view></view><view class="footer-info" data-v-9f95cb2d><text class="footer-text" data-v-9f95cb2d>感谢您选择耶氏台球设备，我们将为您提供最优质的产品和服务！</text></view></view>',1))])):n("",!0),s.value&&!w.value?(i(),l("view",ne,[t("view",re,[u(m,{type:"default",onClick:D},{default:p(()=>e[31]||(e[31]=[d(" 编辑报价 ",-1)])),_:1,__:[31]}),u(m,{type:"plain",onClick:S},{default:p(()=>e[32]||(e[32]=[d(" 打印报价 ",-1)])),_:1,__:[32]}),u(m,{type:"primary",onClick:F,loading:x.value},{default:p(()=>e[33]||(e[33]=[d(" 保存报价 ",-1)])),_:1,__:[33]},8,["loading"])]),t("view",ce,[u(m,{type:"success",block:!0,onClick:N},{default:p(()=>e[34]||(e[34]=[d(" 发送给客户 ",-1)])),_:1,__:[34]})])])):n("",!0)]))}}),pe=Q(ue,[["__scopeId","data-v-9f95cb2d"]]);export{pe as default};
