import{H as g,u as p,r as n,i as c,w as h}from"./index.standard-DHpxIVC0.js";const q=g("auth",()=>{const m=p(),s=n(localStorage.getItem("admin_token")),t=n(null),o=n(!1),a=n(null),u=c(()=>!!s.value&&!!t.value),v=c(()=>!u.value),f=e=>{var r,d;return((d=(r=t.value)==null?void 0:r.permissions)==null?void 0:d.includes(e))||!1};h(s,e=>{e?localStorage.setItem("admin_token",e):(localStorage.removeItem("admin_token"),t.value=null)});const w=async e=>{o.value=!0,a.value=null;try{if(e.username==="admin"&&e.password==="admin123"){const r={id:"admin-001",username:"admin",name:"系统管理员",role:"admin",permissions:["dashboard:read","quotes:read","quotes:write","quotes:delete","products:read","products:write","products:delete","customers:read","customers:write","users:read","users:write","logs:read","settings:read","settings:write"]};return s.value="mock-admin-token-"+Date.now(),t.value=r,{success:!0,user:r}}else throw new Error("用户名或密码错误")}catch(r){return a.value=r instanceof Error?r.message:"登录失败",{success:!1,error:a.value}}finally{o.value=!1}},i=()=>{s.value=null,t.value=null,a.value=null,m.push("/admin/login")},l=async()=>{if(!s.value)return!1;try{return s.value.startsWith("mock-admin-token-")?(t.value={id:"admin-001",username:"admin",name:"系统管理员",role:"admin",permissions:["dashboard:read","quotes:read","quotes:write","quotes:delete","products:read","products:write","products:delete","customers:read","customers:write","users:read","users:write","logs:read","settings:read","settings:write"]},!0):!1}catch(e){return console.error("Token validation failed:",e),i(),!1}};return{adminToken:s,adminUser:t,isLoading:o,error:a,isAdmin:u,isSales:v,hasPermission:f,loginAdmin:w,logoutAdmin:i,validateAdminToken:l,initializeAuth:async()=>{s.value&&await l()}}});export{q as u};
