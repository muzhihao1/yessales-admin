import{S,a as Pe}from"./SalesButton-Bck0Vs7e.js";import{S as K,a as ye}from"./SalesSelector-Ckk41PFW.js";import{d as ie,c as r,b as p,a as e,n as Y,t as o,g as a,h as re,r as T,i as $,o as we,w as xe,j as _,k as y,F as se,f as oe,l as ae,m as te,p as V,q as Ve,s as Fe,v as he,x as be,y as ke,z as Te,A as Ce,B as $e,C as ge,Q as Se,D as Ne}from"./index.standard-DHpxIVC0.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const qe={class:"sales-form-item"},Ie=["value","placeholder","maxlength","disabled","auto-height"],De={key:1,class:"sales-textarea-count"},Me={key:2,class:"sales-form-error"},ze={key:3,class:"sales-form-help"},Ue=ie({__name:"SalesTextarea",props:{modelValue:{default:""},label:{},placeholder:{},required:{type:Boolean,default:!1},maxlength:{default:500},disabled:{type:Boolean,default:!1},error:{},help:{},autoHeight:{type:Boolean,default:!0},showCount:{type:Boolean,default:!0}},emits:["update:modelValue","blur","focus"],setup(ee,{emit:k}){const c=k,U=v=>{const w=v.target;c("update:modelValue",w.value)},s=v=>{c("blur",v)},P=v=>{c("focus",v)};return(v,w)=>(a(),r("view",qe,[v.label?(a(),r("label",{key:0,class:Y(["sales-form-label",{required:v.required}])},o(v.label),3)):p("",!0),e("textarea",{class:Y(["sales-input sales-input-textarea",{"sales-input-error":!!v.error,"sales-input-disabled":v.disabled}]),value:v.modelValue,placeholder:v.placeholder,maxlength:v.maxlength,disabled:v.disabled,"auto-height":v.autoHeight,onInput:U,onBlur:s,onFocus:P},null,42,Ie),v.showCount&&v.maxlength?(a(),r("view",De,o(v.modelValue.length)+"/"+o(v.maxlength),1)):p("",!0),v.error?(a(),r("view",Me,o(v.error),1)):p("",!0),v.help&&!v.error?(a(),r("view",ze,o(v.help),1)):p("",!0)]))}}),Ae=ne(Ue,[["__scopeId","data-v-1ab187c2"]]),Ee={class:"step-customer"},Be={class:"customer-card"},Oe={class:"form-group"},Re={key:0,class:"success-icon"},We={key:0,class:"success-icon"},Qe={key:0,class:"format-hint"},je={class:"form-group"},Le={class:"customer-types"},He=["onClick"],Je={class:"type-icon"},Ke={class:"type-name"},Ye={key:0,class:"type-discount"},Ze={class:"customer-card"},Ge={class:"form-group"},Xe={class:"customer-card"},et={class:"collapse-icon"},tt={key:0,class:"address-content"},st={class:"location-row"},ot={class:"quick-actions"},lt={key:0,class:"checkbox-check"},at={class:"step-actions"},it=ie({__name:"StepCustomer",props:{form:{},errors:{}},emits:["update:form","next","validate"],setup(ee,{emit:k}){const c=ee,U=k,s=re({customerName:c.form.customerName||"",customerPhone:c.form.customerPhone||"",customerWechat:c.form.customerWechat||"",customerEmail:c.form.customerEmail||"",customerProvince:c.form.customerProvince||"",customerCity:c.form.customerCity||"",customerAddress:c.form.customerAddress||"",customerType:c.form.customerType||"individual",customerRemark:c.form.customerRemark||"",saveCustomer:c.form.saveCustomer||!0}),P=T(!1),v=T(!1),w=[{value:"individual",label:"个人客户",icon:"👤",discount:0,description:"个人购买"},{value:"company",label:"企业客户",icon:"🏢",discount:5,description:"企业采购"},{value:"dealer",label:"经销商",icon:"🤝",discount:10,description:"批发合作"},{value:"club",label:"俱乐部",icon:"🎯",discount:8,description:"场馆采购"}],I=T([{label:"云南省",value:"yunnan"},{label:"四川省",value:"sichuan"},{label:"贵州省",value:"guizhou"}]),E=T([]),F={yunnan:[{label:"昆明市",value:"kunming"},{label:"大理州",value:"dali"},{label:"丽江市",value:"lijiang"}],sichuan:[{label:"成都市",value:"chengdu"},{label:"绵阳市",value:"mianyang"}],guizhou:[{label:"贵阳市",value:"guiyang"},{label:"遵义市",value:"zunyi"}]},M=$(()=>/^1[3-9]\d{9}$/.test(s.customerPhone)),Q=$(()=>s.customerName.trim().length>=2&&M.value&&!c.errors.customerName&&!c.errors.customerPhone),b=t=>{var h;const u=typeof t=="string"?t:((h=t.target)==null?void 0:h.value)||"";s.customerName=u.trim(),u.trim()&&(c.errors.customerName=""),g()},z=t=>{var le;const h=(typeof t=="string"?t:((le=t.target)==null?void 0:le.value)||"").replace(/\D/g,"");s.customerPhone=h,h&&(c.errors.customerPhone=""),g()},q=()=>{const t=s.customerName.trim();return t?t.length<2?(c.errors.customerName="姓名至少2个字符",!1):t.length>20?(c.errors.customerName="姓名不能超过20个字符",!1):/^[\u4e00-\u9fa5a-zA-Z\s]+$/.test(t)?(c.errors.customerName="",!0):(c.errors.customerName="姓名只能包含中文、英文和空格",!1):(c.errors.customerName="请输入客户姓名",!1)},D=()=>s.customerPhone.trim()?M.value?(c.errors.customerPhone="",!0):(c.errors.customerPhone="请输入正确的11位手机号码",!1):(c.errors.customerPhone="请输入手机号码",!1),B=()=>{const t=s.customerWechat.trim();return t&&t.length<6?(c.errors.customerWechat="微信号至少6位",!1):(c.errors.customerWechat="",!0)},R=()=>{const t=s.customerEmail.trim();return t&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?(c.errors.customerEmail="请输入正确的邮箱格式",!1):(c.errors.customerEmail="",!0)},j=t=>{s.customerType=t,g();const u=w.find(h=>h.value===t);(u==null?void 0:u.discount)>0&&ae.success(`已选择${u.label}，享${u.discount}%优惠`,2e3)},L=t=>t.length===11?t.replace(/(\d{3})(\d{4})(\d{4})/,"$1 $2 $3"):t,J=()=>{const t=s.customerWechat.trim();/^1[3-9]\d{9}$/.test(t)?(s.customerPhone=t,D(),g(),ae.success("已同步到手机号")):ae.show("微信号格式不是手机号","none")},Z=t=>{s.customerProvince=t,s.customerCity="",E.value=F[t]||[],g()},G=t=>{s.customerCity=t,g()},H=()=>{v.value=!0,Ve.getCurrentPosition().then(t=>{setTimeout(()=>{s.customerAddress="昆明市五华区东风西路123号",v.value=!1,g(),ae.success("定位成功")},1e3)}).catch(()=>{v.value=!1,Fe.confirm({title:"定位失败",content:"无法获取位置信息，请手动输入"})})},f=()=>{s.saveCustomer=!s.saveCustomer,g()},g=()=>{const t={...s};console.log("Emitting form update:",t),U("update:form",t)},i=()=>{q()&&D()&&B()&&R()&&U("next")};return we(()=>{g()}),xe(()=>c.form,t=>{Object.assign(s,t)},{deep:!0}),(t,u)=>(a(),r("view",Ee,[u[22]||(u[22]=e("view",{class:"step-header"},[e("text",{class:"step-title"},"客户信息"),e("text",{class:"step-subtitle"},"请填写客户的基本信息，带 * 为必填项")],-1)),e("view",Be,[u[11]||(u[11]=e("view",{class:"card-title"},[e("text",{class:"title-icon"},"👤"),e("text",{class:"title-text"},"基本信息")],-1)),e("view",Oe,[_(K,{modelValue:s.customerName,"onUpdate:modelValue":u[0]||(u[0]=h=>s.customerName=h),label:"客户姓名 *",placeholder:"请输入真实姓名",required:!0,error:t.errors.customerName,onInput:b,onBlur:q},{suffix:y(()=>[s.customerName&&!t.errors.customerName?(a(),r("view",Re," ✓ ")):p("",!0)]),_:1},8,["modelValue","error"]),_(K,{modelValue:s.customerPhone,"onUpdate:modelValue":u[1]||(u[1]=h=>s.customerPhone=h),label:"联系电话 *",placeholder:"请输入11位手机号码",type:"tel",maxlength:11,required:!0,error:t.errors.customerPhone,onInput:z,onBlur:D},{suffix:y(()=>[M.value&&!t.errors.customerPhone?(a(),r("view",We," ✓ ")):p("",!0)]),help:y(()=>[s.customerPhone&&!t.errors.customerPhone?(a(),r("text",Qe,o(L(s.customerPhone)),1)):p("",!0)]),_:1},8,["modelValue","error"])]),e("view",je,[u[9]||(u[9]=e("text",{class:"group-label"},"客户类型",-1)),u[10]||(u[10]=e("text",{class:"group-hint"},"选择合适的客户类型，享受对应优惠",-1)),e("view",Le,[(a(),r(se,null,oe(w,h=>e("view",{key:h.value,class:Y(["type-card",{"type-card--selected":s.customerType===h.value}]),onClick:le=>j(h.value)},[e("text",Je,o(h.icon),1),e("text",Ke,o(h.label),1),h.discount?(a(),r("text",Ye,o(h.discount)+"% 优惠 ",1)):p("",!0)],10,He)),64))])])]),e("view",Ze,[u[15]||(u[15]=e("view",{class:"card-title"},[e("text",{class:"title-icon"},"📞"),e("text",{class:"title-text"},"联系方式"),e("text",{class:"optional-badge"},"选填")],-1)),e("view",Ge,[_(K,{modelValue:s.customerWechat,"onUpdate:modelValue":u[2]||(u[2]=h=>s.customerWechat=h),label:"微信号",placeholder:"微信号/手机号均可",error:t.errors.customerWechat,onBlur:B},{prefix:y(()=>u[12]||(u[12]=[e("text",{class:"input-icon"},"💬",-1)])),suffix:y(()=>[s.customerWechat&&!s.customerPhone?(a(),te(S,{key:0,size:"mini",type:"plain",onClick:J},{default:y(()=>u[13]||(u[13]=[V(" 同步 ",-1)])),_:1,__:[13]})):p("",!0)]),_:1},8,["modelValue","error"]),_(K,{modelValue:s.customerEmail,"onUpdate:modelValue":u[3]||(u[3]=h=>s.customerEmail=h),label:"邮箱地址",placeholder:"用于发送报价单",type:"email",error:t.errors.customerEmail,onBlur:R},{prefix:y(()=>u[14]||(u[14]=[e("text",{class:"input-icon"},"📧",-1)])),_:1},8,["modelValue","error"])])]),e("view",Xe,[e("view",{class:"card-title",onClick:u[4]||(u[4]=h=>P.value=!P.value)},[u[16]||(u[16]=e("text",{class:"title-icon"},"📍",-1)),u[17]||(u[17]=e("text",{class:"title-text"},"地址信息",-1)),u[18]||(u[18]=e("text",{class:"optional-badge"},"选填",-1)),e("text",et,o(P.value?"▲":"▼"),1)]),P.value?(a(),r("view",tt,[e("view",st,[_(ye,{modelValue:s.customerProvince,"onUpdate:modelValue":u[5]||(u[5]=h=>s.customerProvince=h),label:"省份",placeholder:"选择省份",options:I.value,onChange:Z,class:"location-select"},null,8,["modelValue","options"]),_(ye,{modelValue:s.customerCity,"onUpdate:modelValue":u[6]||(u[6]=h=>s.customerCity=h),label:"城市",placeholder:"选择城市",options:E.value,disabled:!s.customerProvince,onChange:G,class:"location-select"},null,8,["modelValue","options","disabled"])]),_(K,{modelValue:s.customerAddress,"onUpdate:modelValue":u[7]||(u[7]=h=>s.customerAddress=h),label:"详细地址",placeholder:"街道、门牌号、小区楼栋等",maxlength:100,error:t.errors.customerAddress},{suffix:y(()=>[_(S,{size:"mini",type:"plain",onClick:H,loading:v.value},{default:y(()=>u[19]||(u[19]=[V(" 定位 ",-1)])),_:1,__:[19]},8,["loading"])]),_:1},8,["modelValue","error"]),_(Ae,{modelValue:s.customerRemark,"onUpdate:modelValue":u[8]||(u[8]=h=>s.customerRemark=h),label:"备注信息",placeholder:"特殊要求、偏好等",maxlength:200,"show-count":!0,"auto-height":!0},null,8,["modelValue"])])):p("",!0)]),e("view",ot,[e("view",{class:"save-option",onClick:f},[e("view",{class:Y(["checkbox",{"checkbox--checked":s.saveCustomer}])},[s.saveCustomer?(a(),r("text",lt,"✓")):p("",!0)],2),u[20]||(u[20]=e("text",{class:"option-text"},"保存客户信息，便于下次使用",-1))])]),e("view",at,[_(S,{type:"primary",block:!0,onClick:i,disabled:!Q.value},{default:y(()=>u[21]||(u[21]=[V(" 下一步：选择产品 ",-1)])),_:1,__:[21]},8,["disabled"])])]))}}),nt=ne(it,[["__scopeId","data-v-cbec750a"]]),rt={class:"step-products"},ut={class:"step-header"},ct={class:"step-subtitle"},dt={key:0},mt={class:"search-filter-bar"},vt={class:"search-box"},pt={class:"chips-container"},ft=["onClick"],gt={class:"chip-icon"},_t={class:"chip-name"},yt={key:0,class:"selected-summary"},wt={class:"summary-title"},xt={class:"summary-total"},ht={class:"expand-icon"},bt={key:0,class:"selected-list"},kt=["src"],$t={class:"item-info"},Ct={class:"item-name"},Pt={class:"item-spec"},Vt={key:0},Ft={class:"item-price"},Tt={class:"item-actions"},St={class:"item-subtotal"},Nt={class:"products-container"},qt={key:0,class:"loading-state"},It={key:1,class:"empty-state"},Dt={class:"empty-subtitle"},Mt={key:2,class:"product-grid"},zt=["onClick"],Ut={class:"card-image-wrapper"},At=["src"],Et={key:0,class:"selection-badge"},Bt={class:"badge-text"},Ot=["onClick"],Rt={class:"price-tag"},Wt={class:"price-text"},Qt={class:"card-info"},jt={class:"product-name"},Lt={class:"product-model"},Ht={class:"product-meta"},Jt={class:"product-unit"},Kt={key:0,class:"product-stock"},Yt={key:3,class:"load-more"},Zt={class:"step-actions"},Gt={key:0,class:"action-count"},Xt={key:0,class:"sku-modal"},es={class:"sku-product"},ts=["src"],ss={class:"sku-info"},os={class:"sku-name"},ls={class:"sku-model"},as={class:"sku-base-price"},is={key:0,class:"sku-options"},ns={class:"option-grid"},rs=["onClick"],us={class:"option-name"},cs={key:0,class:"option-price"},ds={class:"quantity-section"},ms={class:"quantity-controls"},vs={class:"price-preview"},ps={class:"preview-price"},fs={class:"sku-actions"},gs=ie({__name:"StepProducts",props:{selectedProducts:{},categories:{},maxSelection:{}},emits:["update:selectedProducts","next","back"],setup(ee,{emit:k}){const c=ee,U=k,s=T(""),P=T("all"),v=T(!1),w=T(!0),I=T(1),E=T(!1),F=T([...c.selectedProducts]),M=T([]),Q=T(),b=T(null),z=T(""),q=T(1),D=T(-1),B=d=>{const n=[],A={tables:["星牌台球桌","乔氏台球桌","亚林台球桌","康溪台球桌"],cues:["高端枫木球杆","专业碳纤维球杆","初学者套装球杆","定制雕花球杆"],balls:["亚美利加台球","比利时aramith球","国产优质台球","练习专用球"],accessories:["台球三角架","球杆架","台球刷","球杆皮头"],maintenance:["台呢清洁剂","球杆保养油","台球桌罩","专业维修工具"]};return(d==="all"?Object.keys(A):[d||"tables"]).forEach(m=>{var N;(N=A[m])==null||N.forEach((fe,ue)=>{n.push({id:`${m}-${ue}`,name:fe,model:`${m.toUpperCase()}-${Math.random().toString(36).substring(7)}`,price:Math.floor(Math.random()*5e3)+500,unit:m==="tables"?"张":m==="cues"?"支":"个",categoryId:m,stock:Math.floor(Math.random()*50)+10,image:`/static/images/products/${m}-${ue+1}.jpg`,skuOptions:Math.random()>.6?[{id:`${m}-${ue}-sku1`,name:"标准版",price:0},{id:`${m}-${ue}-sku2`,name:"豪华版",price:200},{id:`${m}-${ue}-sku3`,name:"定制版",price:500}]:void 0})})}),n},R=$(()=>{let d=M.value;if(P.value!=="all"&&(d=d.filter(n=>n.categoryId===P.value)),s.value){const n=s.value.toLowerCase();d=d.filter(A=>{var W;return A.name.toLowerCase().includes(n)||((W=A.model)==null?void 0:W.toLowerCase().includes(n))})}return d}),j=$(()=>F.value.reduce((d,n)=>d+n.subtotal,0)),L=$(()=>{var W,m;if(!b.value)return 0;const d=b.value.price,n=((m=(W=b.value.skuOptions)==null?void 0:W.find(N=>N.id===z.value))==null?void 0:m.price)||0;return(d+n)*q.value}),J=async()=>{if(v.value)return;v.value=!0,await new Promise(n=>setTimeout(n,500));const d=B(P.value);I.value===1?M.value=d:M.value=[...M.value,...d],w.value=I.value<3,v.value=!1},Z=()=>{clearTimeout(Z.timer),Z.timer=setTimeout(()=>{f()},300)},G=()=>{s.value="",f()},H=d=>{P.value=d,f()},f=()=>{I.value=1,M.value=[],J()},g=()=>{!v.value&&w.value&&(I.value++,J())},i=d=>F.value.some(n=>n.product.id===d),t=d=>c.maxSelection&&!i(d)&&F.value.length>=c.maxSelection,u=d=>{const n=F.value.find(A=>A.product.id===d);return(n==null?void 0:n.quantity)||0},h=d=>{var A;if(t(d.id)){uni.showToast({title:`最多选择${c.maxSelection}种产品`,icon:"none"});return}if((A=d.skuOptions)!=null&&A.length){le(d);return}const n={product:d,quantity:1,price:d.price,subtotal:d.price};F.value.push(n),l(),uni.showToast({title:"已添加到选择",icon:"success",duration:1e3})},le=d=>{var A,W,m;if(t(d.id)){uni.showToast({title:`最多选择${c.maxSelection}种产品`,icon:"none"});return}b.value=d;const n=F.value.findIndex(N=>N.product.id===d.id);if(n!==-1){D.value=n;const N=F.value[n];q.value=N.quantity,z.value=N.skuId||""}else D.value=-1,q.value=1,z.value=((W=(A=d.skuOptions)==null?void 0:A[0])==null?void 0:W.id)||"";(m=Q.value)==null||m.open()},de=d=>{z.value=d.id},ce=()=>{q.value++},me=()=>{q.value>1&&q.value--},O=()=>{(q.value<1||isNaN(q.value))&&(q.value=1)},ve=()=>{var W;if(!b.value)return;const d=(W=b.value.skuOptions)==null?void 0:W.find(m=>m.id===z.value),n=b.value.price+((d==null?void 0:d.price)||0),A={product:b.value,quantity:q.value,skuId:z.value||void 0,skuName:(d==null?void 0:d.name)||void 0,price:n,subtotal:n*q.value};D.value!==-1?F.value[D.value]=A:F.value.push(A),l(),x(),uni.showToast({title:D.value!==-1?"已更新选择":"已添加到选择",icon:"success"})},pe=d=>{F.value.splice(d,1),l()},x=()=>{var d;(d=Q.value)==null||d.close(),b.value=null,D.value=-1},l=()=>{U("update:selectedProducts",[...F.value])},X=()=>{U("back")},C=()=>{if(F.value.length===0){uni.showToast({title:"请选择至少一个产品",icon:"none"});return}U("next")};return xe(()=>c.selectedProducts,d=>{F.value=[...d]},{deep:!0}),we(()=>{J()}),(d,n)=>{const A=ke("scroll-view"),W=ke("uni-popup");return a(),r("view",rt,[e("view",ut,[n[5]||(n[5]=e("text",{class:"step-title"},"选择产品",-1)),e("text",ct,[n[4]||(n[4]=V(" 浏览产品目录，点击产品卡片进行选择 ",-1)),d.maxSelection?(a(),r("text",dt," (最多"+o(d.maxSelection)+"种)",1)):p("",!0)])]),e("view",mt,[e("view",vt,[n[7]||(n[7]=e("text",{class:"search-icon"},"🔍",-1)),he(e("input",{"onUpdate:modelValue":n[0]||(n[0]=m=>s.value=m),class:"search-input",placeholder:"搜索产品名称、型号",onInput:Z},null,544),[[be,s.value]]),s.value?(a(),r("view",{key:0,class:"clear-search",onClick:G},n[6]||(n[6]=[e("text",null,"×",-1)]))):p("",!0)]),_(A,{class:"filter-chips","scroll-x":"","show-scrollbar":!1},{default:y(()=>[e("view",pt,[e("view",{class:Y(["filter-chip",{"filter-chip--active":P.value==="all"}]),onClick:n[1]||(n[1]=m=>H("all"))}," 全部 ",2),(a(!0),r(se,null,oe(d.categories,m=>(a(),r("view",{key:m.id,class:Y(["filter-chip",{"filter-chip--active":P.value===m.id}]),onClick:N=>H(m.id)},[e("text",gt,o(m.icon),1),e("text",_t,o(m.name),1)],10,ft))),128))])]),_:1})]),F.value.length>0?(a(),r("view",yt,[e("view",{class:"summary-header",onClick:n[2]||(n[2]=m=>E.value=!E.value)},[e("text",wt," 已选 "+o(F.value.length)+" 种产品 ",1),e("text",xt," 合计：¥"+o(j.value.toFixed(2)),1),e("text",ht,o(E.value?"▲":"▼"),1)]),E.value?(a(),r("view",bt,[(a(!0),r(se,null,oe(F.value,(m,N)=>(a(),r("view",{key:`${m.product.id}-${m.skuId}`,class:"selected-item"},[e("image",{class:"item-image",src:m.product.image||"/static/images/default-product.png",mode:"aspectFill"},null,8,kt),e("view",$t,[e("text",Ct,o(m.product.name),1),e("text",Pt,[V(o(m.product.model)+" ",1),m.skuName?(a(),r("text",Vt," - "+o(m.skuName),1)):p("",!0)]),e("text",Ft,"¥"+o(m.price)+" × "+o(m.quantity),1)]),e("view",Tt,[e("text",St,"¥"+o(m.subtotal.toFixed(2)),1),_(S,{size:"mini",type:"danger",onClick:fe=>pe(N)},{default:y(()=>n[8]||(n[8]=[V(" 移除 ",-1)])),_:2,__:[8]},1032,["onClick"])])]))),128))])):p("",!0)])):p("",!0),e("view",Nt,[v.value?(a(),r("view",qt,n[9]||(n[9]=[e("view",{class:"loading-spinner"},null,-1),e("text",{class:"loading-text"},"加载产品中...",-1)]))):R.value.length===0?(a(),r("view",It,[n[11]||(n[11]=e("text",{class:"empty-icon"},"📦",-1)),n[12]||(n[12]=e("text",{class:"empty-title"},"没有找到产品",-1)),e("text",Dt,o(s.value?"尝试其他搜索关键词":"该分类暂无产品"),1),s.value?(a(),te(S,{key:0,type:"plain",onClick:G,size:"small"},{default:y(()=>n[10]||(n[10]=[V(" 清除搜索条件 ",-1)])),_:1,__:[10]})):p("",!0)])):(a(),r("view",Mt,[(a(!0),r(se,null,oe(R.value,m=>(a(),r("view",{key:m.id,class:Y(["product-card",{"product-card--selected":i(m.id),"product-card--disabled":t(m.id)}]),onClick:N=>le(m)},[e("view",Ut,[e("image",{class:"card-image",src:m.image||"/static/images/default-product.png",mode:"aspectFill","lazy-load":""},null,8,At),i(m.id)?(a(),r("view",Et,[e("text",Bt,o(u(m.id)),1)])):(a(),r("view",{key:1,class:"quick-add-btn",onClick:Te(N=>h(m),["stop"])},n[13]||(n[13]=[e("text",{class:"add-icon"},"+",-1)]),8,Ot)),e("view",Rt,[e("text",Wt,"¥"+o(m.price),1)])]),e("view",Qt,[e("text",jt,o(m.name),1),e("text",Lt,o(m.model),1),e("view",Ht,[e("text",Jt,o(m.unit||"个"),1),m.stock?(a(),r("text",Kt," 库存: "+o(m.stock),1)):p("",!0)])])],10,zt))),128))])),w.value&&!v.value?(a(),r("view",Yt,[_(S,{type:"plain",onClick:g},{default:y(()=>n[14]||(n[14]=[V(" 加载更多产品 ",-1)])),_:1,__:[14]})])):p("",!0)]),e("view",Zt,[_(S,{type:"default",onClick:X},{default:y(()=>n[15]||(n[15]=[V(" 上一步 ",-1)])),_:1,__:[15]}),_(S,{type:"primary",onClick:C,disabled:F.value.length===0,class:"next-button"},{default:y(()=>[n[16]||(n[16]=V(" 下一步：价格配置 ",-1)),F.value.length>0?(a(),r("text",Gt," ("+o(F.value.length)+") ",1)):p("",!0)]),_:1,__:[16]},8,["disabled"])]),_(W,{ref_key:"skuModalRef",ref:Q,type:"bottom","mask-click":!1},{default:y(()=>{var m;return[b.value?(a(),r("view",Xt,[e("view",{class:"sku-header"},[n[18]||(n[18]=e("text",{class:"sku-title"},"选择规格",-1)),e("view",{class:"sku-close",onClick:x},n[17]||(n[17]=[e("text",null,"×",-1)]))]),e("view",es,[e("image",{class:"sku-image",src:b.value.image||"/static/images/default-product.png",mode:"aspectFill"},null,8,ts),e("view",ss,[e("text",os,o(b.value.name),1),e("text",ls,o(b.value.model),1),e("text",as,"基础价格：¥"+o(b.value.price),1)])]),(m=b.value.skuOptions)!=null&&m.length?(a(),r("view",is,[n[19]||(n[19]=e("text",{class:"option-label"},"规格选择",-1)),e("view",ns,[(a(!0),r(se,null,oe(b.value.skuOptions,N=>(a(),r("view",{key:N.id,class:Y(["option-item",{"option-item--selected":z.value===N.id}]),onClick:fe=>de(N)},[e("text",us,o(N.name),1),N.price?(a(),r("text",cs,o(N.price>0?"+":"")+"¥"+o(N.price),1)):p("",!0)],10,rs))),128))])])):p("",!0),e("view",ds,[n[22]||(n[22]=e("text",{class:"quantity-label"},"数量",-1)),e("view",ms,[_(S,{size:"small",type:"default",onClick:me,disabled:q.value<=1},{default:y(()=>n[20]||(n[20]=[V(" - ",-1)])),_:1,__:[20]},8,["disabled"]),he(e("input",{"onUpdate:modelValue":n[3]||(n[3]=N=>q.value=N),type:"number",class:"quantity-input",min:"1",onBlur:O},null,544),[[be,q.value,void 0,{number:!0}]]),_(S,{size:"small",type:"default",onClick:ce},{default:y(()=>n[21]||(n[21]=[V(" + ",-1)])),_:1,__:[21]})])]),e("view",vs,[n[23]||(n[23]=e("text",{class:"preview-label"},"小计：",-1)),e("text",ps,"¥"+o(L.value.toFixed(2)),1)]),e("view",fs,[_(S,{type:"default",onClick:x},{default:y(()=>n[24]||(n[24]=[V(" 取消 ",-1)])),_:1,__:[24]}),_(S,{type:"primary",onClick:ve},{default:y(()=>n[25]||(n[25]=[V(" 确认添加 ",-1)])),_:1,__:[25]})])])):p("",!0)]}),_:1},512)])}}}),_s=ne(gs,[["__scopeId","data-v-49612eb6"]]),ys={class:"step-pricing"},ws={class:"price-calculator"},xs={class:"calculator-header"},hs={class:"toggle-text"},bs={class:"toggle-icon"},ks={key:0,class:"calculator-content"},$s={class:"price-row"},Cs={class:"row-label"},Ps={class:"row-value"},Vs={key:0,class:"price-row discount-row"},Fs={class:"row-label"},Ts={class:"row-value discount-value"},Ss={key:1,class:"price-row discount-row"},Ns={class:"row-value discount-value"},qs={class:"price-row subtotal-row"},Is={class:"row-value"},Ds={key:2,class:"price-row"},Ms={class:"row-value"},zs={key:3,class:"price-row"},Us={class:"row-label"},As={class:"row-value"},Es={class:"price-row total-row"},Bs={class:"row-value total-value"},Os={class:"config-section"},Rs={class:"discount-type-selector"},Ws={class:"discount-input-section"},Qs={class:"input-unit"},js={key:0,class:"discount-preview"},Ls={class:"discount-presets"},Hs={class:"preset-buttons"},Js={class:"config-section"},Ks={class:"section-toggle"},Ys={key:0,class:"advanced-content"},Zs={class:"config-subsection"},Gs={class:"form-row"},Xs={key:0,class:"checkbox-check"},eo={class:"config-subsection"},to={class:"form-grid"},so={key:0,class:"other-charges"},oo={class:"charge-controls"},lo={class:"charge-type-toggle"},ao={class:"config-subsection"},io={class:"form-grid"},no={class:"validity-hint"},ro={class:"price-impact"},uo={class:"impact-chart"},co={class:"chart-bar"},mo={class:"bar-segment original",style:{width:"100%"}},vo={class:"segment-value"},po={class:"segment-value"},fo={class:"final-price"},go={class:"final-value"},_o={key:0,class:"savings-badge"},yo={class:"step-actions"},wo=ie({__name:"StepPricing",props:{config:{},selectedProducts:{},customerType:{}},emits:["update:config","update:validityDays","update:paymentTerms","next","back"],setup(ee,{emit:k}){const c=ee,U=k,s=re({...c.config}),P=T(!0),v=T(!1),w=T(""),I=T(30),E=T("immediate"),F=[{value:"immediate",label:"立即付款"},{value:"30days",label:"30天账期"},{value:"60days",label:"60天账期"},{value:"cod",label:"货到付款"}],M={individual:{discount:0,name:"个人客户"},company:{discount:.05,name:"企业客户"},dealer:{discount:.1,name:"经销商"},club:{discount:.08,name:"俱乐部"}},Q=$(()=>s.discountType==="percentage"?[{label:"5%",value:5},{label:"10%",value:10},{label:"15%",value:15},{label:"20%",value:20}]:[100,200,500,1e3].map(l=>({label:`¥${l}`,value:l}))),b=$(()=>c.selectedProducts.reduce((x,l)=>x+l.subtotal,0)),z=$(()=>{const x=M[c.customerType];return b.value*x.discount}),q=$(()=>M[c.customerType].name),D=$(()=>s.discountType==="percentage"?b.value*(s.discountValue/100):Math.min(s.discountValue,b.value)),B=$(()=>z.value+D.value),R=$(()=>Math.max(0,b.value-B.value)),j=$(()=>{var l;let x=s.deliveryFee+s.installationFee;return(l=s.otherCharges)==null||l.forEach(X=>{X.type==="percentage"?x+=R.value*(X.amount/100):x+=X.amount||0}),x}),L=$(()=>s.taxIncluded?0:(R.value+j.value)*(s.taxRate/100)),J=$(()=>R.value+j.value+L.value),Z=$(()=>s.discountType==="percentage"?"折扣比例":"折扣金额"),G=$(()=>s.discountType==="percentage"?"输入0-50":"输入折扣金额"),H=$(()=>s.discountType==="percentage"?"%":"¥"),f=$(()=>s.discountType==="percentage"?50:b.value),g=x=>{s.discountType=x,s.discountValue=0,w.value="",O()},i=x=>{s.discountValue=x||0,w.value="",O()},t=()=>{const x=s.discountValue;s.discountType==="percentage"?(x<0||x>50)&&(w.value="折扣比例应在0-50%之间",s.discountValue=Math.max(0,Math.min(50,x))):(x>b.value&&(w.value="折扣金额不能超过小计",s.discountValue=b.value),x<0&&(s.discountValue=0)),O()},u=x=>{s.discountValue=x.value,w.value="",O(),uni.showToast({title:`已应用${x.label}折扣`,icon:"success",duration:1e3})},h=()=>{s.taxIncluded=!s.taxIncluded,O()},le=()=>{s.otherCharges||(s.otherCharges=[]),s.otherCharges.push({id:Date.now().toString(),name:"",amount:0,type:"fixed"}),O()},de=x=>{var l;(l=s.otherCharges)==null||l.splice(x,1),O()},ce=(x,l)=>{var X;(X=s.otherCharges)!=null&&X[x]&&(s.otherCharges[x].type=l,O())},me=()=>{const x=new Date;return x.setDate(x.getDate()+I.value),x.toLocaleDateString("zh-CN")},O=()=>{U("update:config",{...s})},ve=()=>{U("back")},pe=()=>{t(),w.value||U("next")};return xe(()=>c.config,x=>{Object.assign(s,x)},{deep:!0}),(x,l)=>{var X;return a(),r("view",ys,[l[39]||(l[39]=e("view",{class:"step-header"},[e("text",{class:"step-title"},"价格配置"),e("text",{class:"step-subtitle"},"设置折扣、税费和附加服务，实时查看价格变化")],-1)),e("view",ws,[e("view",xs,[l[12]||(l[12]=e("text",{class:"calc-title"},"💰 价格明细",-1)),e("view",{class:"calc-toggle",onClick:l[0]||(l[0]=C=>P.value=!P.value)},[e("text",hs,o(P.value?"收起":"展开"),1),e("text",bs,o(P.value?"▲":"▼"),1)])]),P.value?(a(),r("view",ks,[e("view",$s,[e("text",Cs,"产品小计 ("+o(x.selectedProducts.length)+"种)",1),e("text",Ps,"¥"+o(b.value.toFixed(2)),1)]),z.value>0?(a(),r("view",Vs,[e("text",Fs,o(q.value)+"优惠",1),e("text",Ts,"-¥"+o(z.value.toFixed(2)),1)])):p("",!0),D.value>0?(a(),r("view",Ss,[l[13]||(l[13]=e("text",{class:"row-label"},"额外折扣",-1)),e("text",Ns,"-¥"+o(D.value.toFixed(2)),1)])):p("",!0),e("view",qs,[l[14]||(l[14]=e("text",{class:"row-label"},"折扣后小计",-1)),e("text",Is,"¥"+o(R.value.toFixed(2)),1)]),j.value>0?(a(),r("view",Ds,[l[15]||(l[15]=e("text",{class:"row-label"},"附加费用",-1)),e("text",Ms,"+¥"+o(j.value.toFixed(2)),1)])):p("",!0),L.value>0?(a(),r("view",zs,[e("text",Us,"税费 ("+o(s.taxRate)+"%)",1),e("text",As,"+¥"+o(L.value.toFixed(2)),1)])):p("",!0),e("view",Es,[l[16]||(l[16]=e("text",{class:"row-label"},"合计金额",-1)),e("text",Bs,"¥"+o(J.value.toFixed(2)),1)])])):p("",!0)]),e("view",Os,[l[20]||(l[20]=e("view",{class:"section-header"},[e("text",{class:"section-icon"},"🎫"),e("text",{class:"section-title"},"折扣设置")],-1)),e("view",Rs,[e("view",{class:Y(["type-option",{"type-option--active":s.discountType==="percentage"}]),onClick:l[1]||(l[1]=C=>g("percentage"))},l[17]||(l[17]=[e("text",{class:"option-icon"},"%",-1),e("text",{class:"option-label"},"按比例",-1),e("text",{class:"option-hint"},"0-50%",-1)]),2),e("view",{class:Y(["type-option",{"type-option--active":s.discountType==="fixed"}]),onClick:l[2]||(l[2]=C=>g("fixed"))},l[18]||(l[18]=[e("text",{class:"option-icon"},"¥",-1),e("text",{class:"option-label"},"固定金额",-1),e("text",{class:"option-hint"},"具体金额",-1)]),2)]),e("view",Ws,[_(K,{modelValue:s.discountValue,"onUpdate:modelValue":l[3]||(l[3]=C=>s.discountValue=C),modelModifiers:{number:!0},label:Z.value,placeholder:G.value,type:"number",min:0,max:f.value,error:w.value,onInput:i,onBlur:t},{suffix:y(()=>[e("text",Qs,o(H.value),1)]),help:y(()=>[D.value>0?(a(),r("text",js," 节省 ¥"+o(D.value.toFixed(2)),1)):p("",!0)]),_:1},8,["modelValue","label","placeholder","max","error"]),e("view",Ls,[l[19]||(l[19]=e("text",{class:"presets-label"},"快速选择：",-1)),e("view",Hs,[(a(!0),r(se,null,oe(Q.value,C=>(a(),te(S,{key:C.value,size:"mini",type:"plain",onClick:d=>u(C)},{default:y(()=>[V(o(C.label),1)]),_:2},1032,["onClick"]))),128))])])])]),e("view",Js,[e("view",{class:"section-header",onClick:l[4]||(l[4]=C=>v.value=!v.value)},[l[21]||(l[21]=e("text",{class:"section-icon"},"⚙️",-1)),l[22]||(l[22]=e("text",{class:"section-title"},"高级设置",-1)),e("text",Ks,o(v.value?"▲":"▼"),1)]),v.value?(a(),r("view",Ys,[e("view",Zs,[l[24]||(l[24]=e("text",{class:"subsection-title"},"税费配置",-1)),e("view",Gs,[_(K,{modelValue:s.taxRate,"onUpdate:modelValue":l[5]||(l[5]=C=>s.taxRate=C),modelModifiers:{number:!0},label:"税率 (%)",placeholder:"13",type:"number",min:0,max:30,onInput:O},null,8,["modelValue"]),e("view",{class:"tax-included-option",onClick:h},[e("view",{class:Y(["checkbox",{"checkbox--checked":s.taxIncluded}])},[s.taxIncluded?(a(),r("text",Xs,"✓")):p("",!0)],2),l[23]||(l[23]=e("text",{class:"checkbox-label"},"含税价格",-1))])])]),e("view",eo,[l[31]||(l[31]=e("text",{class:"subsection-title"},"附加费用",-1)),e("view",to,[_(K,{modelValue:s.deliveryFee,"onUpdate:modelValue":l[6]||(l[6]=C=>s.deliveryFee=C),modelModifiers:{number:!0},label:"配送费 (¥)",placeholder:"0",type:"number",min:0,onInput:O},{prefix:y(()=>l[25]||(l[25]=[e("text",{class:"input-icon"},"🚚",-1)])),_:1},8,["modelValue"]),_(K,{modelValue:s.installationFee,"onUpdate:modelValue":l[7]||(l[7]=C=>s.installationFee=C),modelModifiers:{number:!0},label:"安装费 (¥)",placeholder:"0",type:"number",min:0,onInput:O},{prefix:y(()=>l[26]||(l[26]=[e("text",{class:"input-icon"},"🔧",-1)])),_:1},8,["modelValue"])]),(X=s.otherCharges)!=null&&X.length?(a(),r("view",so,[(a(!0),r(se,null,oe(s.otherCharges,(C,d)=>(a(),r("view",{key:C.id,class:"charge-item"},[_(K,{modelValue:C.name,"onUpdate:modelValue":n=>C.name=n,placeholder:"费用名称",onInput:O,class:"charge-name"},null,8,["modelValue","onUpdate:modelValue"]),e("view",oo,[e("view",lo,[_(S,{type:C.type==="fixed"?"primary":"default",size:"mini",onClick:n=>ce(d,"fixed")},{default:y(()=>l[27]||(l[27]=[V(" 固定 ",-1)])),_:2,__:[27]},1032,["type","onClick"]),_(S,{type:C.type==="percentage"?"primary":"default",size:"mini",onClick:n=>ce(d,"percentage")},{default:y(()=>l[28]||(l[28]=[V(" 比例 ",-1)])),_:2,__:[28]},1032,["type","onClick"])]),_(K,{modelValue:C.amount,"onUpdate:modelValue":n=>C.amount=n,modelModifiers:{number:!0},placeholder:C.type==="percentage"?"百分比":"金额",type:"number",min:0,onInput:O,class:"charge-amount"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),_(S,{size:"mini",type:"danger",onClick:n=>de(d)},{default:y(()=>l[29]||(l[29]=[V(" 删除 ",-1)])),_:2,__:[29]},1032,["onClick"])])]))),128))])):p("",!0),_(S,{type:"plain",size:"small",onClick:le},{default:y(()=>l[30]||(l[30]=[V(" + 添加其他费用 ",-1)])),_:1,__:[30]})]),e("view",ao,[l[32]||(l[32]=e("text",{class:"subsection-title"},"报价信息",-1)),e("view",io,[_(K,{modelValue:I.value,"onUpdate:modelValue":l[8]||(l[8]=C=>I.value=C),modelModifiers:{number:!0},label:"有效期 (天)",placeholder:"30",type:"number",min:1,max:365,onInput:l[9]||(l[9]=C=>x.$emit("update:validityDays",I.value))},{help:y(()=>[e("text",no," 有效至："+o(me()),1)]),_:1},8,["modelValue"]),_(ye,{modelValue:E.value,"onUpdate:modelValue":l[10]||(l[10]=C=>E.value=C),label:"付款条件",options:F,onChange:l[11]||(l[11]=C=>x.$emit("update:paymentTerms",E.value))},null,8,["modelValue"])])])])):p("",!0)]),e("view",ro,[l[36]||(l[36]=e("text",{class:"impact-title"},"价格影响分析",-1)),e("view",uo,[e("view",co,[e("view",mo,[l[33]||(l[33]=e("text",{class:"segment-label"},"原价",-1)),e("text",vo,"¥"+o(b.value.toFixed(2)),1)]),B.value>0?(a(),r("view",{key:0,class:"bar-segment discount",style:Ce({width:`${B.value/b.value*100}%`})},[l[34]||(l[34]=e("text",{class:"segment-label"},"优惠",-1)),e("text",po,"-¥"+o(B.value.toFixed(2)),1)],4)):p("",!0)]),e("view",fo,[l[35]||(l[35]=e("text",{class:"final-label"},"最终价格",-1)),e("text",go,"¥"+o(J.value.toFixed(2)),1),B.value>0?(a(),r("text",_o," 省¥"+o(B.value.toFixed(2)),1)):p("",!0)])])]),e("view",yo,[_(S,{type:"default",onClick:ve},{default:y(()=>l[37]||(l[37]=[V(" 上一步 ",-1)])),_:1,__:[37]}),_(S,{type:"primary",onClick:pe,class:"next-button"},{default:y(()=>l[38]||(l[38]=[V(" 下一步：确认提交 ",-1)])),_:1,__:[38]})])])}}}),xo=ne(wo,[["__scopeId","data-v-b6585cd7"]]),ho={class:"step-review"},bo={class:"quote-header"},ko={class:"quote-number"},$o={class:"number-value"},Co={class:"quote-meta"},Po={class:"meta-item"},Vo={class:"meta-item"},Fo={class:"review-section"},To={class:"section-header"},So={class:"info-grid"},No={class:"info-item"},qo={class:"info-value"},Io={class:"info-item"},Do={class:"info-value"},Mo={key:0,class:"info-item"},zo={class:"info-value"},Uo={key:1,class:"info-item"},Ao={class:"info-value"},Eo={class:"info-item"},Bo={class:"customer-type-badge"},Oo={class:"badge-text"},Ro={key:0,class:"badge-discount"},Wo={key:0,class:"address-section"},Qo={class:"info-value"},jo={key:1,class:"remarks-section"},Lo={class:"info-value"},Ho={class:"review-section"},Jo={class:"section-header"},Ko={class:"section-title"},Yo={class:"products-list"},Zo=["src"],Go={class:"product-details"},Xo={class:"product-name"},el={class:"product-spec"},tl={key:0},sl={class:"product-pricing"},ol={class:"unit-price"},ll={class:"quantity"},al={class:"subtotal"},il={class:"review-section"},nl={class:"section-header"},rl={class:"pricing-breakdown"},ul={class:"breakdown-group"},cl={class:"breakdown-item"},dl={class:"item-value"},ml={key:0,class:"breakdown-group discount-group"},vl={key:0,class:"breakdown-item"},pl={class:"item-label"},fl={class:"item-value discount-value"},gl={key:1,class:"breakdown-item"},_l={class:"item-label"},yl={class:"item-value discount-value"},wl={class:"breakdown-item subtotal-item"},xl={class:"item-value"},hl={key:1,class:"breakdown-group"},bl={key:0,class:"breakdown-item"},kl={class:"item-value"},$l={key:1,class:"breakdown-item"},Cl={class:"item-value"},Pl={class:"item-label"},Vl={class:"item-value"},Fl={key:2,class:"breakdown-group"},Tl={class:"breakdown-item"},Sl={class:"item-label"},Nl={class:"item-value"},ql={class:"breakdown-group total-group"},Il={class:"breakdown-item total-item"},Dl={class:"item-value total-value"},Ml={key:0,class:"savings-summary"},zl={class:"savings-text"},Ul={class:"review-section"},Al={class:"terms-list"},El={class:"term-item"},Bl={class:"term-value"},Ol={class:"term-item"},Rl={class:"term-value"},Wl={key:0,class:"term-item"},Ql={key:0,class:"review-section"},jl={class:"special-terms"},Ll={class:"terms-text"},Hl={class:"review-actions"},Jl={class:"action-summary"},Kl={class:"final-total"},Yl={class:"total-amount"},Zl={class:"action-buttons"},Gl={key:1,class:"success-overlay"},Xl=ie({__name:"StepReview",props:{customerForm:{},selectedProducts:{},pricingConfig:{},quoteMetadata:{},totalPrice:{},submitting:{type:Boolean}},emits:["submit","back"],setup(ee,{emit:k}){const c=ee,U=k,s=T(!1),P={individual:{discount:0,name:"个人客户"},company:{discount:.05,name:"企业客户"},dealer:{discount:.1,name:"经销商"},club:{discount:.08,name:"俱乐部"}},v={immediate:"立即付款","30days":"30天账期","60days":"60天账期",cod:"货到付款"},w=$(()=>c.selectedProducts.reduce((i,t)=>i+t.subtotal,0)),I=$(()=>{const i=P[c.customerForm.customerType];return w.value*i.discount}),E=$(()=>c.pricingConfig.discountType==="percentage"?w.value*(c.pricingConfig.discountValue/100):Math.min(c.pricingConfig.discountValue,w.value)),F=$(()=>I.value+E.value),M=$(()=>Math.max(0,w.value-F.value)),Q=$(()=>{var t;let i=c.pricingConfig.deliveryFee+c.pricingConfig.installationFee;return(t=c.pricingConfig.otherCharges)==null||t.forEach(u=>{i+=G(u)}),i}),b=$(()=>c.pricingConfig.taxIncluded?0:(M.value+Q.value)*(c.pricingConfig.taxRate/100)),z=$(()=>I.value>0||E.value>0),q=$(()=>Q.value>0),D=$(()=>F.value),B=i=>i.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),R=i=>i.length===11?i.replace(/(\d{3})(\d{4})(\d{4})/,"$1 $2 $3"):i,j=i=>{var t;return((t=P[i])==null?void 0:t.name)||"个人客户"},L=i=>{var t;return(((t=P[i])==null?void 0:t.discount)||0)*100},J=()=>{const i=new Date;return i.setDate(i.getDate()+c.quoteMetadata.validityDays),i.toLocaleDateString("zh-CN")},Z=i=>v[i]||"立即付款",G=i=>i.type==="percentage"?M.value*(i.amount/100):i.amount||0,H=i=>{uni.showModal({title:"返回修改",content:`确定要返回第${i}步进行修改吗？`,success:t=>{t.confirm&&U("back")}})},f=()=>{U("back")},g=()=>{s.value=!0,U("submit")};return(i,t)=>(a(),r("view",ho,[t[39]||(t[39]=e("view",{class:"step-header"},[e("text",{class:"step-title"},"确认报价"),e("text",{class:"step-subtitle"},"请仔细核对以下信息，确认无误后提交报价")],-1)),e("view",bo,[e("view",ko,[t[3]||(t[3]=e("text",{class:"number-label"},"报价编号",-1)),e("text",$o,o(i.quoteMetadata.quoteNumber),1)]),e("view",Co,[e("text",Po,"有效期: "+o(i.quoteMetadata.validityDays)+"天",1),e("text",Vo,"创建时间: "+o(B(new Date)),1)])]),e("view",Fo,[e("view",To,[t[5]||(t[5]=e("text",{class:"section-icon"},"👤",-1)),t[6]||(t[6]=e("text",{class:"section-title"},"客户信息",-1)),_(S,{size:"mini",type:"plain",onClick:t[0]||(t[0]=u=>H(1))},{default:y(()=>t[4]||(t[4]=[V(" 修改 ",-1)])),_:1,__:[4]})]),e("view",So,[e("view",No,[t[7]||(t[7]=e("text",{class:"info-label"},"姓名",-1)),e("text",qo,o(i.customerForm.customerName),1)]),e("view",Io,[t[8]||(t[8]=e("text",{class:"info-label"},"电话",-1)),e("text",Do,o(R(i.customerForm.customerPhone)),1)]),i.customerForm.customerWechat?(a(),r("view",Mo,[t[9]||(t[9]=e("text",{class:"info-label"},"微信",-1)),e("text",zo,o(i.customerForm.customerWechat),1)])):p("",!0),i.customerForm.customerEmail?(a(),r("view",Uo,[t[10]||(t[10]=e("text",{class:"info-label"},"邮箱",-1)),e("text",Ao,o(i.customerForm.customerEmail),1)])):p("",!0),e("view",Eo,[t[11]||(t[11]=e("text",{class:"info-label"},"客户类型",-1)),e("view",Bo,[e("text",Oo,o(j(i.customerForm.customerType)),1),L(i.customerForm.customerType)>0?(a(),r("text",Ro,o(L(i.customerForm.customerType))+"%优惠 ",1)):p("",!0)])])]),i.customerForm.customerAddress?(a(),r("view",Wo,[t[12]||(t[12]=e("text",{class:"info-label"},"地址",-1)),e("text",Qo,o(i.customerForm.customerProvince)+" "+o(i.customerForm.customerCity)+" "+o(i.customerForm.customerAddress),1)])):p("",!0),i.customerForm.customerRemark?(a(),r("view",jo,[t[13]||(t[13]=e("text",{class:"info-label"},"备注",-1)),e("text",Lo,o(i.customerForm.customerRemark),1)])):p("",!0)]),e("view",Ho,[e("view",Jo,[t[15]||(t[15]=e("text",{class:"section-icon"},"📦",-1)),e("text",Ko,"选择产品 ("+o(i.selectedProducts.length)+"种)",1),_(S,{size:"mini",type:"plain",onClick:t[1]||(t[1]=u=>H(2))},{default:y(()=>t[14]||(t[14]=[V(" 修改 ",-1)])),_:1,__:[14]})]),e("view",Yo,[(a(!0),r(se,null,oe(i.selectedProducts,(u,h)=>(a(),r("view",{key:`${u.product.id}-${u.skuId||"default"}`,class:"product-item"},[e("image",{class:"product-image",src:u.product.image||"/static/images/default-product.png",mode:"aspectFill"},null,8,Zo),e("view",Go,[e("text",Xo,o(u.product.name),1),e("text",el,[V(o(u.product.model)+" ",1),u.skuName?(a(),r("text",tl," - "+o(u.skuName),1)):p("",!0)]),e("view",sl,[e("text",ol,"单价: ¥"+o(u.price),1),e("text",ll,"数量: "+o(u.quantity)+o(u.product.unit||"个"),1),e("text",al,"小计: ¥"+o(u.subtotal.toFixed(2)),1)])])]))),128))])]),e("view",il,[e("view",nl,[t[17]||(t[17]=e("text",{class:"section-icon"},"💰",-1)),t[18]||(t[18]=e("text",{class:"section-title"},"价格配置",-1)),_(S,{size:"mini",type:"plain",onClick:t[2]||(t[2]=u=>H(3))},{default:y(()=>t[16]||(t[16]=[V(" 修改 ",-1)])),_:1,__:[16]})]),e("view",rl,[e("view",ul,[t[20]||(t[20]=e("text",{class:"group-title"},"基础费用",-1)),e("view",cl,[t[19]||(t[19]=e("text",{class:"item-label"},"产品小计",-1)),e("text",dl,"¥"+o(w.value.toFixed(2)),1)])]),z.value?(a(),r("view",ml,[t[22]||(t[22]=e("text",{class:"group-title"},"优惠折扣",-1)),I.value>0?(a(),r("view",vl,[e("text",pl,o(j(i.customerForm.customerType))+"优惠",1),e("text",fl,"-¥"+o(I.value.toFixed(2)),1)])):p("",!0),E.value>0?(a(),r("view",gl,[e("text",_l," 额外折扣 ("+o(i.pricingConfig.discountType==="percentage"?`${i.pricingConfig.discountValue}%`:`¥${i.pricingConfig.discountValue}`)+") ",1),e("text",yl,"-¥"+o(E.value.toFixed(2)),1)])):p("",!0),e("view",wl,[t[21]||(t[21]=e("text",{class:"item-label"},"折扣后小计",-1)),e("text",xl,"¥"+o(M.value.toFixed(2)),1)])])):p("",!0),q.value?(a(),r("view",hl,[t[25]||(t[25]=e("text",{class:"group-title"},"附加费用",-1)),i.pricingConfig.deliveryFee>0?(a(),r("view",bl,[t[23]||(t[23]=e("text",{class:"item-label"},"配送费",-1)),e("text",kl,"+¥"+o(i.pricingConfig.deliveryFee.toFixed(2)),1)])):p("",!0),i.pricingConfig.installationFee>0?(a(),r("view",$l,[t[24]||(t[24]=e("text",{class:"item-label"},"安装费",-1)),e("text",Cl,"+¥"+o(i.pricingConfig.installationFee.toFixed(2)),1)])):p("",!0),(a(!0),r(se,null,oe(i.pricingConfig.otherCharges,u=>(a(),r("view",{key:u.id,class:"breakdown-item"},[e("text",Pl,o(u.name),1),e("text",Vl,"+¥"+o(G(u).toFixed(2)),1)]))),128))])):p("",!0),b.value>0?(a(),r("view",Fl,[t[26]||(t[26]=e("text",{class:"group-title"},"税费",-1)),e("view",Tl,[e("text",Sl,"增值税 ("+o(i.pricingConfig.taxRate)+"%)",1),e("text",Nl,"+¥"+o(b.value.toFixed(2)),1)])])):p("",!0),e("view",ql,[e("view",Il,[t[27]||(t[27]=e("text",{class:"item-label"},"合计金额",-1)),e("text",Dl,"¥"+o(i.totalPrice.toFixed(2)),1)]),D.value>0?(a(),r("view",Ml,[e("text",zl,"已为您节省 ¥"+o(D.value.toFixed(2)),1)])):p("",!0)])])]),e("view",Ul,[t[32]||(t[32]=e("view",{class:"section-header"},[e("text",{class:"section-icon"},"📋"),e("text",{class:"section-title"},"报价条款")],-1)),e("view",Al,[e("view",El,[t[28]||(t[28]=e("text",{class:"term-label"},"报价有效期",-1)),e("text",Bl,o(i.quoteMetadata.validityDays)+"天 (至"+o(J())+")",1)]),e("view",Ol,[t[29]||(t[29]=e("text",{class:"term-label"},"付款条件",-1)),e("text",Rl,o(Z(i.quoteMetadata.paymentTerms)),1)]),i.pricingConfig.taxIncluded?(a(),r("view",Wl,t[30]||(t[30]=[e("text",{class:"term-label"},"价格说明",-1),e("text",{class:"term-value"},"以上价格为含税价格",-1)]))):p("",!0),t[31]||(t[31]=e("view",{class:"term-item"},[e("text",{class:"term-label"},"报价说明"),e("text",{class:"term-value"},"本报价仅对本次询价有效，如有变动恕不另行通知")],-1))])]),i.quoteMetadata.specialTerms?(a(),r("view",Ql,[t[33]||(t[33]=e("view",{class:"section-header"},[e("text",{class:"section-icon"},"📝"),e("text",{class:"section-title"},"特殊条款")],-1)),e("view",jl,[e("text",Ll,o(i.quoteMetadata.specialTerms),1)])])):p("",!0),e("view",Hl,[e("view",Jl,[t[35]||(t[35]=e("text",{class:"summary-text"},"请确认以上信息无误",-1)),e("view",Kl,[t[34]||(t[34]=e("text",{class:"total-label"},"合计金额：",-1)),e("text",Yl,"¥"+o(i.totalPrice.toFixed(2)),1)])]),e("view",Zl,[_(S,{type:"default",onClick:f},{default:y(()=>t[36]||(t[36]=[V(" 返回修改 ",-1)])),_:1,__:[36]}),_(S,{type:"primary",onClick:g,loading:i.submitting,class:"submit-button"},{default:y(()=>t[37]||(t[37]=[V(" 确认生成报价 ",-1)])),_:1,__:[37]},8,["loading"])])]),s.value?(a(),r("view",Gl,t[38]||(t[38]=[e("view",{class:"success-content"},[e("text",{class:"success-icon"},"✅"),e("text",{class:"success-title"},"报价生成成功！"),e("text",{class:"success-subtitle"},"正在跳转到报价预览...")],-1)]))):p("",!0)]))}}),ea=ne(Xl,[["__scopeId","data-v-8f0f34d9"]]),ta={class:"quote-wizard"},sa={class:"wizard-progress"},oa={class:"progress-container"},la={class:"progress-bar"},aa={class:"progress-steps"},ia={class:"step-circle"},na={key:0,class:"step-check"},ra={key:1,class:"step-number"},ua={class:"step-label"},ca={class:"wizard-content"},da={key:0,class:"wizard-nav"},ma={key:1,class:"price-sticky"},va={class:"price-summary"},pa={class:"price-value"},_e=4,fa=ie({__name:"QuoteWizard",setup(ee){const k=T(1),c=T(!1),U=[{name:"客户信息",icon:"👤"},{name:"选择产品",icon:"📦"},{name:"价格配置",icon:"💰"},{name:"确认提交",icon:"✓"}],s=re({customerName:"",customerPhone:"",customerWechat:"",customerEmail:"",customerProvince:"",customerCity:"",customerAddress:"",customerType:"individual",customerRemark:"",saveCustomer:!0}),P=re({customerName:"",customerPhone:"",customerWechat:"",customerEmail:"",customerAddress:""}),v=T([]),w=re({discountType:"percentage",discountValue:0,taxRate:13,taxIncluded:!1,deliveryFee:0,installationFee:0,otherCharges:[]}),I=re({quoteNumber:"",validityDays:30,paymentTerms:"immediate",specialTerms:"",images:[]}),E=T([{id:"tables",name:"台球桌",icon:"🎱"},{id:"cues",name:"球杆",icon:"🎯"},{id:"balls",name:"台球",icon:"⚪"},{id:"accessories",name:"配件",icon:"🔧"},{id:"maintenance",name:"维护用品",icon:"🧽"}]),F=$(()=>!0),M=$(()=>{switch(k.value){case 1:return s.customerName&&s.customerPhone;case 2:return v.value.length>0;case 3:return!0;case 4:return!0;default:return!1}}),Q=$(()=>v.value.reduce((f,g)=>f+g.subtotal,0)),b=$(()=>{let f=Q.value;return w.discountType==="percentage"?f=f*(1-w.discountValue/100):f=f-w.discountValue,f+=w.deliveryFee+w.installationFee,w.otherCharges.forEach(g=>{g.type==="percentage"?f+=f*(g.amount/100):f+=g.amount}),w.taxIncluded||(f+=f*(w.taxRate/100)),Math.max(0,f)}),z=()=>{var f;M.value&&k.value<_e&&(k.value++,Z(),$e.report("wizard_step_complete",{step:k.value-1,step_name:(f=U[k.value-2])==null?void 0:f.name}))},q=()=>{k.value>1&&k.value--},D=f=>{console.log("QuoteWizard: Received form update",f),Object.assign(s,f)},B=()=>{L()&&z()},R=()=>{v.value.length>0?z():ae.show("请选择至少一个产品","none")},j=()=>{z()},L=()=>{let f=!0;return Object.keys(P).forEach(g=>{P[g]=""}),s.customerName.trim()||(P.customerName="请输入客户姓名",f=!1),s.customerPhone.trim()?/^1[3-9]\d{9}$/.test(s.customerPhone)||(P.customerPhone="请输入正确的手机号码",f=!1):(P.customerPhone="请输入联系电话",f=!1),s.customerEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.customerEmail)&&(P.customerEmail="请输入正确的邮箱格式",f=!1),f},J=()=>{const g=new Date().toISOString().slice(0,10).replace(/-/g,""),i=Math.floor(Math.random()*9999).toString().padStart(4,"0");I.quoteNumber=`YS-${g}-${i}`},Z=()=>{try{const f={currentStep:k.value,customerForm:s,selectedProducts:v.value,pricingConfig:w,quoteMetadata:I,timestamp:Date.now()};ge.setJSON("quote_wizard_draft",f)}catch(f){console.warn("Failed to save draft:",f)}},G=()=>{try{const f=ge.getJSON("quote_wizard_draft");f&&Date.now()-f.timestamp<24*60*60*1e3&&(k.value=f.currentStep||1,Object.assign(s,f.customerForm||{}),v.value=f.selectedProducts||[],Object.assign(w,f.pricingConfig||{}),Object.assign(I,f.quoteMetadata||{}))}catch(f){console.warn("Failed to load draft:",f)}},H=async()=>{var f;if(M.value){c.value=!0;try{const g={customer:s,items:v.value.map(t=>({product_id:t.product.id,product_name:t.product.name,quantity:t.quantity,unit_price:t.price,total_price:t.subtotal})),pricing:{subtotal:Q.value,discount:w.discountType==="percentage"?{type:"percentage",value:w.discountValue}:{type:"fixed",value:w.discountValue},finalTotal:b.value},quote:I},i=await Se.createQuote(g);if(i.success)ge.removeItem("quote_wizard_draft"),ae.success("报价创建成功"),setTimeout(()=>{var t;Ne.redirectTo(`/sales/quote/preview?id=${(t=i.data)==null?void 0:t.id}`)},1500);else throw new Error(((f=i.error)==null?void 0:f.message)||"创建失败")}catch(g){ae.error(g.message||"创建失败，请重试")}finally{c.value=!1}}};return we(()=>{G(),J(),$e.report("quote_wizard_start",{user_type:"sales",timestamp:Date.now()})}),(f,g)=>(a(),r("view",ta,[_(Pe,{title:"新建报价","show-back":!0,fixed:!0}),e("view",sa,[e("view",oa,[e("view",la,[e("view",{class:"progress-fill",style:Ce({width:`${k.value/_e*100}%`})},null,4)]),e("view",aa,[(a(),r(se,null,oe(U,(i,t)=>e("view",{key:t,class:Y(["progress-step",{"progress-step--active":k.value>t,"progress-step--current":k.value===t+1}])},[e("view",ia,[k.value>t+1?(a(),r("text",na,"✓")):(a(),r("text",ra,o(t+1),1))]),e("text",ua,o(i.name),1)],2)),64))])])]),e("view",ca,[k.value===1?(a(),te(nt,{key:0,form:s,"onUpdate:form":[g[0]||(g[0]=i=>s=i),D],errors:P,onNext:B,onValidate:L},null,8,["form","errors"])):k.value===2?(a(),te(_s,{key:1,selectedProducts:v.value,"onUpdate:selectedProducts":g[1]||(g[1]=i=>v.value=i),categories:E.value,onNext:R,onBack:g[2]||(g[2]=i=>k.value=1)},null,8,["selectedProducts","categories"])):k.value===3?(a(),te(xo,{key:2,config:w,"onUpdate:config":g[3]||(g[3]=i=>w=i),selectedProducts:v.value,customerType:s.customerType,onNext:j,onBack:g[4]||(g[4]=i=>k.value=2)},null,8,["config","selectedProducts","customerType"])):k.value===4?(a(),te(ea,{key:3,customerForm:s,selectedProducts:v.value,pricingConfig:w,quoteMetadata:I,totalPrice:b.value,onSubmit:H,onBack:g[5]||(g[5]=i=>k.value=3),submitting:c.value},null,8,["customerForm","selectedProducts","pricingConfig","quoteMetadata","totalPrice","submitting"])):p("",!0)]),F.value?(a(),r("view",da,[k.value>1?(a(),te(S,{key:0,type:"default",onClick:q,block:!1,class:"nav-back"},{default:y(()=>g[6]||(g[6]=[V(" 上一步 ",-1)])),_:1,__:[6]})):p("",!0),g[9]||(g[9]=e("view",{class:"nav-spacer"},null,-1)),k.value<_e?(a(),te(S,{key:1,type:"primary",onClick:z,block:!1,disabled:!M.value,class:"nav-next"},{default:y(()=>g[7]||(g[7]=[V(" 下一步 ",-1)])),_:1,__:[7]},8,["disabled"])):(a(),te(S,{key:2,type:"primary",onClick:H,loading:c.value,block:!1,class:"nav-submit"},{default:y(()=>g[8]||(g[8]=[V(" 生成报价 ",-1)])),_:1,__:[8]},8,["loading"]))])):p("",!0),k.value>=2&&v.value.length>0?(a(),r("view",ma,[e("view",va,[g[10]||(g[10]=e("text",{class:"price-label"},"合计：",-1)),e("text",pa,"¥"+o(b.value.toFixed(2)),1)])])):p("",!0)]))}}),ga=ne(fa,[["__scopeId","data-v-2b9e8bd7"]]),_a={class:"sales-container"},ya=ie({__name:"create",setup(ee){return(k,c)=>(a(),r("view",_a,[_(ga)]))}}),ka=ne(ya,[["__scopeId","data-v-8e0800d1"]]);export{ka as default};
