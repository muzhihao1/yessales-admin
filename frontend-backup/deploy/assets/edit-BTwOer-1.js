import{d as ae,O as ne,r as d,i as ie,h as $,o as re,E as ue,c,a as t,j as x,t as n,b as f,v as r,x as u,n as h,k as b,y as q,g as m,u as de}from"./index.standard-DHpxIVC0.js";const ce={class:"customer-edit-page"},me={class:"page-header"},ve={class:"page-title"},fe={class:"header-actions"},pe=["loading"],we={key:0,class:"loading-container"},xe={key:1,class:"form-container"},be={class:"form-section"},_e={class:"form-row"},ye={class:"form-item"},ge={key:0,class:"error-text"},he={class:"form-item"},ke={key:0,class:"error-text"},Ce={class:"form-row"},Ve={class:"form-item"},Ie={key:0,class:"error-text"},Ue={class:"form-item"},Te={class:"form-picker"},Oe={class:"form-row"},Be={class:"form-item"},Me={class:"form-picker"},Ee={key:0,class:"form-item"},Se={class:"form-picker"},je={key:0,class:"business-fields"},De={class:"form-row"},Fe={class:"form-item"},Ne={key:0,class:"error-text"},Ae={class:"form-item"},Re={class:"form-row"},$e={class:"form-item"},qe={class:"form-item"},ze={key:1,class:"individual-fields"},Ge={class:"form-row"},Pe={class:"form-item"},He={class:"form-picker"},Je={class:"form-item"},Ke={class:"form-section"},Le={class:"form-row"},Qe={class:"form-item"},We={key:0,class:"error-text"},Xe={class:"form-item"},Ye={class:"form-row"},Ze={class:"form-item"},et={class:"form-picker"},tt={class:"form-item"},lt={class:"form-section"},st={class:"form-row"},ot={class:"form-item"},at={class:"form-item"},nt={class:"form-item"},it={class:"form-section"},rt={class:"form-item"},ut={class:"char-count"},mt=ae({__name:"edit",setup(dt){const z=ue();de();const S=ne(),j=d(!1),y=d(!1),_=d(""),D=d(null),p=ie(()=>!!_.value),l=$({name:"",phone:"",email:"",wechat_id:"",company:"",address:"",city:"",district:"",customer_type:"individual",status:"active",source:"walk_in",notes:"",birthday:"",gender:void 0,occupation:"",business_license:"",tax_id:"",legal_representative:"",preferred_contact_method:"phone",contact_time_preference:""}),a=$({}),k=d(0),C=d(0),V=d(0),I=d(0),U=d(0),T=[{value:"individual",label:"个人客户"},{value:"business",label:"企业客户"}],O=[{value:"active",label:"活跃"},{value:"inactive",label:"停用"},{value:"potential",label:"潜在客户"},{value:"blacklist",label:"黑名单"}],B=[{value:"walk_in",label:"到店咨询"},{value:"referral",label:"朋友推荐"},{value:"online",label:"网络咨询"},{value:"phone",label:"电话咨询"},{value:"exhibition",label:"展会"},{value:"other",label:"其他"}],M=[{value:void 0,label:"不选择"},{value:"male",label:"男"},{value:"female",label:"女"},{value:"other",label:"其他"}],E=[{value:"phone",label:"电话"},{value:"wechat",label:"微信"},{value:"email",label:"邮件"}],g=d(!1),F=d(""),N=d(""),A=d(()=>{});re(()=>{const s=z.query.id;s&&(_.value=s,G())});async function G(){if(_.value){j.value=!0;try{const s=await S.fetchCustomerById(_.value,!1,!1);D.value=s,Object.keys(l).forEach(e=>{e in s&&s[e]!==void 0&&(l[e]=s[e])}),P()}catch{uni.showToast({title:"加载客户信息失败",icon:"none"}),R()}finally{j.value=!1}}}function P(){const s=T.findIndex(v=>v.value===l.customer_type);s!==-1&&(k.value=s);const e=O.findIndex(v=>v.value===l.status);e!==-1&&(C.value=e);const i=B.findIndex(v=>v.value===l.source);i!==-1&&(V.value=i);const w=M.findIndex(v=>v.value===l.gender);w!==-1&&(I.value=w);const o=E.findIndex(v=>v.value===l.preferred_contact_method);o!==-1&&(U.value=o)}function H(s){k.value=s.detail.value,l.customer_type=T[s.detail.value].value,l.customer_type==="individual"?(l.company="",l.business_license="",l.tax_id="",l.legal_representative=""):(l.birthday="",l.gender=void 0,l.occupation=""),Z("customer_type")}function J(s){C.value=s.detail.value,l.status=O[s.detail.value].value}function K(s){V.value=s.detail.value,l.source=B[s.detail.value].value}function L(s){I.value=s.detail.value,l.gender=M[s.detail.value].value}function Q(s){U.value=s.detail.value,l.preferred_contact_method=E[s.detail.value].value}function W(s){l.birthday=s.detail.value}function X(){var e,i,w;Y();let s=!0;return(e=l.name)!=null&&e.trim()||(a.name="请输入客户姓名",s=!1),(i=l.phone)!=null&&i.trim()?/^1[3-9]\d{9}$/.test(l.phone)||(a.phone="请输入正确的手机号码",s=!1):(a.phone="请输入联系电话",s=!1),l.customer_type||(a.customer_type="请选择客户类型",s=!1),l.customer_type==="business"&&!((w=l.company)!=null&&w.trim())&&(a.company="企业客户请输入公司名称",s=!1),l.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)&&(a.email="请输入正确的邮箱地址",s=!1),s}function Y(){Object.keys(a).forEach(s=>{delete a[s]})}function Z(s){a[s]&&delete a[s]}async function ee(){if(!X()){uni.showToast({title:"请完善必填信息",icon:"none"});return}F.value=p.value?"确认更新":"确认保存",N.value=p.value?"确定要更新客户信息吗？":"确定要保存新客户吗？",A.value=p.value?le:te,g.value=!0}async function te(){y.value=!0;try{await S.createCustomer(l),uni.showToast({title:"客户创建成功",icon:"success"}),setTimeout(()=>{uni.navigateBack()},1500)}catch{uni.showToast({title:"创建失败，请重试",icon:"none"})}finally{y.value=!1}}async function le(){if(_.value){y.value=!0;try{await S.updateCustomer(_.value,l),uni.showToast({title:"客户信息更新成功",icon:"success"}),setTimeout(()=>{uni.navigateBack()},1500)}catch{uni.showToast({title:"更新失败，请重试",icon:"none"})}finally{y.value=!1}}}function R(){se()?(F.value="确认离开",N.value="您有未保存的更改，确定要离开吗？",A.value=()=>{uni.navigateBack()},g.value=!0):uni.navigateBack()}function se(){return p.value?D.value?Object.keys(l).some(s=>{const e=l[s],i=D.value[s];return e!==i}):!1:Object.values(l).some(s=>typeof s=="string"?s.trim():s!==void 0)}function oe(){g.value=!1}return(s,e)=>{const i=q("picker"),w=q("modal");return m(),c("view",ce,[t("view",me,[t("text",ve,n(p.value?"编辑客户":"新增客户"),1),t("view",fe,[t("button",{class:"action-btn cancel-btn",onClick:R},"取消"),t("button",{class:"action-btn save-btn",onClick:ee,loading:y.value},n(p.value?"更新":"保存"),9,pe)])]),j.value&&p.value?(m(),c("view",we,e[15]||(e[15]=[t("text",{class:"loading-text"},"加载客户信息中...",-1)]))):(m(),c("view",xe,[t("view",be,[e[33]||(e[33]=t("text",{class:"section-title"},"基本信息",-1)),t("view",_e,[t("view",ye,[e[16]||(e[16]=t("text",{class:"form-label"},"客户姓名 *",-1)),r(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.name=o),class:h(["form-input",{error:a.name}]),placeholder:"请输入客户姓名"},null,2),[[u,l.name]]),a.name?(m(),c("text",ge,n(a.name),1)):f("",!0)]),t("view",he,[e[17]||(e[17]=t("text",{class:"form-label"},"联系电话 *",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.phone=o),class:h(["form-input",{error:a.phone}]),placeholder:"请输入手机号",type:"tel"},null,2),[[u,l.phone]]),a.phone?(m(),c("text",ke,n(a.phone),1)):f("",!0)])]),t("view",Ce,[t("view",Ve,[e[19]||(e[19]=t("text",{class:"form-label"},"客户类型 *",-1)),x(i,{mode:"selector",range:T,"range-key":"label",value:k.value,onChange:H},{default:b(()=>[t("view",{class:h(["form-picker",{error:a.customer_type}])},[t("text",null,n(T[k.value].label),1),e[18]||(e[18]=t("text",{class:"picker-arrow"},"▼",-1))],2)]),_:1},8,["value"]),a.customer_type?(m(),c("text",Ie,n(a.customer_type),1)):f("",!0)]),t("view",Ue,[e[21]||(e[21]=t("text",{class:"form-label"},"客户状态",-1)),x(i,{mode:"selector",range:O,"range-key":"label",value:C.value,onChange:J},{default:b(()=>[t("view",Te,[t("text",null,n(O[C.value].label),1),e[20]||(e[20]=t("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])])]),t("view",Oe,[t("view",Be,[e[23]||(e[23]=t("text",{class:"form-label"},"客户来源",-1)),x(i,{mode:"selector",range:B,"range-key":"label",value:V.value,onChange:K},{default:b(()=>[t("view",Me,[t("text",null,n(B[V.value].label),1),e[22]||(e[22]=t("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])]),l.customer_type==="individual"?(m(),c("view",Ee,[e[25]||(e[25]=t("text",{class:"form-label"},"性别",-1)),x(i,{mode:"selector",range:M,"range-key":"label",value:I.value,onChange:L},{default:b(()=>[t("view",Se,[t("text",null,n(M[I.value].label),1),e[24]||(e[24]=t("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])])):f("",!0)]),l.customer_type==="business"?(m(),c("view",je,[t("view",De,[t("view",Fe,[e[26]||(e[26]=t("text",{class:"form-label"},"公司名称 *",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.company=o),class:h(["form-input",{error:a.company}]),placeholder:"请输入公司名称"},null,2),[[u,l.company]]),a.company?(m(),c("text",Ne,n(a.company),1)):f("",!0)]),t("view",Ae,[e[27]||(e[27]=t("text",{class:"form-label"},"法定代表人",-1)),r(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>l.legal_representative=o),class:"form-input",placeholder:"请输入法定代表人"},null,512),[[u,l.legal_representative]])])]),t("view",Re,[t("view",$e,[e[28]||(e[28]=t("text",{class:"form-label"},"营业执照号",-1)),r(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>l.business_license=o),class:"form-input",placeholder:"请输入营业执照号"},null,512),[[u,l.business_license]])]),t("view",qe,[e[29]||(e[29]=t("text",{class:"form-label"},"税务登记号",-1)),r(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>l.tax_id=o),class:"form-input",placeholder:"请输入税务登记号"},null,512),[[u,l.tax_id]])])])])):f("",!0),l.customer_type==="individual"?(m(),c("view",ze,[t("view",Ge,[t("view",Pe,[e[31]||(e[31]=t("text",{class:"form-label"},"出生日期",-1)),x(i,{mode:"date",value:l.birthday,onChange:W},{default:b(()=>[t("view",He,[t("text",null,n(l.birthday||"选择出生日期"),1),e[30]||(e[30]=t("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])]),t("view",Je,[e[32]||(e[32]=t("text",{class:"form-label"},"职业",-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>l.occupation=o),class:"form-input",placeholder:"请输入职业"},null,512),[[u,l.occupation]])])])])):f("",!0)]),t("view",Ke,[e[39]||(e[39]=t("text",{class:"section-title"},"联系方式",-1)),t("view",Le,[t("view",Qe,[e[34]||(e[34]=t("text",{class:"form-label"},"电子邮箱",-1)),r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>l.email=o),class:h(["form-input",{error:a.email}]),placeholder:"请输入邮箱地址",type:"email"},null,2),[[u,l.email]]),a.email?(m(),c("text",We,n(a.email),1)):f("",!0)]),t("view",Xe,[e[35]||(e[35]=t("text",{class:"form-label"},"微信号",-1)),r(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>l.wechat_id=o),class:"form-input",placeholder:"请输入微信号"},null,512),[[u,l.wechat_id]])])]),t("view",Ye,[t("view",Ze,[e[37]||(e[37]=t("text",{class:"form-label"},"偏好联系方式",-1)),x(i,{mode:"selector",range:E,"range-key":"label",value:U.value,onChange:Q},{default:b(()=>[t("view",et,[t("text",null,n(E[U.value].label),1),e[36]||(e[36]=t("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])]),t("view",tt,[e[38]||(e[38]=t("text",{class:"form-label"},"联系时间偏好",-1)),r(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>l.contact_time_preference=o),class:"form-input",placeholder:"如：工作日上午9-12点"},null,512),[[u,l.contact_time_preference]])])])]),t("view",lt,[e[43]||(e[43]=t("text",{class:"section-title"},"地址信息",-1)),t("view",st,[t("view",ot,[e[40]||(e[40]=t("text",{class:"form-label"},"城市",-1)),r(t("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>l.city=o),class:"form-input",placeholder:"请输入城市"},null,512),[[u,l.city]])]),t("view",at,[e[41]||(e[41]=t("text",{class:"form-label"},"区域",-1)),r(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>l.district=o),class:"form-input",placeholder:"请输入区域/区县"},null,512),[[u,l.district]])])]),t("view",nt,[e[42]||(e[42]=t("text",{class:"form-label"},"详细地址",-1)),r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>l.address=o),class:"form-input",placeholder:"请输入详细地址"},null,512),[[u,l.address]])])]),t("view",it,[e[45]||(e[45]=t("text",{class:"section-title"},"备注信息",-1)),t("view",rt,[e[44]||(e[44]=t("text",{class:"form-label"},"备注",-1)),r(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=o=>l.notes=o),class:"form-textarea",placeholder:"请输入客户备注信息...",maxlength:"500"},null,512),[[u,l.notes]]),t("text",ut,n((l.notes||"").length)+"/500",1)])])])),x(w,{visible:g.value,"onUpdate:visible":e[14]||(e[14]=o=>g.value=o),title:F.value,onConfirm:A.value,onCancel:oe},{default:b(()=>[t("text",null,n(N.value),1)]),_:1},8,["visible","title","onConfirm"])])}}});export{mt as default};
