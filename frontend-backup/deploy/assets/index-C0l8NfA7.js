import{H as Ne,r as C,i as z,d as A,w as G,c as u,a as e,v as H,x as N,j as M,y as ie,k as se,g as c,t as y,b as x,F as L,f as j,z as oe,n as F,e as Fe,A as qe,o as Le,G as k}from"./index.standard-DHpxIVC0.js";import{u as je,R as Ge}from"./RealtimeIndicator-BP6QFItv.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ye=Ne("settings",()=>{const h=C([]),I=C([]),v=C("general"),p=C(!1),s=C(!1),l=C(null),o=C([]),i=C(DEFAULT_BUSINESS_RULES),t=C(DEFAULT_SECURITY_SETTINGS),n=C(null),f=C(null),a=C(null),D=C(null),E=z(()=>{const m={general:[],business:[],security:[],notification:[],integration:[],appearance:[],backup:[],maintenance:[]};return h.value.forEach(r=>{m[r.category]&&m[r.category].push(r)}),m}),te=z(()=>E.value[v.value]||[]),W=z(()=>h.value.some(m=>m.updated_at==="pending")),T=z(()=>SETTINGS_CATEGORIES[v.value]);async function d(m){p.value=!0,l.value=null;try{const r=[{id:"gen_001",category:"general",key:"system_name",value:"YesSales 报价系统",label:"系统名称",description:"显示在浏览器标题栏和页面标题中的系统名称",type:"string",is_public:!0,is_required:!0,default_value:"YesSales 报价系统",updated_at:new Date().toISOString(),created_at:new Date().toISOString()},{id:"gen_002",category:"general",key:"company_name",value:"耶氏台球斗南销售中心",label:"公司名称",description:"公司正式名称，用于报价单和文档",type:"string",is_public:!0,is_required:!0,default_value:"",updated_at:new Date().toISOString(),created_at:new Date().toISOString()},{id:"bus_001",category:"business",key:"default_tax_rate",value:.13,label:"默认税率",description:"新建报价单时的默认税率（小数形式，如0.13表示13%）",type:"number",validation:[{type:"min",value:0,message:"税率不能为负数"},{type:"max",value:1,message:"税率不能超过100%"}],is_public:!1,is_required:!0,default_value:.13,updated_at:new Date().toISOString(),created_at:new Date().toISOString()},{id:"bus_002",category:"business",key:"max_discount_percentage",value:20,label:"最大折扣百分比",description:"报价单允许的最大折扣百分比",type:"number",validation:[{type:"min",value:0,message:"折扣不能为负数"},{type:"max",value:100,message:"折扣不能超过100%"}],is_public:!1,is_required:!0,default_value:20,updated_at:new Date().toISOString(),created_at:new Date().toISOString()},{id:"sec_001",category:"security",key:"password_min_length",value:8,label:"密码最小长度",description:"用户密码的最小长度要求",type:"number",validation:[{type:"min",value:6,message:"密码长度至少6位"},{type:"max",value:32,message:"密码长度不能超过32位"}],is_public:!1,is_required:!0,default_value:8,updated_at:new Date().toISOString(),created_at:new Date().toISOString()},{id:"sec_002",category:"security",key:"max_login_attempts",value:5,label:"最大登录尝试次数",description:"账户锁定前允许的最大登录失败次数",type:"number",validation:[{type:"min",value:3,message:"至少允许3次尝试"},{type:"max",value:10,message:"不能超过10次尝试"}],is_public:!1,is_required:!0,default_value:5,updated_at:new Date().toISOString(),created_at:new Date().toISOString()},{id:"not_001",category:"notification",key:"email_enabled",value:!0,label:"启用邮件通知",description:"是否启用系统邮件通知功能",type:"boolean",is_public:!1,is_required:!0,default_value:!1,updated_at:new Date().toISOString(),created_at:new Date().toISOString()}];m?h.value=r.filter($=>$.category===m):h.value=r,Y()}catch(r){l.value=r instanceof Error?r.message:"获取设置失败",console.error("Failed to fetch settings:",r)}finally{p.value=!1}}async function q(m,r){var $;s.value=!0,l.value=null;try{const b=h.value.find(R=>R.key===m);if(!b)throw new Error(`设置项 ${m} 不存在`);const S=J(b,r);if(!S.isValid)throw new Error((($=S.errors[m])==null?void 0:$[0])||"设置值无效");const _=b.value;b.value=r,b.updated_at=new Date().toISOString(),await new Promise(R=>setTimeout(R,500)),o.value.unshift({id:`change_${Date.now()}`,setting_key:m,old_value:_,new_value:r,changed_by:"current_user",changed_at:new Date().toISOString(),reason:"通过设置页面修改"}),Y(),uni.showToast({title:"设置已保存",icon:"success"})}catch(b){l.value=b instanceof Error?b.message:"保存设置失败",uni.showToast({title:l.value,icon:"none"}),console.error("Failed to update setting:",b)}finally{s.value=!1}}async function O(m){s.value=!0,l.value=null;try{const r=[],$=[];for(const[b,S]of Object.entries(m)){const _=h.value.find(K=>K.key===b);if(!_){$.push(`设置项 ${b} 不存在`);continue}const R=J(_,S);if(!R.isValid){$.push(...R.errors[b]||[]);continue}r.push({..._,value:S,updated_at:new Date().toISOString()})}if($.length>0)throw new Error($.join("; "));await new Promise(b=>setTimeout(b,1e3)),r.forEach(b=>{const S=h.value.findIndex(_=>_.id===b.id);S!==-1&&(h.value[S]=b)}),Y(),uni.showToast({title:`已保存 ${r.length} 项设置`,icon:"success"})}catch(r){l.value=r instanceof Error?r.message:"批量保存设置失败",uni.showToast({title:l.value,icon:"none"}),console.error("Failed to batch update settings:",r)}finally{s.value=!1}}async function ae(m){try{uni.showModal({title:"重置设置",content:m?`确定要将 ${SETTINGS_CATEGORIES[m].title} 重置为默认值吗？`:"确定要将所有设置重置为默认值吗？",success:async r=>{r.confirm&&(s.value=!0,(m?h.value.filter(b=>b.category===m):h.value).forEach(b=>{b.value=b.default_value,b.updated_at=new Date().toISOString()}),await new Promise(b=>setTimeout(b,500)),Y(),s.value=!1,uni.showToast({title:"设置已重置",icon:"success"}))}})}catch(r){l.value=r instanceof Error?r.message:"重置设置失败",console.error("Failed to reset settings:",r)}}async function le(m){try{const r=m?h.value.filter(b=>m.includes(b.category)):h.value;return{version:"1.0.0",exported_at:new Date().toISOString(),exported_by:"current_user",categories:m||Object.keys(SETTINGS_CATEGORIES),settings:r,checksum:Q(r)}}catch(r){throw l.value=r instanceof Error?r.message:"导出设置失败",console.error("Failed to export settings:",r),r}}async function re(m){var r;s.value=!0,l.value=null;try{if(!m.settings||!Array.isArray(m.settings))throw new Error("导入数据格式无效");if(Q(m.settings)!==m.checksum)throw new Error("导入数据校验失败，文件可能已损坏");let b=0,S=0,_=0;const R=[],K=[];for(const V of m.settings)try{const U=h.value.find(de=>de.key===V.key);if(!U){K.push(`设置项 ${V.key} 在当前系统中不存在，已跳过`),S++;continue}const ne=J(U,V.value);if(!ne.isValid){R.push(`设置项 ${V.key} 的值无效: ${(r=ne.errors[V.key])==null?void 0:r[0]}`),_++;continue}U.value=V.value,U.updated_at=new Date().toISOString(),b++}catch(U){R.push(`处理设置项 ${V.key} 时出错: ${U instanceof Error?U.message:"未知错误"}`),_++}return await new Promise(V=>setTimeout(V,1e3)),Y(),{success:_===0,imported_count:b,skipped_count:S,error_count:_,errors:R,warnings:K}}catch($){throw l.value=$ instanceof Error?$.message:"导入设置失败",console.error("Failed to import settings:",$),$}finally{s.value=!1}}async function ue(m){p.value=!0,l.value=null;try{const r=[{id:"hist_001",setting_key:"default_tax_rate",old_value:.1,new_value:.13,changed_by:"admin",changed_at:new Date(Date.now()-864e5).toISOString(),reason:"税率调整通知",ip_address:"192.168.1.100"},{id:"hist_002",setting_key:"max_discount_percentage",old_value:15,new_value:20,changed_by:"manager",changed_at:new Date(Date.now()-1728e5).toISOString(),reason:"促销活动调整"}];o.value=m?r.filter($=>$.setting_key===m):r}catch(r){l.value=r instanceof Error?r.message:"获取变更历史失败",console.error("Failed to fetch change history:",r)}finally{p.value=!1}}function ce(m){v.value=m}function J(m,r){const $={},b={},S=[];if(!m.validation)return{isValid:!0,errors:$,warnings:b};for(const _ of m.validation)switch(_.type){case"required":(r==null||r==="")&&S.push(_.message);break;case"min":typeof r=="number"&&r<_.value&&S.push(_.message),typeof r=="string"&&r.length<_.value&&S.push(_.message);break;case"max":typeof r=="number"&&r>_.value&&S.push(_.message),typeof r=="string"&&r.length>_.value&&S.push(_.message);break;case"pattern":typeof r=="string"&&_.value instanceof RegExp&&(_.value.test(r)||S.push(_.message));break}return S.length>0&&($[m.key]=S),{isValid:Object.keys($).length===0,errors:$,warnings:b}}function Y(){const m=h.value.filter(S=>S.category==="business"),r={...i.value};m.forEach(S=>{S.key in r&&(r[S.key]=S.value)}),i.value=r;const $=h.value.filter(S=>S.category==="security"),b={...t.value};$.forEach(S=>{S.key in b&&(b[S.key]=S.value)}),t.value=b}function Q(m){const r=JSON.stringify(m);let $=0;for(let b=0;b<r.length;b++){const S=r.charCodeAt(b);$=($<<5)-$+S,$=$&$}return Math.abs($).toString(16)}function X(m){return h.value.find(r=>r.key===m)}function Z(m,r){const $=X(m);return $?$.value:r}return{settings:h,settingsGroups:I,currentCategory:v,loading:p,saving:s,error:l,changeHistory:o,businessRules:i,securitySettings:t,notificationSettings:n,integrationSettings:f,backupSettings:a,appearanceSettings:D,settingsByCategory:E,currentCategorySettings:te,hasUnsavedChanges:W,categoryInfo:T,fetchSettings:d,updateSetting:q,batchUpdateSettings:O,resetToDefaults:ae,exportSettings:le,importSettings:re,fetchChangeHistory:ue,setCurrentCategory:ce,validateSettingValue:J,getSetting:X,getSettingValue:Z}}),We={class:"general-settings"},Je={class:"settings-section"},Qe={class:"settings-group"},Xe={class:"setting-item"},Ze={class:"setting-item"},Ke={class:"setting-item"},et={class:"settings-section"},tt={class:"settings-group"},st={class:"setting-item"},nt={class:"setting-picker"},it={class:"setting-item"},ot={class:"setting-picker"},at={class:"setting-item"},lt={class:"setting-picker"},rt={class:"settings-section"},ut={class:"settings-group"},ct={class:"setting-item"},dt=["checked"],gt={class:"setting-item"},vt=["checked"],pt={class:"setting-item"},_t=["checked"],mt=A({__name:"GeneralSettings",props:{settings:{}},emits:["update"],setup(h,{emit:I}){const v=h,p=I,s=C({system_name:"",company_name:"",contact_phone:"",default_language:"简体中文",timezone:"Asia/Shanghai",default_page_size:20,debug_mode:!1,maintenance_mode:!1,allow_registration:!0,...v.settings}),l=[{value:"zh-CN",label:"简体中文"},{value:"zh-TW",label:"繁体中文"},{value:"en-US",label:"English"}],o=[{value:"Asia/Shanghai",label:"东八区 (UTC+8)"},{value:"Asia/Tokyo",label:"东九区 (UTC+9)"},{value:"America/New_York",label:"西五区 (UTC-5)"},{value:"Europe/London",label:"零时区 (UTC+0)"}],i=["10","20","50","100"],t=z(()=>l.findIndex(T=>T.label===s.value.default_language)),n=z(()=>o.findIndex(T=>T.value===s.value.timezone)),f=z(()=>i.findIndex(T=>T===String(s.value.default_page_size)));function a(T,d){s.value[T]=d,p("update",T,d)}function D(T){const d=l[T.detail.value];s.value.default_language=d.label,s.value.language_code=d.value,p("update","default_language",d.label),p("update","language_code",d.value)}function E(T){const d=o[T.detail.value];s.value.timezone=d.value,p("update","timezone",d.value)}function te(T){const d=parseInt(i[T.detail.value]);s.value.default_page_size=d,p("update","default_page_size",d)}function W(T,d){const q=d.detail.value;s.value[T]=q,p("update",T,q)}return G(()=>v.settings,T=>{s.value={...s.value,...T}},{deep:!0}),(T,d)=>{const q=ie("picker");return c(),u("view",We,[e("view",Je,[d[12]||(d[12]=e("text",{class:"section-title"},"基本配置",-1)),e("view",Qe,[e("view",Xe,[d[9]||(d[9]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"系统名称"),e("text",{class:"label-desc"},"显示在系统顶部的应用名称")],-1)),H(e("input",{"onUpdate:modelValue":d[0]||(d[0]=O=>s.value.system_name=O),class:"setting-input",placeholder:"请输入系统名称",onBlur:d[1]||(d[1]=O=>a("system_name",s.value.system_name))},null,544),[[N,s.value.system_name]])]),e("view",Ze,[d[10]||(d[10]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"公司名称"),e("text",{class:"label-desc"},"显示在报价单等文档上的公司名称")],-1)),H(e("input",{"onUpdate:modelValue":d[2]||(d[2]=O=>s.value.company_name=O),class:"setting-input",placeholder:"请输入公司名称",onBlur:d[3]||(d[3]=O=>a("company_name",s.value.company_name))},null,544),[[N,s.value.company_name]])]),e("view",Ke,[d[11]||(d[11]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"联系电话"),e("text",{class:"label-desc"},"客户联系时显示的电话号码")],-1)),H(e("input",{"onUpdate:modelValue":d[4]||(d[4]=O=>s.value.contact_phone=O),class:"setting-input",placeholder:"请输入联系电话",onBlur:d[5]||(d[5]=O=>a("contact_phone",s.value.contact_phone))},null,544),[[N,s.value.contact_phone]])])])]),e("view",et,[d[19]||(d[19]=e("text",{class:"section-title"},"界面配置",-1)),e("view",tt,[e("view",st,[d[14]||(d[14]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"默认语言"),e("text",{class:"label-desc"},"系统默认显示语言")],-1)),M(q,{mode:"selector",range:l,"range-key":"label",value:t.value,onChange:D},{default:se(()=>[e("view",nt,[e("text",null,y(s.value.default_language||"简体中文"),1),d[13]||(d[13]=e("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])]),e("view",it,[d[16]||(d[16]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"时区设置"),e("text",{class:"label-desc"},"系统时间显示时区")],-1)),M(q,{mode:"selector",range:o,"range-key":"label",value:n.value,onChange:E},{default:se(()=>[e("view",ot,[e("text",null,y(s.value.timezone||"东八区 (UTC+8)"),1),d[15]||(d[15]=e("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])]),e("view",at,[d[18]||(d[18]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"每页显示条数"),e("text",{class:"label-desc"},"列表页面默认每页显示的数据条数")],-1)),M(q,{mode:"selector",range:i,value:f.value,onChange:te},{default:se(()=>[e("view",lt,[e("text",null,y(s.value.default_page_size||"20")+" 条/页",1),d[17]||(d[17]=e("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])])])]),e("view",rt,[d[23]||(d[23]=e("text",{class:"section-title"},"功能开关",-1)),e("view",ut,[e("view",ct,[d[20]||(d[20]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"启用调试模式"),e("text",{class:"label-desc"},"开启后将显示详细的错误信息和调试日志")],-1)),e("switch",{checked:s.value.debug_mode,onChange:d[6]||(d[6]=O=>W("debug_mode",O)),color:"#2563eb"},null,40,dt)]),e("view",gt,[d[21]||(d[21]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"启用维护模式"),e("text",{class:"label-desc"},"开启后系统将显示维护页面，仅管理员可访问")],-1)),e("switch",{checked:s.value.maintenance_mode,onChange:d[7]||(d[7]=O=>W("maintenance_mode",O)),color:"#dc2626"},null,40,vt)]),e("view",pt,[d[22]||(d[22]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"允许用户注册"),e("text",{class:"label-desc"},"关闭后新用户无法自主注册，需要管理员邀请")],-1)),e("switch",{checked:s.value.allow_registration,onChange:d[8]||(d[8]=O=>W("allow_registration",O)),color:"#16a34a"},null,40,_t)])])])])}}}),bt=P(mt,[["__scopeId","data-v-934e7ce5"]]),ft={class:"business-rules-settings"},wt={class:"settings-section"},yt={class:"settings-group"},kt={class:"setting-item"},xt={class:"setting-control"},ht={class:"setting-item"},$t={class:"setting-control"},St={class:"setting-item"},Ct={class:"setting-control"},It={class:"settings-section"},Tt={class:"settings-group"},Et={class:"setting-item"},Mt=["checked"],Dt={class:"setting-item"},Ot={class:"setting-control"},Ut={class:"settings-section"},Bt={class:"settings-group"},At={class:"setting-item"},Pt={class:"setting-picker"},Vt={class:"setting-item"},zt={class:"setting-control"},Rt=A({__name:"BusinessRulesSettings",props:{settings:{}},emits:["update"],setup(h,{emit:I}){const v=h,p=I,s=C({quote_validity_days:30,default_discount_rate:0,max_discount_rate:20,enable_approval_workflow:!1,auto_approval_amount:1e4,price_precision:2,default_tax_rate:13,...v.settings}),l=["0","1","2","3","4"],o=z(()=>l.findIndex(f=>f===String(s.value.price_precision)));function i(f,a){s.value[f]=a,p("update",f,a)}function t(f,a){const D=a.detail.value;s.value[f]=D,p("update",f,D)}function n(f){const a=parseInt(l[f.detail.value]);s.value.price_precision=a,p("update","price_precision",a)}return G(()=>v.settings,f=>{s.value={...s.value,...f}},{deep:!0}),(f,a)=>{const D=ie("picker");return c(),u("view",ft,[e("view",wt,[a[17]||(a[17]=e("text",{class:"section-title"},"报价规则",-1)),e("view",yt,[e("view",kt,[a[12]||(a[12]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"报价有效期"),e("text",{class:"label-desc"},"报价单的默认有效天数")],-1)),e("view",xt,[H(e("input",{"onUpdate:modelValue":a[0]||(a[0]=E=>s.value.quote_validity_days=E),class:"setting-input",type:"number",min:"1",max:"365",onBlur:a[1]||(a[1]=E=>i("quote_validity_days",s.value.quote_validity_days))},null,544),[[N,s.value.quote_validity_days,void 0,{number:!0}]]),a[11]||(a[11]=e("text",{class:"unit"},"天",-1))])]),e("view",ht,[a[14]||(a[14]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"默认折扣率"),e("text",{class:"label-desc"},"新报价单的默认折扣率")],-1)),e("view",$t,[H(e("input",{"onUpdate:modelValue":a[2]||(a[2]=E=>s.value.default_discount_rate=E),class:"setting-input",type:"number",min:"0",max:"100",step:"0.1",onBlur:a[3]||(a[3]=E=>i("default_discount_rate",s.value.default_discount_rate))},null,544),[[N,s.value.default_discount_rate,void 0,{number:!0}]]),a[13]||(a[13]=e("text",{class:"unit"},"%",-1))])]),e("view",St,[a[16]||(a[16]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"最大折扣率"),e("text",{class:"label-desc"},"销售人员可设置的最大折扣率")],-1)),e("view",Ct,[H(e("input",{"onUpdate:modelValue":a[4]||(a[4]=E=>s.value.max_discount_rate=E),class:"setting-input",type:"number",min:"0",max:"100",step:"0.1",onBlur:a[5]||(a[5]=E=>i("max_discount_rate",s.value.max_discount_rate))},null,544),[[N,s.value.max_discount_rate,void 0,{number:!0}]]),a[15]||(a[15]=e("text",{class:"unit"},"%",-1))])])])]),e("view",It,[a[21]||(a[21]=e("text",{class:"section-title"},"审批规则",-1)),e("view",Tt,[e("view",Et,[a[18]||(a[18]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"启用审批流程"),e("text",{class:"label-desc"},"开启后报价单需要审批后才能发送给客户")],-1)),e("switch",{checked:s.value.enable_approval_workflow,onChange:a[6]||(a[6]=E=>t("enable_approval_workflow",E)),color:"#2563eb"},null,40,Mt)]),e("view",Dt,[a[20]||(a[20]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"自动审批金额"),e("text",{class:"label-desc"},"小于此金额的报价单自动审批通过")],-1)),e("view",Ot,[H(e("input",{"onUpdate:modelValue":a[7]||(a[7]=E=>s.value.auto_approval_amount=E),class:"setting-input",type:"number",min:"0",onBlur:a[8]||(a[8]=E=>i("auto_approval_amount",s.value.auto_approval_amount))},null,544),[[N,s.value.auto_approval_amount,void 0,{number:!0}]]),a[19]||(a[19]=e("text",{class:"unit"},"元",-1))])])])]),e("view",Ut,[a[26]||(a[26]=e("text",{class:"section-title"},"价格计算",-1)),e("view",Bt,[e("view",At,[a[23]||(a[23]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"价格精度"),e("text",{class:"label-desc"},"价格显示的小数位数")],-1)),M(D,{mode:"selector",range:l,value:o.value,onChange:n},{default:se(()=>[e("view",Pt,[e("text",null,y(s.value.price_precision||2)+" 位小数",1),a[22]||(a[22]=e("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])]),e("view",Vt,[a[25]||(a[25]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"税率"),e("text",{class:"label-desc"},"默认增值税率")],-1)),e("view",zt,[H(e("input",{"onUpdate:modelValue":a[9]||(a[9]=E=>s.value.default_tax_rate=E),class:"setting-input",type:"number",min:"0",max:"100",step:"0.01",onBlur:a[10]||(a[10]=E=>i("default_tax_rate",s.value.default_tax_rate))},null,544),[[N,s.value.default_tax_rate,void 0,{number:!0}]]),a[24]||(a[24]=e("text",{class:"unit"},"%",-1))])])])])])}}}),Ht=P(Rt,[["__scopeId","data-v-a4089d2d"]]),Nt={class:"security-settings"},Ft={class:"settings-section"},qt={class:"settings-group"},Lt={class:"setting-item"},jt={class:"setting-control"},Gt={class:"setting-item"},Yt=["checked"],Wt={class:"setting-item"},Jt=["checked"],Qt={class:"settings-section"},Xt={class:"settings-group"},Zt={class:"setting-item"},Kt={class:"setting-control"},es={class:"setting-item"},ts=["checked"],ss={class:"setting-item"},ns=["checked"],is={class:"settings-section"},os={class:"settings-group"},as={class:"setting-item"},ls=["checked"],rs={class:"setting-item"},us={class:"setting-control"},cs={class:"setting-item"},ds={class:"setting-control"},gs={class:"setting-item"},vs=["checked"],ps={class:"settings-section"},_s={class:"settings-group"},ms={class:"setting-item"},bs=["checked"],fs={class:"setting-item"},ws=["checked"],ys={class:"setting-item"},ks={class:"setting-control"},xs=A({__name:"SecuritySettings",props:{settings:{}},emits:["update"],setup(h,{emit:I}){const v=h,p=I,s=C({min_password_length:8,require_password_complexity:!0,enable_2fa:!1,session_timeout_minutes:120,allow_remember_me:!0,single_session_only:!1,enable_login_lockout:!0,max_login_attempts:5,lockout_duration_minutes:30,enable_ip_restriction:!1,enable_data_encryption:!0,enable_audit_logging:!0,log_retention_days:365,...v.settings});function l(i,t){s.value[i]=t,p("update",i,t)}function o(i,t){const n=t.detail.value;s.value[i]=n,p("update",i,n)}return G(()=>v.settings,i=>{s.value={...s.value,...i}},{deep:!0}),(i,t)=>(c(),u("view",Nt,[e("view",Ft,[t[22]||(t[22]=e("text",{class:"section-title"},"身份认证",-1)),e("view",qt,[e("view",Lt,[t[19]||(t[19]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"密码最小长度"),e("text",{class:"label-desc"},"用户密码的最小字符数要求")],-1)),e("view",jt,[H(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>s.value.min_password_length=n),class:"setting-input",type:"number",min:"6",max:"50",onBlur:t[1]||(t[1]=n=>l("min_password_length",s.value.min_password_length))},null,544),[[N,s.value.min_password_length,void 0,{number:!0}]]),t[18]||(t[18]=e("text",{class:"unit"},"字符",-1))])]),e("view",Gt,[t[20]||(t[20]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"密码复杂度要求"),e("text",{class:"label-desc"},"密码必须包含大小写字母、数字和特殊字符")],-1)),e("switch",{checked:s.value.require_password_complexity,onChange:t[2]||(t[2]=n=>o("require_password_complexity",n)),color:"#2563eb"},null,40,Yt)]),e("view",Wt,[t[21]||(t[21]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"启用双因素认证"),e("text",{class:"label-desc"},"要求用户使用短信或邮箱验证码登录")],-1)),e("switch",{checked:s.value.enable_2fa,onChange:t[3]||(t[3]=n=>o("enable_2fa",n)),color:"#16a34a"},null,40,Jt)])])]),e("view",Qt,[t[27]||(t[27]=e("text",{class:"section-title"},"会话管理",-1)),e("view",Xt,[e("view",Zt,[t[24]||(t[24]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"会话超时时间"),e("text",{class:"label-desc"},"用户无操作后自动退出的时间")],-1)),e("view",Kt,[H(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>s.value.session_timeout_minutes=n),class:"setting-input",type:"number",min:"5",max:"1440",onBlur:t[5]||(t[5]=n=>l("session_timeout_minutes",s.value.session_timeout_minutes))},null,544),[[N,s.value.session_timeout_minutes,void 0,{number:!0}]]),t[23]||(t[23]=e("text",{class:"unit"},"分钟",-1))])]),e("view",es,[t[25]||(t[25]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"记住登录状态"),e("text",{class:"label-desc"},"允许用户选择保持登录状态")],-1)),e("switch",{checked:s.value.allow_remember_me,onChange:t[6]||(t[6]=n=>o("allow_remember_me",n)),color:"#2563eb"},null,40,ts)]),e("view",ss,[t[26]||(t[26]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"单点登录"),e("text",{class:"label-desc"},"同一账号只能在一个设备上登录")],-1)),e("switch",{checked:s.value.single_session_only,onChange:t[7]||(t[7]=n=>o("single_session_only",n)),color:"#dc2626"},null,40,ns)])])]),e("view",is,[t[34]||(t[34]=e("text",{class:"section-title"},"访问控制",-1)),e("view",os,[e("view",as,[t[28]||(t[28]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"登录失败锁定"),e("text",{class:"label-desc"},"连续登录失败后锁定账户")],-1)),e("switch",{checked:s.value.enable_login_lockout,onChange:t[8]||(t[8]=n=>o("enable_login_lockout",n)),color:"#dc2626"},null,40,ls)]),e("view",rs,[t[30]||(t[30]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"最大失败次数"),e("text",{class:"label-desc"},"账户锁定前允许的最大登录失败次数")],-1)),e("view",us,[H(e("input",{"onUpdate:modelValue":t[9]||(t[9]=n=>s.value.max_login_attempts=n),class:"setting-input",type:"number",min:"3",max:"10",onBlur:t[10]||(t[10]=n=>l("max_login_attempts",s.value.max_login_attempts))},null,544),[[N,s.value.max_login_attempts,void 0,{number:!0}]]),t[29]||(t[29]=e("text",{class:"unit"},"次",-1))])]),e("view",cs,[t[32]||(t[32]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"锁定持续时间"),e("text",{class:"label-desc"},"账户锁定后的解锁等待时间")],-1)),e("view",ds,[H(e("input",{"onUpdate:modelValue":t[11]||(t[11]=n=>s.value.lockout_duration_minutes=n),class:"setting-input",type:"number",min:"5",max:"1440",onBlur:t[12]||(t[12]=n=>l("lockout_duration_minutes",s.value.lockout_duration_minutes))},null,544),[[N,s.value.lockout_duration_minutes,void 0,{number:!0}]]),t[31]||(t[31]=e("text",{class:"unit"},"分钟",-1))])]),e("view",gs,[t[33]||(t[33]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"IP访问限制"),e("text",{class:"label-desc"},"限制只能从特定IP地址访问系统")],-1)),e("switch",{checked:s.value.enable_ip_restriction,onChange:t[13]||(t[13]=n=>o("enable_ip_restriction",n)),color:"#dc2626"},null,40,vs)])])]),e("view",ps,[t[39]||(t[39]=e("text",{class:"section-title"},"数据保护",-1)),e("view",_s,[e("view",ms,[t[35]||(t[35]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"启用数据加密"),e("text",{class:"label-desc"},"对敏感数据进行加密存储")],-1)),e("switch",{checked:s.value.enable_data_encryption,onChange:t[14]||(t[14]=n=>o("enable_data_encryption",n)),color:"#16a34a"},null,40,bs)]),e("view",fs,[t[36]||(t[36]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"审计日志"),e("text",{class:"label-desc"},"记录用户操作和系统变更日志")],-1)),e("switch",{checked:s.value.enable_audit_logging,onChange:t[15]||(t[15]=n=>o("enable_audit_logging",n)),color:"#2563eb"},null,40,ws)]),e("view",ys,[t[38]||(t[38]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"日志保留期限"),e("text",{class:"label-desc"},"安全日志的保留天数")],-1)),e("view",ks,[H(e("input",{"onUpdate:modelValue":t[16]||(t[16]=n=>s.value.log_retention_days=n),class:"setting-input",type:"number",min:"30",max:"3650",onBlur:t[17]||(t[17]=n=>l("log_retention_days",s.value.log_retention_days))},null,544),[[N,s.value.log_retention_days,void 0,{number:!0}]]),t[37]||(t[37]=e("text",{class:"unit"},"天",-1))])])])])]))}}),hs=P(xs,[["__scopeId","data-v-d32e0114"]]),$s={class:"notification-settings"},Ss={class:"settings-section"},Cs={class:"settings-group"},Is={class:"setting-item"},Ts=["checked"],Es={class:"setting-item"},Ms=["checked"],Ds=A({__name:"NotificationSettings",props:{settings:{}},emits:["update"],setup(h,{emit:I}){const v=h,p=I,s=C({enable_email_notifications:!0,enable_sms_notifications:!1,...v.settings});function l(o,i){const t=i.detail.value;s.value[o]=t,p("update",o,t)}return G(()=>v.settings,o=>{s.value={...s.value,...o}},{deep:!0}),(o,i)=>(c(),u("view",$s,[e("view",Ss,[i[4]||(i[4]=e("text",{class:"section-title"},"通知配置",-1)),e("view",Cs,[e("view",Is,[i[2]||(i[2]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"邮件通知"),e("text",{class:"label-desc"},"启用邮件通知功能")],-1)),e("switch",{checked:s.value.enable_email_notifications,onChange:i[0]||(i[0]=t=>l("enable_email_notifications",t)),color:"#2563eb"},null,40,Ts)]),e("view",Es,[i[3]||(i[3]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"短信通知"),e("text",{class:"label-desc"},"启用短信通知功能")],-1)),e("switch",{checked:s.value.enable_sms_notifications,onChange:i[1]||(i[1]=t=>l("enable_sms_notifications",t)),color:"#16a34a"},null,40,Ms)])])])]))}}),Os=P(Ds,[["__scopeId","data-v-25140250"]]),Us={class:"integration-settings"},Bs={class:"settings-section"},As={class:"settings-group"},Ps={class:"setting-item"},Vs=["checked"],zs=A({__name:"IntegrationSettings",props:{settings:{}},emits:["update"],setup(h,{emit:I}){const v=h,p=I,s=C({enable_wechat_integration:!1,...v.settings});function l(o,i){const t=i.detail.value;s.value[o]=t,p("update",o,t)}return G(()=>v.settings,o=>{s.value={...s.value,...o}},{deep:!0}),(o,i)=>(c(),u("view",Us,[e("view",Bs,[i[2]||(i[2]=e("text",{class:"section-title"},"第三方集成",-1)),e("view",As,[e("view",Ps,[i[1]||(i[1]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"微信集成"),e("text",{class:"label-desc"},"启用微信小程序集成")],-1)),e("switch",{checked:s.value.enable_wechat_integration,onChange:i[0]||(i[0]=t=>l("enable_wechat_integration",t)),color:"#16a34a"},null,40,Vs)])])])]))}}),Rs=P(zs,[["__scopeId","data-v-6ac833ea"]]),Hs={class:"appearance-settings"},Ns={class:"settings-section"},Fs={class:"settings-group"},qs={class:"setting-item"},Ls=["checked"],js=A({__name:"AppearanceSettings",props:{settings:{}},emits:["update"],setup(h,{emit:I}){const v=h,p=I,s=C({dark_mode:!1,...v.settings});function l(o,i){const t=i.detail.value;s.value[o]=t,p("update",o,t)}return G(()=>v.settings,o=>{s.value={...s.value,...o}},{deep:!0}),(o,i)=>(c(),u("view",Hs,[e("view",Ns,[i[2]||(i[2]=e("text",{class:"section-title"},"外观设置",-1)),e("view",Fs,[e("view",qs,[i[1]||(i[1]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"主题模式"),e("text",{class:"label-desc"},"选择界面主题色调")],-1)),e("switch",{checked:s.value.dark_mode,onChange:i[0]||(i[0]=t=>l("dark_mode",t)),color:"#2563eb"},null,40,Ls)])])])]))}}),Gs=P(js,[["__scopeId","data-v-f7e25486"]]),Ys={class:"backup-settings"},Ws={class:"settings-section"},Js={class:"settings-group"},Qs={class:"setting-item"},Xs=["checked"],Zs=A({__name:"BackupSettings",props:{settings:{}},emits:["update"],setup(h,{emit:I}){const v=h,p=I,s=C({enable_auto_backup:!0,...v.settings});function l(o,i){const t=i.detail.value;s.value[o]=t,p("update",o,t)}return G(()=>v.settings,o=>{s.value={...s.value,...o}},{deep:!0}),(o,i)=>(c(),u("view",Ys,[e("view",Ws,[i[2]||(i[2]=e("text",{class:"section-title"},"备份设置",-1)),e("view",Js,[e("view",Qs,[i[1]||(i[1]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"自动备份"),e("text",{class:"label-desc"},"启用定时自动备份")],-1)),e("switch",{checked:s.value.enable_auto_backup,onChange:i[0]||(i[0]=t=>l("enable_auto_backup",t)),color:"#16a34a"},null,40,Xs)])])])]))}}),Ks=P(Zs,[["__scopeId","data-v-c8b8f00a"]]),en={class:"maintenance-settings"},tn={class:"settings-section"},sn={class:"settings-group"},nn={class:"setting-item"},on={class:"setting-picker"},an=A({__name:"MaintenanceSettings",props:{settings:{}},emits:["update"],setup(h,{emit:I}){const v=h,p=I,s=C({log_level:"info",...v.settings}),l=["debug","info","warn","error"],o=z(()=>l.findIndex(t=>t===s.value.log_level));function i(t){const n=l[t.detail.value];s.value.log_level=n,p("update","log_level",n)}return G(()=>v.settings,t=>{s.value={...s.value,...t}},{deep:!0}),(t,n)=>{const f=ie("picker");return c(),u("view",en,[e("view",tn,[n[2]||(n[2]=e("text",{class:"section-title"},"维护设置",-1)),e("view",sn,[e("view",nn,[n[1]||(n[1]=e("view",{class:"setting-label"},[e("text",{class:"label-text"},"日志级别"),e("text",{class:"label-desc"},"系统日志记录级别")],-1)),M(f,{mode:"selector",range:l,value:o.value,onChange:i},{default:se(()=>[e("view",on,[e("text",null,y(s.value.log_level||"info"),1),n[0]||(n[0]=e("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])])])])])}}}),ln=P(an,[["__scopeId","data-v-2d0d7597"]]),rn={class:"modal-content"},un={class:"category-list"},cn={class:"category-label"},dn={class:"modal-actions"},gn=["disabled"],vn=A({__name:"SettingsExportModal",props:{visible:{type:Boolean},categories:{}},emits:["close","export"],setup(h,{emit:I}){const v=I,p=C([]);function s(t){return{general:"常规设置",business:"业务规则",security:"安全设置",notification:"通知设置",integration:"集成设置",appearance:"外观设置",backup:"备份设置",maintenance:"维护设置"}[t]||t}function l(t){const n=p.value.indexOf(t);n>-1?p.value.splice(n,1):p.value.push(t)}function o(){v("close"),p.value=[]}function i(){v("export",p.value),o()}return(t,n)=>{const f=ie("checkbox");return t.visible?(c(),u("view",{key:0,class:"modal-overlay",onClick:o},[e("view",{class:"modal-container",onClick:n[0]||(n[0]=oe(()=>{},["stop"]))},[e("view",{class:"modal-header"},[n[1]||(n[1]=e("text",{class:"modal-title"},"导出设置",-1)),e("button",{class:"close-btn",onClick:o},"×")]),e("view",rn,[n[2]||(n[2]=e("text",{class:"modal-description"}," 选择要导出的设置分类，导出的文件可以在其他系统中导入使用。 ",-1)),e("view",un,[(c(!0),u(L,null,j(t.categories,a=>(c(),u("view",{key:a,class:"category-item"},[M(f,{checked:p.value.includes(a),onChange:D=>l(a)},null,8,["checked","onChange"]),e("text",cn,y(s(a)),1)]))),128))])]),e("view",dn,[e("button",{class:"modal-btn secondary",onClick:o},"取消"),e("button",{class:"modal-btn primary",onClick:i,disabled:p.value.length===0}," 导出设置 ",8,gn)])])])):x("",!0)}}}),pn=P(vn,[["__scopeId","data-v-7b9356bb"]]),_n={class:"modal-content"},mn={class:"file-upload"},bn={key:0,class:"file-name"},fn={class:"modal-actions"},wn=["disabled"],yn=A({__name:"SettingsImportModal",props:{visible:{type:Boolean}},emits:["close","import"],setup(h,{emit:I}){const v=I,p=C(null);function s(){p.value={name:"settings_export.json"}}function l(){v("close"),p.value=null}function o(){p.value&&(v("import",{version:"1.0",categories:["general","security"],settings:{}}),l())}return(i,t)=>i.visible?(c(),u("view",{key:0,class:"modal-overlay",onClick:l},[e("view",{class:"modal-container",onClick:t[0]||(t[0]=oe(()=>{},["stop"]))},[e("view",{class:"modal-header"},[t[1]||(t[1]=e("text",{class:"modal-title"},"导入设置",-1)),e("button",{class:"close-btn",onClick:l},"×")]),e("view",_n,[t[3]||(t[3]=e("text",{class:"modal-description"}," 选择要导入的设置文件，系统将验证文件格式并导入配置。 ",-1)),e("view",mn,[e("button",{class:"upload-btn",onClick:s},t[2]||(t[2]=[e("text",null,"选择文件",-1)])),p.value?(c(),u("text",bn,y(p.value.name),1)):x("",!0)])]),e("view",fn,[e("button",{class:"modal-btn secondary",onClick:l},"取消"),e("button",{class:"modal-btn primary",onClick:o,disabled:!p.value}," 导入设置 ",8,wn)])])])):x("",!0)}}),kn=P(yn,[["__scopeId","data-v-3fe3c091"]]),xn={class:"modal-content"},hn={class:"modal-description"},$n={class:"history-list"},Sn={key:0,class:"empty-state"},Cn={class:"history-content"},In={class:"history-action"},Tn={class:"history-details"},En={class:"history-time"},Mn=A({__name:"SettingsHistoryModal",props:{visible:{type:Boolean},history:{},category:{}},emits:["close"],setup(h,{emit:I}){const v=I;function p(o){return{general:"常规设置",business:"业务规则",security:"安全设置",notification:"通知设置",integration:"集成设置",appearance:"外观设置",backup:"备份设置",maintenance:"维护设置"}[o]||o}function s(o){return new Date(o).toLocaleString("zh-CN")}function l(){v("close")}return(o,i)=>o.visible?(c(),u("view",{key:0,class:"modal-overlay",onClick:l},[e("view",{class:"modal-container",onClick:i[0]||(i[0]=oe(()=>{},["stop"]))},[e("view",{class:"modal-header"},[i[1]||(i[1]=e("text",{class:"modal-title"},"变更历史",-1)),e("button",{class:"close-btn",onClick:l},"×")]),e("view",xn,[e("text",hn," 查看 "+y(p(o.category))+" 的设置变更历史记录 ",1),e("view",$n,[o.history.length===0?(c(),u("view",Sn,i[2]||(i[2]=[e("text",null,"暂无变更记录",-1)]))):(c(!0),u(L,{key:1},j(o.history,t=>(c(),u("view",{key:t.id,class:"history-item"},[e("view",Cn,[e("text",In,y(t.action),1),e("text",Tn,y(t.details),1),e("text",En,y(s(t.created_at)),1)])]))),128))])]),e("view",{class:"modal-actions"},[e("button",{class:"modal-btn primary",onClick:l},"关闭")])])])):x("",!0)}}),Dn=P(Mn,[["__scopeId","data-v-d1d191e8"]]),On={class:"dialog-header"},Un={class:"dialog-title"},Bn={class:"dialog-content"},An={key:0,class:"dialog-icon"},Pn={class:"dialog-message"},Vn={class:"message-text"},zn={key:0,class:"message-details"},Rn={class:"dialog-actions"},Hn=["disabled"],Nn=A({__name:"ConfirmDialog",props:{visible:{type:Boolean},title:{},message:{},details:{},confirmText:{default:"确认"},cancelText:{default:"取消"},loadingText:{default:"处理中..."},type:{default:"default"},icon:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},closeOnOverlay:{type:Boolean,default:!0}},emits:["confirm","cancel"],setup(h,{emit:I}){const v=h,p=I,s=z(()=>`btn-${v.type}`),l=z(()=>`icon icon-${v.type}`),o=z(()=>{const f={default:"?",danger:"⚠",warning:"⚠",info:"ℹ",success:"✓"};return f[v.type]||f.default});function i(){v.loading||p("confirm")}function t(){p("cancel")}function n(){v.closeOnOverlay&&t()}return(f,a)=>f.visible?(c(),u("view",{key:0,class:"confirm-dialog-overlay",onClick:n},[e("view",{class:"confirm-dialog",onClick:a[0]||(a[0]=oe(()=>{},["stop"]))},[e("view",On,[e("text",Un,y(f.title),1),e("button",{class:"close-btn",onClick:t},a[1]||(a[1]=[e("text",null,"×",-1)]))]),e("view",Bn,[f.icon?(c(),u("view",An,[e("text",{class:F(l.value)},y(o.value),3)])):x("",!0),e("view",Pn,[e("text",Vn,y(f.message),1),f.details?(c(),u("view",zn,[(c(!0),u(L,null,j(f.details,D=>(c(),u("text",{key:D,class:"detail-item"},y(D),1))),128))])):x("",!0)])]),e("view",Rn,[e("button",{class:"dialog-btn cancel-btn",onClick:t},[e("text",null,y(f.cancelText),1)]),e("button",{class:F(["dialog-btn confirm-btn",s.value]),onClick:i,disabled:f.loading},[e("text",null,y(f.loading?f.loadingText:f.confirmText),1)],10,Hn)])])])):x("",!0)}}),Fn=P(Nn,[["__scopeId","data-v-3e05a90a"]]),qn={class:"help-icon"},Ln={key:0,class:"tooltip-header"},jn={class:"tooltip-title"},Gn={class:"tooltip-body"},Yn={key:0,class:"tooltip-text"},Wn={key:1,class:"best-practices"},Jn={class:"practices-list"},Qn={key:2,class:"warning-section"},Xn={class:"warning-text"},Zn={key:3,class:"related-settings"},Kn={class:"related-list"},ei=["onClick"],ti={class:"related-label"},si={key:4,class:"tooltip-actions"},ni=A({__name:"SettingsHelpTooltip",props:{title:{},content:{},position:{default:"bottom"},theme:{default:"default"},icon:{default:"?"},showOnHover:{type:Boolean,default:!1},bestPractices:{},warning:{},relatedSettings:{},showActions:{type:Boolean,default:!1}},emits:["navigate","reset-default","apply-recommended"],setup(h,{emit:I}){const v=C(!1);function p(){v.value=!v.value}function s(){v.value=!1}return(l,o)=>(c(),u("view",{class:F(["settings-help-tooltip",{show:v.value}])},[e("button",{class:"help-trigger",onClick:p,onMouseenter:o[0]||(o[0]=i=>l.showOnHover&&(v.value=!0)),onMouseleave:o[1]||(o[1]=i=>l.showOnHover&&(v.value=!1))},[e("text",qn,y(l.icon),1)],32),v.value?(c(),u("view",{key:0,class:F(["tooltip-content",[`position-${l.position}`,`theme-${l.theme}`]])},[l.title?(c(),u("view",Ln,[e("text",jn,y(l.title),1),e("button",{class:"close-btn",onClick:s},o[4]||(o[4]=[e("text",null,"✕",-1)]))])):x("",!0),e("view",Gn,[l.content?(c(),u("text",Yn,y(l.content),1)):x("",!0),l.bestPractices&&l.bestPractices.length>0?(c(),u("view",Wn,[o[5]||(o[5]=e("text",{class:"section-title"},"💡 最佳实践：",-1)),e("view",Jn,[(c(!0),u(L,null,j(l.bestPractices,(i,t)=>(c(),u("text",{key:t,class:"practice-item"}," • "+y(i),1))),128))])])):x("",!0),l.warning?(c(),u("view",Qn,[o[6]||(o[6]=e("text",{class:"warning-title"},"⚠️ 注意：",-1)),e("text",Xn,y(l.warning),1)])):x("",!0),l.relatedSettings&&l.relatedSettings.length>0?(c(),u("view",Zn,[o[8]||(o[8]=e("text",{class:"section-title"},"🔗 相关设置：",-1)),e("view",Kn,[(c(!0),u(L,null,j(l.relatedSettings,i=>(c(),u("button",{key:i.key,class:"related-item",onClick:t=>l.$emit("navigate",i.key)},[e("text",ti,y(i.label),1),o[7]||(o[7]=e("text",{class:"related-arrow"},"→",-1))],8,ei))),128))])])):x("",!0),l.showActions?(c(),u("view",si,[e("button",{class:"action-btn secondary",onClick:o[2]||(o[2]=i=>l.$emit("reset-default"))},"重置默认值"),e("button",{class:"action-btn primary",onClick:o[3]||(o[3]=i=>l.$emit("apply-recommended"))}," 应用推荐设置 ")])):x("",!0)])],2)):x("",!0),v.value&&!l.showOnHover?(c(),u("view",{key:1,class:"tooltip-backdrop",onClick:s})):x("",!0)],2))}}),ii=P(ni,[["__scopeId","data-v-4504fdee"]]),oi={class:"settings-validation-feedback"},ai={class:"feedback-content"},li={key:0,class:"feedback-message"},ri={class:"feedback-content"},ui={class:"feedback-message"},ci={key:0,class:"error-details"},di={class:"details-list"},gi={class:"feedback-actions"},vi={class:"feedback-content"},pi={class:"feedback-message"},_i={key:0,class:"warning-suggestions"},mi={class:"suggestions-list"},bi=["onClick"],fi={class:"suggestion-text"},wi={class:"feedback-content"},yi={class:"feedback-message"},ki={key:0,class:"additional-info"},xi={class:"additional-text"},hi={key:5,class:"field-errors"},$i={class:"field-errors-list"},Si={class:"field-name"},Ci={class:"field-error-messages"},Ii={class:"progress-header"},Ti={class:"progress-title"},Ei={class:"progress-stats"},Mi={class:"progress-bar-container"},Di={key:0,class:"progress-message"},Oi=A({__name:"SettingsValidationFeedback",props:{state:{},visible:{type:Boolean,default:!0},dismissible:{type:Boolean,default:!0},autoHide:{default:0},successMessage:{},errorMessage:{},warningMessage:{},infoMessage:{},additionalInfo:{},errorDetails:{},fieldErrors:{},suggestions:{},showProgress:{type:Boolean},progressTitle:{},progressMessage:{},progressCurrent:{default:0},progressTotal:{default:100}},emits:["dismiss","retry","apply-suggestion"],setup(h,{emit:I}){const v=h,p=I,s=C(v.visible),l=z(()=>v.progressTotal===0?0:Math.round(v.progressCurrent/v.progressTotal*100));G(()=>v.visible,t=>{s.value=t,t&&v.autoHide>0&&setTimeout(()=>{v.dismissible&&o()},v.autoHide)});function o(){s.value=!1,p("dismiss")}function i(t){return{email:"邮箱地址",password:"密码",phone:"电话号码",company_name:"公司名称",api_key:"API密钥",webhook_url:"Webhook地址",max_file_size:"文件大小限制",session_timeout:"会话超时时间",backup_frequency:"备份频率",notification_email:"通知邮箱"}[t]||t}return(t,n)=>(c(),u("view",oi,[t.state==="success"?(c(),u("view",{key:0,class:F(["feedback-container success",{show:t.visible}])},[n[3]||(n[3]=e("view",{class:"feedback-icon"},[e("text",null,"✓")],-1)),e("view",ai,[n[1]||(n[1]=e("text",{class:"feedback-title"},"设置已保存",-1)),t.successMessage?(c(),u("text",li,y(t.successMessage),1)):x("",!0)]),t.dismissible?(c(),u("button",{key:0,class:"feedback-close",onClick:o},n[2]||(n[2]=[e("text",null,"✕",-1)]))):x("",!0)],2)):x("",!0),t.state==="error"?(c(),u("view",{key:1,class:F(["feedback-container error",{show:t.visible}])},[n[8]||(n[8]=e("view",{class:"feedback-icon"},[e("text",null,"✕")],-1)),e("view",ri,[n[5]||(n[5]=e("text",{class:"feedback-title"},"保存失败",-1)),e("text",ui,y(t.errorMessage||"请检查输入内容并重试"),1),t.errorDetails&&t.errorDetails.length>0?(c(),u("view",ci,[n[4]||(n[4]=e("text",{class:"details-title"},"详细信息：",-1)),e("view",di,[(c(!0),u(L,null,j(t.errorDetails,(f,a)=>(c(),u("text",{key:a,class:"detail-item"}," • "+y(f),1))),128))])])):x("",!0)]),e("view",gi,[e("button",{class:"action-btn retry",onClick:n[0]||(n[0]=f=>t.$emit("retry"))},n[6]||(n[6]=[e("text",null,"重试",-1)])),t.dismissible?(c(),u("button",{key:0,class:"action-btn dismiss",onClick:o},n[7]||(n[7]=[e("text",null,"✕",-1)]))):x("",!0)])],2)):x("",!0),t.state==="warning"?(c(),u("view",{key:2,class:F(["feedback-container warning",{show:t.visible}])},[n[13]||(n[13]=e("view",{class:"feedback-icon"},[e("text",null,"⚠")],-1)),e("view",vi,[n[11]||(n[11]=e("text",{class:"feedback-title"},"需要注意",-1)),e("text",pi,y(t.warningMessage),1),t.suggestions&&t.suggestions.length>0?(c(),u("view",_i,[n[10]||(n[10]=e("text",{class:"suggestions-title"},"建议：",-1)),e("view",mi,[(c(!0),u(L,null,j(t.suggestions,(f,a)=>(c(),u("button",{key:a,class:"suggestion-item",onClick:D=>t.$emit("apply-suggestion",f.action)},[e("text",fi,y(f.text),1),n[9]||(n[9]=e("text",{class:"suggestion-arrow"},"→",-1))],8,bi))),128))])])):x("",!0)]),t.dismissible?(c(),u("button",{key:0,class:"feedback-close",onClick:o},n[12]||(n[12]=[e("text",null,"✕",-1)]))):x("",!0)],2)):x("",!0),t.state==="validating"?(c(),u("view",{key:3,class:F(["feedback-container validating",{show:t.visible}])},n[14]||(n[14]=[Fe('<view class="feedback-icon" data-v-d828ae04><view class="loading-spinner" data-v-d828ae04></view></view><view class="feedback-content" data-v-d828ae04><text class="feedback-title" data-v-d828ae04>验证中...</text><text class="feedback-message" data-v-d828ae04>正在检查设置的有效性</text></view>',2)]),2)):x("",!0),t.state==="info"?(c(),u("view",{key:4,class:F(["feedback-container info",{show:t.visible}])},[n[17]||(n[17]=e("view",{class:"feedback-icon"},[e("text",null,"ℹ")],-1)),e("view",wi,[n[15]||(n[15]=e("text",{class:"feedback-title"},"信息提示",-1)),e("text",yi,y(t.infoMessage),1),t.additionalInfo?(c(),u("view",ki,[e("text",xi,y(t.additionalInfo),1)])):x("",!0)]),t.dismissible?(c(),u("button",{key:0,class:"feedback-close",onClick:o},n[16]||(n[16]=[e("text",null,"✕",-1)]))):x("",!0)],2)):x("",!0),t.fieldErrors&&Object.keys(t.fieldErrors).length>0?(c(),u("view",hi,[n[18]||(n[18]=e("text",{class:"field-errors-title"},"请修正以下问题：",-1)),e("view",$i,[(c(!0),u(L,null,j(t.fieldErrors,(f,a)=>(c(),u("view",{key:a,class:"field-error-group"},[e("text",Si,y(i(a))+":",1),e("view",Ci,[(c(!0),u(L,null,j(Array.isArray(f)?f:[f],(D,E)=>(c(),u("text",{key:E,class:"field-error-message"}," • "+y(D),1))),128))])]))),128))])])):x("",!0),t.showProgress?(c(),u("view",{key:6,class:F(["progress-container",{show:t.visible}])},[e("view",Ii,[e("text",Ti,y(t.progressTitle||"处理中..."),1),e("text",Ei,y(t.progressCurrent)+"/"+y(t.progressTotal),1)]),e("view",Mi,[e("view",{class:"progress-bar",style:qe({width:l.value+"%"})},null,4)]),t.progressMessage?(c(),u("text",Di,y(t.progressMessage),1)):x("",!0)],2)):x("",!0)]))}}),Ui=P(Oi,[["__scopeId","data-v-d828ae04"]]),fe={general:{title:"常规设置",description:"系统基本配置和常规选项",icon:"⚙️"},business:{title:"业务规则",description:"业务流程、定价和报价规则配置",icon:"💼"},security:{title:"安全设置",description:"用户认证、权限和安全策略配置",icon:"🔒"},notification:{title:"通知设置",description:"邮件、短信和系统通知配置",icon:"🔔"},integration:{title:"集成设置",description:"第三方服务和API集成配置",icon:"🔗"},appearance:{title:"外观设置",description:"界面主题、品牌和本地化设置",icon:"🎨"},backup:{title:"备份设置",description:"数据备份和恢复策略配置",icon:"💾"},maintenance:{title:"维护设置",description:"系统维护和性能优化配置",icon:"🔧"}},Bi={class:"settings-page"},Ai={class:"page-header"},Pi={class:"header-left"},Vi={class:"page-subtitle"},zi={class:"header-actions"},Ri={class:"save-actions"},Hi=["disabled"],Ni=["disabled"],Fi={class:"settings-container"},qi={class:"settings-sidebar"},Li={class:"category-list"},ji=["onClick"],Gi={class:"category-icon"},Yi={class:"category-content"},Wi={class:"category-title"},Ji={class:"category-desc"},Qi={key:0,class:"category-indicator"},Xi={class:"settings-content"},Zi={key:0,class:"loading-container"},Ki={key:1,class:"error-container"},eo={class:"error-text"},to={key:2,class:"settings-form"},so={class:"category-header"},no={class:"category-info"},io={class:"category-icon-large"},oo={class:"category-text"},ao={class:"category-title-row"},lo={class:"category-title"},ro={class:"category-description"},uo={class:"settings-groups"},co={key:0,class:"settings-group"},go={key:1,class:"settings-group"},vo={key:2,class:"settings-group"},po={key:3,class:"settings-group"},_o={key:4,class:"settings-group"},mo={key:5,class:"settings-group"},bo={key:6,class:"settings-group"},fo={key:7,class:"settings-group"},wo={class:"settings-footer"},yo={class:"footer-info"},ko={class:"info-text"},xo={key:0,class:"unsaved-indicator"},ho={class:"footer-actions"},$o=["disabled"],So=["disabled"],Co=A({__name:"index",setup(h){const I=Ye(),{checkPermission:v}=je(),{settings:p,currentCategory:s,loading:l,saving:o,error:i,changeHistory:t,businessRules:n,securitySettings:f,notificationSettings:a,integrationSettings:D,backupSettings:E,appearanceSettings:te,currentCategorySettings:W,hasUnsavedChanges:T,categoryInfo:d,fetchSettings:q,updateSetting:O,batchUpdateSettings:ae,resetToDefaults:le,exportSettings:re,importSettings:ue,fetchChangeHistory:ce,setCurrentCategory:J}=I,Y=C(!1),Q=C(!1),X=C(!1),Z=C(!1),m=C(""),r=C(""),$=C(()=>{}),b=C({}),S=C(null),_=C({state:"hidden",visible:!1,successMessage:"",errorMessage:"",warningMessage:"",infoMessage:"",errorDetails:[],fieldErrors:{},showProgress:!1,progressCurrent:0,progressTotal:100,progressTitle:"",progressMessage:""}),R=z(()=>{const w=[...W.value].sort((g,B)=>new Date(B.updated_at).getTime()-new Date(g.updated_at).getTime())[0];return w==null?void 0:w.updated_at});function K(w){T.value?(Z.value=!0,m.value="切换分类",r.value="当前分类有未保存的更改，切换分类将丢失这些更改。确定要继续吗？",$.value=()=>{_e(),J(w),V()}):(J(w),V())}function pe(w){return Object.keys(b.value).some(g=>{const B=p.value.find(ee=>ee.key===g);return(B==null?void 0:B.category)===w})}async function V(){await q(s.value)}function U(w,g){b.value[w]=g}function ne(w,g){U(w,g)}function de(w,g){U(w,g)}function we(w,g){U(w,g)}function ye(w,g){U(w,g)}function ke(w,g){U(w,g)}function xe(w,g){U(w,g)}function he(w,g){U(w,g)}async function ge(){if(Object.keys(b.value).length!==0)try{_.value={..._.value,state:"validating",visible:!0,showProgress:!0,progressTitle:"保存设置",progressMessage:"正在验证并保存设置...",progressCurrent:30,progressTotal:100},setTimeout(()=>{_.value.progressCurrent=70,_.value.progressMessage="应用设置更改..."},500),await ae(b.value),_.value={..._.value,state:"success",visible:!0,successMessage:`成功保存 ${Object.keys(b.value).length} 项设置`,showProgress:!1,progressCurrent:100},b.value={},setTimeout(()=>{_.value.state==="success"&&(_.value.visible=!1)},3e3)}catch(w){console.error("Failed to save settings:",w),_.value={..._.value,state:"error",visible:!0,errorMessage:"设置保存失败",errorDetails:["网络连接异常，请检查网络状态","部分设置可能需要管理员权限","请重试或联系技术支持"],showProgress:!1}}}function _e(){b.value={}}function ve(){Z.value=!0,m.value="重置设置",r.value=`确定要将 ${d.value.title} 中的所有设置重置为默认值吗？此操作不可撤销。`,$.value=async()=>{await le(s.value),b.value={}}}function $e(){Y.value=!0}function Se(){Y.value=!1}async function Ce(w){try{const g=await re(w),B=`settings_export_${new Date().toISOString().split("T")[0]}.json`;uni.showToast({title:`设置已导出: ${B}`,icon:"success"}),console.log("Exported settings:",g)}catch(g){console.error("Export failed:",g)}}function Ie(){Q.value=!0}function Te(){Q.value=!1}async function Ee(w){try{const g=await ue(w);let B=`导入完成: ${g.imported_count} 项成功`;g.skipped_count>0&&(B+=`, ${g.skipped_count} 项跳过`),g.error_count>0&&(B+=`, ${g.error_count} 项失败`),uni.showToast({title:B,icon:g.success?"success":"none"}),g.errors.length>0&&console.error("Import errors:",g.errors)}catch(g){console.error("Import failed:",g)}}function Me(){ce(),X.value=!0}function De(){X.value=!1}function Oe(){$.value(),me()}function me(){Z.value=!1,m.value="",r.value="",$.value=()=>{}}function Ue(){return R.value?new Date(R.value).toLocaleString("zh-CN"):"未知"}function Be(){_.value.visible=!1}function Ae(){ge()}function be(w){switch(console.log("Apply suggestion:",w),w){case"reset-to-default":ve();break;case"apply-recommended":_.value={..._.value,state:"info",visible:!0,infoMessage:"已应用推荐设置，请检查并保存更改"};break}}function Pe(w){console.log("Navigate to setting:",w),_.value={..._.value,state:"info",visible:!0,infoMessage:`正在切换到相关设置：${w}`}}function Ve(w){return{general:"常规设置控制系统的基础行为和显示选项。这些设置会影响所有用户的体验，建议谨慎修改。",business:"业务规则设置定义了系统的核心业务逻辑，包括报价流程、审批规则、数据验证等。修改前请确保了解对业务流程的影响。",security:"安全设置是系统防护的关键配置，包括访问控制、会话管理、数据加密等。任何修改都可能影响系统安全性，请谨慎操作。",notification:"通知设置控制系统如何向用户发送消息和提醒。合理配置可以提升用户体验，避免信息过载。",integration:"集成设置管理与第三方系统的连接配置，包括API密钥、外部服务地址等。错误配置可能导致功能异常。",appearance:"外观设置控制系统的视觉表现，包括主题、布局、字体等。这些设置主要影响用户界面，相对安全。",backup:"备份设置确保数据安全，包括备份频率、存储位置、保留策略等。建议定期检查备份状态，确保数据安全。",maintenance:"维护设置控制系统的运维操作，包括日志级别、性能监控、清理策略等。这些设置影响系统性能和稳定性。"}[w]||"暂无帮助信息"}function ze(w){return{general:["修改前先备份当前设置","在测试环境验证修改效果","记录变更原因和时间"],business:["与业务团队确认规则变更","确保修改符合法规要求","建立审批变更流程"],security:["定期审查安全配置","使用强密码和双因素认证","限制管理员权限最小化原则"],notification:["避免频繁通知影响用户体验","分类设置不同优先级的通知","提供用户自定义选项"],integration:["使用环境变量管理敏感信息","定期轮换API密钥","监控集成服务状态"],appearance:["保持界面一致性","考虑不同设备的兼容性","遵循无障碍设计原则"],backup:["设置多个备份存储位置","定期测试备份恢复功能","监控备份任务执行状态"],maintenance:["设置合适的日志级别","定期清理过期日志","监控系统性能指标"]}[w]||[]}function Re(w){return{security:"⚠️ 安全设置的修改可能影响系统安全性，请确保你了解每项设置的含义，并在修改前制定回滚计划。",business:"⚠️ 业务规则的变更将直接影响用户操作流程，请务必与相关业务团队确认后再进行修改。",integration:"⚠️ 集成设置错误可能导致外部服务无法正常工作，请在修改前确认相关服务的可用性。",backup:"⚠️ 备份设置关系到数据安全，错误配置可能导致数据丢失，请谨慎操作。"}[w]}function He(w){return{security:[{key:"notification",label:"安全通知设置"},{key:"backup",label:"数据备份设置"}],business:[{key:"notification",label:"业务流程通知"},{key:"integration",label:"业务系统集成"}],integration:[{key:"security",label:"集成安全设置"},{key:"notification",label:"集成状态通知"}],backup:[{key:"security",label:"备份安全设置"},{key:"maintenance",label:"备份维护策略"}]}[w]||[]}return G(s,()=>{uni.setNavigationBarTitle({title:`系统设置 - ${d.value.title}`})}),Le(async()=>{if(!v.canPerformAction("read","settings")){uni.showToast({title:"权限不足",icon:"none"}),uni.navigateBack();return}await V()}),(w,g)=>(c(),u("view",Bi,[e("view",Ai,[e("view",Pi,[g[1]||(g[1]=e("text",{class:"page-title"},"系统设置",-1)),e("text",Vi,y(k(d).description),1)]),e("view",zi,[M(Ge),e("view",{class:"import-export-actions"},[e("button",{class:"action-btn export",onClick:$e},g[2]||(g[2]=[e("text",{class:"btn-icon"},"📤",-1),e("text",null,"导出设置",-1)])),e("button",{class:"action-btn import",onClick:Ie},g[3]||(g[3]=[e("text",{class:"btn-icon"},"📥",-1),e("text",null,"导入设置",-1)]))]),e("view",Ri,[e("button",{class:"action-btn reset",onClick:ve,disabled:k(l)||k(o)},g[4]||(g[4]=[e("text",{class:"btn-icon"},"🔄",-1),e("text",null,"重置",-1)]),8,Hi),e("button",{class:"action-btn save primary",onClick:ge,disabled:k(l)||k(o)||!k(T)},[g[5]||(g[5]=e("text",{class:"btn-icon"},"💾",-1)),e("text",null,y(k(o)?"保存中...":"保存设置"),1)],8,Ni)])])]),e("view",Fi,[e("view",qi,[g[7]||(g[7]=e("view",{class:"sidebar-header"},[e("text",{class:"sidebar-title"},"设置分类")],-1)),e("view",Li,[(c(!0),u(L,null,j(k(fe),(B,ee)=>(c(),u("view",{key:ee,class:F(["category-item",{active:k(s)===ee}]),onClick:Io=>K(ee)},[e("view",Gi,[e("text",null,y(B.icon),1)]),e("view",Yi,[e("text",Wi,y(B.title),1),e("text",Ji,y(B.description),1)]),pe(ee)?(c(),u("view",Qi,g[6]||(g[6]=[e("text",{class:"indicator-dot"},"●",-1)]))):x("",!0)],10,ji))),128))])]),e("view",Xi,[k(l)?(c(),u("view",Zi,g[8]||(g[8]=[e("text",{class:"loading-text"},"加载设置中...",-1)]))):x("",!0),k(i)?(c(),u("view",Ki,[e("text",eo,y(k(i)),1),e("button",{class:"retry-btn",onClick:V},g[9]||(g[9]=[e("text",null,"重试",-1)]))])):x("",!0),!k(l)&&!k(i)?(c(),u("view",to,[e("view",so,[e("view",no,[e("text",io,y(k(d).icon),1),e("view",oo,[e("view",ao,[e("text",lo,y(k(d).title),1),M(ii,{title:k(d).title+" 设置指南",content:Ve(k(s)),"best-practices":ze(k(s)),warning:Re(k(s)),"related-settings":He(k(s)),"show-actions":!0,theme:"info",position:"bottom",onNavigate:Pe,onResetDefault:ve,onApplyRecommended:g[0]||(g[0]=()=>be("apply-recommended"))},null,8,["title","content","best-practices","warning","related-settings"])]),e("text",ro,y(k(d).description),1)])]),e("view",{class:"category-actions"},[e("button",{class:"history-btn",onClick:Me},g[10]||(g[10]=[e("text",{class:"btn-icon"},"📋",-1),e("text",null,"变更历史",-1)]))])]),e("view",uo,[k(s)==="general"?(c(),u("view",co,[M(bt,{settings:k(W),onUpdate:U},null,8,["settings"])])):x("",!0),k(s)==="business"?(c(),u("view",go,[M(Ht,{settings:k(n),onUpdate:ne},null,8,["settings"])])):x("",!0),k(s)==="security"?(c(),u("view",vo,[M(hs,{settings:k(f),onUpdate:de},null,8,["settings"])])):x("",!0),k(s)==="notification"?(c(),u("view",po,[M(Os,{settings:k(a),onUpdate:we},null,8,["settings"])])):x("",!0),k(s)==="integration"?(c(),u("view",_o,[M(Rs,{settings:k(D),onUpdate:ye},null,8,["settings"])])):x("",!0),k(s)==="appearance"?(c(),u("view",mo,[M(Gs,{settings:k(te),onUpdate:ke},null,8,["settings"])])):x("",!0),k(s)==="backup"?(c(),u("view",bo,[M(Ks,{settings:k(E),onUpdate:xe},null,8,["settings"])])):x("",!0),k(s)==="maintenance"?(c(),u("view",fo,[M(ln,{settings:S.value,onUpdate:he},null,8,["settings"])])):x("",!0)]),e("view",wo,[e("view",yo,[e("text",ko," 最后更新: "+y(Ue()),1),k(T)?(c(),u("text",xo," 有未保存的更改 ")):x("",!0)]),e("view",ho,[e("button",{class:"footer-btn secondary",onClick:_e,disabled:!k(T)},g[11]||(g[11]=[e("text",null,"取消更改",-1)]),8,$o),e("button",{class:"footer-btn primary",onClick:ge,disabled:!k(T)||k(o)},g[12]||(g[12]=[e("text",null,"保存更改",-1)]),8,So)])])])):x("",!0)])]),M(Ui,{state:_.value.state,visible:_.value.visible,"success-message":_.value.successMessage,"error-message":_.value.errorMessage,"warning-message":_.value.warningMessage,"info-message":_.value.infoMessage,"error-details":_.value.errorDetails,"field-errors":_.value.fieldErrors,"show-progress":_.value.showProgress,"progress-current":_.value.progressCurrent,"progress-total":_.value.progressTotal,"progress-title":_.value.progressTitle,"progress-message":_.value.progressMessage,"auto-hide":3e3,onDismiss:Be,onRetry:Ae,onApplySuggestion:be},null,8,["state","visible","success-message","error-message","warning-message","info-message","error-details","field-errors","show-progress","progress-current","progress-total","progress-title","progress-message"]),M(pn,{visible:Y.value,categories:Object.keys(k(fe)),onClose:Se,onExport:Ce},null,8,["visible","categories"]),M(kn,{visible:Q.value,onClose:Te,onImport:Ee},null,8,["visible"]),M(Dn,{visible:X.value,history:k(t),category:k(s),onClose:De},null,8,["visible","history","category"]),M(Fn,{visible:Z.value,title:m.value,message:r.value,onConfirm:Oe,onCancel:me},null,8,["visible","title","message"])]))}}),Do=P(Co,[["__scopeId","data-v-7b383f39"]]);export{Do as default};
