import{d as U,i as x,c as n,a as e,b as v,t as i,F as A,f as C,g as l,n as T,r as y,h as Q,o as gt,j as m,v as kt,x as bt,k as _,p as w,z as S}from"./index.standard-DHpxIVC0.js";import{a as yt,S as g}from"./SalesButton-Bck0Vs7e.js";import{S as z,a as xt}from"./SalesSelector-Ckk41PFW.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const At={class:"sales-footer"},Ct={class:"footer-content"},$t={class:"footer-section company-section"},Tt={class:"company-name"},Dt={key:0,class:"company-slogan"},St={key:0,class:"footer-section links-section"},Nt=["onClick"],Bt={key:1,class:"footer-section contact-section"},Ft={key:0,class:"contact-item"},Pt={class:"contact-value"},It={key:1,class:"contact-item"},Mt={class:"contact-value"},Zt={class:"footer-section copyright-section"},Vt={class:"copyright-text"},qt={key:0,class:"version-text"},Qt={key:0,class:"bottom-bar"},zt=["onClick"],Lt=["src"],Ut={class:"bar-text"},Yt={key:1,class:"bar-badge"},jt=U({__name:"SalesFooter",props:{companyName:{default:"YesSales"},slogan:{default:""},showLinks:{type:Boolean,default:!1},quickLinks:{default:()=>[]},showContact:{type:Boolean,default:!1},phone:{default:""},email:{default:""},version:{default:""},showBottomBar:{type:Boolean,default:!1},bottomBarItems:{default:()=>[]},activeIndex:{default:0}},emits:["link-click","bar-item-click"],setup(j,{emit:b}){const r=b,k=x(()=>new Date().getFullYear()),f=s=>{r("link-click",s),s.page?uni.navigateTo({url:s.page}):s.url&&(window.open(s.url,"_blank"),uni.showModal({title:"提示",content:"是否打开外部链接？",success:c=>{c.confirm}}))},p=(s,c)=>{r("bar-item-click",s,c),s.page&&uni.switchTab({url:s.page,fail:()=>{uni.navigateTo({url:s.page})}})};return(s,c)=>(l(),n("view",At,[e("view",Ct,[e("view",$t,[e("text",Tt,i(s.companyName||"YesSales"),1),s.slogan?(l(),n("text",Dt,i(s.slogan),1)):v("",!0)]),s.showLinks?(l(),n("view",St,[(l(!0),n(A,null,C(s.quickLinks,u=>(l(),n("view",{key:u.text,class:"footer-link",onClick:h=>f(u)},i(u.text),9,Nt))),128))])):v("",!0),s.showContact?(l(),n("view",Bt,[s.phone?(l(),n("view",Ft,[c[0]||(c[0]=e("text",{class:"contact-label"},"电话：",-1)),e("text",Pt,i(s.phone),1)])):v("",!0),s.email?(l(),n("view",It,[c[1]||(c[1]=e("text",{class:"contact-label"},"邮箱：",-1)),e("text",Mt,i(s.email),1)])):v("",!0)])):v("",!0),e("view",Zt,[e("text",Vt," © "+i(k.value)+" "+i(s.companyName||"YesSales")+". All rights reserved. ",1),s.version?(l(),n("text",qt,"v"+i(s.version),1)):v("",!0)])]),s.showBottomBar?(l(),n("view",Qt,[(l(!0),n(A,null,C(s.bottomBarItems,(u,h)=>(l(),n("view",{key:h,class:T(["bar-item",{"bar-item--active":s.activeIndex===h}]),onClick:N=>p(u,h)},[u.icon?(l(),n("image",{key:0,class:"bar-icon",src:s.activeIndex===h&&u.activeIcon||u.icon,mode:"aspectFit"},null,8,Lt)):v("",!0),e("text",Ut,i(u.text),1),u.badge?(l(),n("view",Yt,i(u.badge),1)):v("",!0)],10,zt))),128))])):v("",!0)]))}}),Ht=Y(jt,[["__scopeId","data-v-1d6b8200"]]),Et={class:"history-page"},Kt={class:"history-content"},Rt={class:"search-section"},Gt={class:"search-bar"},Jt={class:"search-input-wrapper"},Ot={key:0,class:"active-filters"},Wt=["onClick"],Xt={class:"filter-text"},te={key:0,class:"filter-panel"},ee={class:"filter-group"},se={class:"filter-options"},oe=["onClick"],ae={class:"option-text"},ne={class:"filter-group"},le={class:"filter-options"},ie=["onClick"],ce={class:"option-text"},re={class:"filter-group"},ue={class:"amount-filter"},de={class:"filter-group"},me={class:"filter-actions"},ve={class:"stats-section"},pe={class:"stats-cards"},fe={class:"stat-card"},he={class:"stat-number"},_e={class:"stat-card"},we={class:"stat-number"},ge={class:"stat-card"},ke={class:"stat-number"},be={class:"stat-card"},ye={class:"stat-number"},xe={class:"quotes-section"},Ae={key:0,class:"loading-container"},Ce={key:1,class:"empty-container"},$e={class:"empty-text"},Te={key:2,class:"quotes-list"},De=["onClick"],Se={class:"card-header"},Ne={class:"customer-info"},Be={class:"customer-name"},Fe={class:"customer-phone"},Pe={class:"status-text"},Ie={class:"card-content"},Me={class:"quote-info"},Ze={class:"quote-number"},Ve={class:"quote-date"},qe={class:"quote-details"},Qe={class:"item-count"},ze={class:"quote-amount"},Le={class:"card-footer"},Ue={class:"validity-info"},Ye={class:"card-actions"},L=10,je=U({__name:"index",setup(j){const b=y(!0),r=y(""),k=y(!1),f=y([]),p=y(1),s=Q({status:"all",datePeriod:"all",minAmount:void 0,maxAmount:void 0,sortBy:"createdAt_desc"}),c=Q({total:0,thisMonth:0,pending:0,totalAmount:0}),u=[{value:"all",label:"全部状态"},{value:"draft",label:"草稿"},{value:"sent",label:"已发送"},{value:"approved",label:"已确认"},{value:"rejected",label:"已拒绝"}],h=[{value:"all",label:"全部时间"},{value:"today",label:"今天"},{value:"week",label:"本周"},{value:"month",label:"本月"},{value:"quarter",label:"本季度"}],N=[{value:"createdAt_desc",label:"创建时间 (新到旧)"},{value:"createdAt_asc",label:"创建时间 (旧到新)"},{value:"amount_desc",label:"金额 (高到低)"},{value:"amount_asc",label:"金额 (低到高)"},{value:"customer_asc",label:"客户姓名 (A-Z)"}],H=y([{text:"首页",icon:"/static/icons/home.png",activeIcon:"/static/icons/home-active.png",page:"/pages/sales/index"},{text:"新建报价",icon:"/static/icons/create.png",activeIcon:"/static/icons/create-active.png",page:"/pages/sales/quote/create"},{text:"我的报价",icon:"/static/icons/quotes.png",activeIcon:"/static/icons/quotes-active.png",page:"/pages/sales/history/index"},{text:"我的",icon:"/static/icons/profile.png",activeIcon:"/static/icons/profile-active.png",page:"/pages/sales/profile/index"}]),D=x(()=>{let o=[...f.value];if(r.value){const t=r.value.toLowerCase();o=o.filter(a=>a.customerName.toLowerCase().includes(t)||a.quoteNumber.toLowerCase().includes(t)||a.customerPhone.includes(t))}if(s.status!=="all"&&(o=o.filter(t=>t.status===s.status)),s.datePeriod!=="all"){const t=dt(s.datePeriod);o=o.filter(a=>new Date(a.createdAt)>=t)}return s.minAmount!==void 0&&(o=o.filter(t=>t.totalAmount>=s.minAmount)),s.maxAmount!==void 0&&(o=o.filter(t=>t.totalAmount<=s.maxAmount)),o.sort((t,a)=>{const[d,wt]=s.sortBy.split("_");let $=0;switch(d){case"createdAt":$=new Date(t.createdAt).getTime()-new Date(a.createdAt).getTime();break;case"amount":$=t.totalAmount-a.totalAmount;break;case"customer":$=t.customerName.localeCompare(a.customerName);break}return wt==="desc"?-$:$}),o}),E=x(()=>D.value.slice(0,p.value*L)),K=x(()=>D.value.length>p.value*L),R=x(()=>s.status!=="all"||s.datePeriod!=="all"||s.minAmount!==void 0||s.maxAmount!==void 0||r.value!==""),G=x(()=>{const o=[];if(r.value&&o.push({key:"search",label:`搜索: ${r.value}`}),s.status!=="all"){const t=u.find(a=>a.value===s.status);o.push({key:"status",label:`状态: ${t==null?void 0:t.label}`})}if(s.datePeriod!=="all"){const t=h.find(a=>a.value===s.datePeriod);o.push({key:"date",label:`时间: ${t==null?void 0:t.label}`})}if(s.minAmount!==void 0||s.maxAmount!==void 0){const t=s.minAmount||0,a=s.maxAmount||"无限";o.push({key:"amount",label:`金额: ¥${t} - ¥${a}`})}return o});gt(()=>{J(),B()});const J=async()=>{try{b.value=!0,await new Promise(t=>setTimeout(t,800));const o=[{id:"1",quoteNumber:"YS-20241206-0001",customerName:"张先生",customerPhone:"13800138000",status:"sent",totalAmount:19586.25,itemCount:2,createdAt:"2024-12-06T10:30:00Z",updatedAt:"2024-12-06T10:30:00Z",validUntil:"2025-01-05T10:30:00Z"},{id:"2",quoteNumber:"YS-20241205-0002",customerName:"李女士",customerPhone:"13900139000",status:"approved",totalAmount:8500,itemCount:1,createdAt:"2024-12-05T14:20:00Z",updatedAt:"2024-12-05T16:45:00Z",validUntil:"2025-01-04T14:20:00Z"},{id:"3",quoteNumber:"YS-20241204-0003",customerName:"王总",customerPhone:"13700137000",status:"draft",totalAmount:35600,itemCount:5,createdAt:"2024-12-04T09:15:00Z",updatedAt:"2024-12-04T09:15:00Z",validUntil:"2025-01-03T09:15:00Z"},{id:"4",quoteNumber:"YS-20241203-0004",customerName:"陈经理",customerPhone:"13600136000",status:"rejected",totalAmount:12800,itemCount:3,createdAt:"2024-12-03T16:45:00Z",updatedAt:"2024-12-03T18:20:00Z",validUntil:"2025-01-02T16:45:00Z"},{id:"5",quoteNumber:"YS-20241202-0005",customerName:"刘俱乐部",customerPhone:"13500135000",status:"approved",totalAmount:68900,itemCount:8,createdAt:"2024-12-02T11:30:00Z",updatedAt:"2024-12-02T13:15:00Z",validUntil:"2025-01-01T11:30:00Z"}];f.value=o}catch(o){console.error("Failed to load quotes:",o),uni.showToast({title:"加载失败，请重试",icon:"none"})}finally{b.value=!1}},B=async()=>{try{c.total=f.value.length,c.pending=f.value.filter(t=>t.status==="sent").length,c.totalAmount=f.value.reduce((t,a)=>t+a.totalAmount,0);const o=new Date;o.setDate(1),o.setHours(0,0,0,0),c.thisMonth=f.value.filter(t=>new Date(t.createdAt)>=o).length}catch(o){console.error("Failed to load stats:",o)}},O=()=>{p.value=1},W=()=>{r.value="",p.value=1},X=()=>{k.value=!k.value},tt=o=>{s.status=o},et=o=>{s.datePeriod=o},F=()=>{p.value=1},st=()=>{p.value=1},P=()=>{s.status="all",s.datePeriod="all",s.minAmount=void 0,s.maxAmount=void 0,s.sortBy="createdAt_desc",r.value="",p.value=1},ot=()=>{k.value=!1,p.value=1},at=o=>{switch(o){case"search":r.value="";break;case"status":s.status="all";break;case"date":s.datePeriod="all";break;case"amount":s.minAmount=void 0,s.maxAmount=void 0;break}p.value=1},nt=()=>{P()},lt=()=>{p.value++},it=o=>new Date(o).toLocaleDateString("zh-CN"),I=o=>o.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","),ct=o=>({draft:"草稿",sent:"已发送",approved:"已确认",rejected:"已拒绝"})[o]||"未知",rt=o=>new Date(o)<new Date,ut=o=>{const t=new Date(o),a=new Date;if(t<a)return"已过期";const d=Math.ceil((t.getTime()-a.getTime())/(1e3*60*60*24));return d<=3?`${d}天后过期`:`有效至${t.toLocaleDateString("zh-CN")}`},dt=o=>{const t=new Date;switch(o){case"today":return new Date(t.setHours(0,0,0,0));case"week":return new Date(t.setDate(t.getDate()-7));case"month":return new Date(t.setMonth(t.getMonth()-1));case"quarter":return new Date(t.setMonth(t.getMonth()-3));default:return new Date(0)}},M=()=>{uni.navigateTo({url:"/pages/sales/quote/create"})},mt=o=>{uni.navigateTo({url:`/pages/sales/quote/preview?id=${o.id}`})},vt=o=>{uni.navigateTo({url:`/pages/sales/quote/create?id=${o.id}&mode=edit`})},pt=o=>{uni.navigateTo({url:`/pages/sales/quote/create?id=${o.id}&mode=duplicate`})},ft=o=>{const t=["删除报价","分享报价","导出PDF"];o.status==="draft"&&t.unshift("发送给客户"),uni.showActionSheet({itemList:t,success:a=>{switch(a.tapIndex){case 0:o.status==="draft"?ht():q(o);break;case 1:o.status,Z();break;case 2:o.status,V();break;case 3:q(o);break}}})},ht=o=>{uni.showToast({title:"发送功能开发中",icon:"none"})},Z=o=>{uni.showToast({title:"分享功能开发中",icon:"none"})},V=o=>{uni.showToast({title:"导出功能开发中",icon:"none"})},q=o=>{uni.showModal({title:"删除确认",content:"确定要删除这个报价单吗？此操作不可恢复。",success:t=>{if(t.confirm){const a=f.value.findIndex(d=>d.id===o.id);a>-1&&(f.value.splice(a,1),uni.showToast({title:"删除成功",icon:"success"}),B())}}})},_t=(o,t)=>{t!==2&&uni.switchTab({url:o.page,fail:()=>{uni.navigateTo({url:o.page,fail:()=>{uni.showToast({title:"页面开发中",icon:"none"})}})}})};return(o,t)=>(l(),n("view",Et,[m(yt,{title:"我的报价","show-back":!1,fixed:!0}),e("view",Kt,[e("view",Rt,[e("view",Gt,[e("view",Jt,[t[5]||(t[5]=e("text",{class:"search-icon"},"🔍",-1)),kt(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),class:"search-input",placeholder:"搜索客户姓名、报价单号或产品",onInput:O},null,544),[[bt,r.value]]),r.value?(l(),n("view",{key:0,class:"clear-search",onClick:W},t[4]||(t[4]=[e("text",{class:"clear-icon"},"×",-1)]))):v("",!0)]),m(g,{size:"small",type:k.value?"primary":"default",onClick:X},{default:_(()=>t[6]||(t[6]=[w(" 筛选 ",-1)])),_:1,__:[6]},8,["type"])]),R.value?(l(),n("view",Ot,[(l(!0),n(A,null,C(G.value,a=>(l(),n("view",{key:a.key,class:"filter-chip",onClick:d=>at(a.key)},[e("text",Xt,i(a.label),1),t[7]||(t[7]=e("text",{class:"filter-remove"},"×",-1))],8,Wt))),128)),m(g,{size:"mini",type:"plain",onClick:nt},{default:_(()=>t[8]||(t[8]=[w(" 清除全部 ",-1)])),_:1,__:[8]})])):v("",!0)]),k.value?(l(),n("view",te,[e("view",ee,[t[9]||(t[9]=e("text",{class:"filter-title"},"报价状态",-1)),e("view",se,[(l(),n(A,null,C(u,a=>e("view",{key:a.value,class:T(["filter-option",{"filter-option--active":s.status===a.value}]),onClick:d=>tt(a.value)},[e("text",ae,i(a.label),1)],10,oe)),64))])]),e("view",ne,[t[10]||(t[10]=e("text",{class:"filter-title"},"创建时间",-1)),e("view",le,[(l(),n(A,null,C(h,a=>e("view",{key:a.value,class:T(["filter-option",{"filter-option--active":s.datePeriod===a.value}]),onClick:d=>et(a.value)},[e("text",ce,i(a.label),1)],10,ie)),64))])]),e("view",re,[t[12]||(t[12]=e("text",{class:"filter-title"},"报价金额",-1)),e("view",ue,[m(z,{modelValue:s.minAmount,"onUpdate:modelValue":t[1]||(t[1]=a=>s.minAmount=a),modelModifiers:{number:!0},placeholder:"最低金额",type:"number",size:"small",onInput:F},null,8,["modelValue"]),t[11]||(t[11]=e("text",{class:"amount-separator"},"-",-1)),m(z,{modelValue:s.maxAmount,"onUpdate:modelValue":t[2]||(t[2]=a=>s.maxAmount=a),modelModifiers:{number:!0},placeholder:"最高金额",type:"number",size:"small",onInput:F},null,8,["modelValue"])])]),e("view",de,[t[13]||(t[13]=e("text",{class:"filter-title"},"排序方式",-1)),m(xt,{modelValue:s.sortBy,"onUpdate:modelValue":t[3]||(t[3]=a=>s.sortBy=a),options:N,onChange:st},null,8,["modelValue"])]),e("view",me,[m(g,{type:"default",onClick:P},{default:_(()=>t[14]||(t[14]=[w("重置",-1)])),_:1,__:[14]}),m(g,{type:"primary",onClick:ot},{default:_(()=>t[15]||(t[15]=[w("应用筛选",-1)])),_:1,__:[15]})])])):v("",!0),e("view",ve,[e("view",pe,[e("view",fe,[e("text",he,i(c.total),1),t[16]||(t[16]=e("text",{class:"stat-label"},"总报价单",-1))]),e("view",_e,[e("text",we,i(c.thisMonth),1),t[17]||(t[17]=e("text",{class:"stat-label"},"本月新增",-1))]),e("view",ge,[e("text",ke,i(c.pending),1),t[18]||(t[18]=e("text",{class:"stat-label"},"待确认",-1))]),e("view",be,[e("text",ye,"¥"+i(I(c.totalAmount)),1),t[19]||(t[19]=e("text",{class:"stat-label"},"总金额",-1))])])]),e("view",xe,[b.value?(l(),n("view",Ae,t[20]||(t[20]=[e("view",{class:"loading-spinner"},null,-1),e("text",{class:"loading-text"},"加载中...",-1)]))):D.value.length===0?(l(),n("view",Ce,[t[21]||(t[21]=e("image",{class:"empty-icon",src:"/static/images/empty-quotes.png",mode:"aspectFit"},null,-1)),e("text",$e,i(r.value?"未找到相关报价单":"暂无报价单"),1),m(g,{type:"primary",onClick:M},{default:_(()=>[w(i(r.value?"新建报价":"创建第一个报价"),1)]),_:1})])):(l(),n("view",Te,[(l(!0),n(A,null,C(E.value,a=>(l(),n("view",{key:a.id,class:"quote-card",onClick:d=>mt(a)},[e("view",Se,[e("view",Ne,[e("text",Be,i(a.customerName),1),e("text",Fe,i(a.customerPhone),1)]),e("view",{class:T(["quote-status",`status-${a.status}`])},[e("text",Pe,i(ct(a.status)),1)],2)]),e("view",Ie,[e("view",Me,[e("text",Ze,i(a.quoteNumber),1),e("text",Ve,i(it(a.createdAt)),1)]),e("view",qe,[e("text",Qe,i(a.itemCount)+" 种产品",1),e("text",ze,"¥"+i(I(a.totalAmount)),1)])]),e("view",Le,[e("view",Ue,[e("text",{class:T(["validity-text",{"validity-expired":rt(a.validUntil)}])},i(ut(a.validUntil)),3)]),e("view",Ye,[m(g,{size:"mini",type:"plain",onClick:S(d=>vt(a),["stop"])},{default:_(()=>t[22]||(t[22]=[w(" 编辑 ",-1)])),_:2,__:[22]},1032,["onClick"]),m(g,{size:"mini",type:"plain",onClick:S(d=>pt(a),["stop"])},{default:_(()=>t[23]||(t[23]=[w(" 复制 ",-1)])),_:2,__:[23]},1032,["onClick"]),m(g,{size:"mini",type:"plain",onClick:S(d=>ft(a),["stop"])},{default:_(()=>t[24]||(t[24]=[w(" 更多 ",-1)])),_:2,__:[24]},1032,["onClick"])])])],8,De))),128))])),K.value&&!b.value?(l(),n("view",{key:3,class:"load-more",onClick:lt},t[25]||(t[25]=[e("text",{class:"load-more-text"},"加载更多",-1)]))):v("",!0)])]),e("view",{class:"fab",onClick:M},t[26]||(t[26]=[e("text",{class:"fab-icon"},"+",-1)])),m(Ht,{"company-name":"耶氏台球斗南销售中心",slogan:"专业台球设备供应商","show-contact":!0,phone:"400-888-8888","show-bottom-bar":!0,"bottom-bar-items":H.value,"active-index":2,onBarItemClick:_t},null,8,["bottom-bar-items"])]))}}),Ge=Y(je,[["__scopeId","data-v-ad658f9a"]]);export{Ge as default};
