import{d as ie,r as g,i as L,w as we,c as o,b as C,a as e,J as j,t as c,j as x,y as K,k as _,g as i,F as W,f as Y,A as ne,n as M,z as oe,N as be,o as _e,G as D,p as ee,v as P,x as V,u as ke}from"./index.standard-DHpxIVC0.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $e={class:"admin-data-table"},xe={key:0,class:"table-toolbar"},Ce={class:"toolbar-left"},Se={key:0,class:"selected-count"},Ue={class:"toolbar-right"},Te={class:"table-wrapper"},ze={key:0,class:"table-loading"},Pe={key:1,class:"table-empty"},Ve={class:"empty-text"},Me={key:2,class:"table-content"},Re={class:"table"},Ae={class:"table-header"},Ie={class:"table-row"},De={key:0,class:"table-cell cell-checkbox"},Be=["onClick"],Fe={class:"cell-text"},Oe={key:0,class:"sort-icon"},Ke={key:1,class:"table-cell cell-actions"},Ne={class:"table-body"},Ee=["onMouseenter","onClick"],Le={key:0,class:"table-cell cell-checkbox"},je={class:"cell-text"},Ge={key:1,class:"table-cell cell-actions"},Je={class:"action-buttons"},Qe=["onClick"],We={key:1,class:"table-pagination"},Ye={class:"pagination-info"},qe={class:"pagination-controls"},He=["disabled"],Xe={class:"page-number"},Ze=["disabled"],et={class:"page-size-selector"},tt={class:"uni-input"},st=ie({__name:"DataTable",props:{columns:{},data:{},loading:{type:Boolean,default:!1},showSelection:{type:Boolean,default:!1},showActions:{type:Boolean,default:!0},showToolbar:{type:Boolean,default:!0},showPagination:{type:Boolean,default:!0},actions:{default:()=>[]},emptyText:{default:"暂无数据"},rowKey:{type:[String,Function],default:"id"},total:{default:0},currentPage:{default:1},pageSize:{default:20},pageSizeOptions:{default:()=>[10,20,50,100]}},emits:["update:currentPage","update:pageSize","sort-change","row-click","row-select","action-click"],setup(te,{expose:m,emit:q}){const v=te,b=q,r=g([]),w=g(null),p=g(null),B=g(-1),N=L(()=>{const s=[...v.data];return w.value&&p.value&&s.sort((n,h)=>{const T=n[w.value],I=h[w.value];return T===I?0:p.value==="asc"?T>I?1:-1:T<I?1:-1}),s}),k=L(()=>Math.ceil(v.total/v.pageSize)),F=L(()=>v.pageSizeOptions.indexOf(v.pageSize)),R=L(()=>v.data.length>0&&r.value.length===v.data.length),A=L(()=>r.value.length>0&&r.value.length<v.data.length),u=(s,n)=>typeof v.rowKey=="function"?v.rowKey(s):s[v.rowKey]||n.toString(),O=(s,n)=>{const h=s[n.key];return n.formatter?n.formatter(h,s):(h==null?void 0:h.toString())||"-"},z=s=>{const n={};return s.width&&(n.width=s.width,n.minWidth=s.width),s.align&&(n.textAlign=s.align),n},U=s=>{const n=u(s,0);return r.value.some(h=>u(h,0)===n)},G=s=>{s.detail.value?r.value=[...v.data]:r.value=[],b("row-select",r.value)},J=(s,n)=>{const h=u(s,0);n?U(s)||r.value.push(s):r.value=r.value.filter(T=>u(T,0)!==h),b("row-select",r.value)},y=s=>{s.sortable&&(w.value===s.key?p.value==="asc"?p.value="desc":p.value==="desc"&&(w.value=null,p.value=null):(w.value=s.key,p.value="asc"),b("sort-change",{key:w.value||"",order:p.value}))},H=(s,n)=>{b("row-click",s,n)},X=(s,n,h)=>{s.handler&&s.handler(n,h),b("action-click",s,n,h)},Q=s=>{b("update:currentPage",s)},Z=s=>{const n=v.pageSizeOptions[s.detail.value];b("update:pageSize",n),b("update:currentPage",1)};return we(()=>v.data,()=>{r.value=[]}),m({selectedRows:r,clearSelection:()=>{r.value=[]}}),(s,n)=>{const h=K("checkbox"),T=K("scroll-view"),I=K("picker");return i(),o("view",$e,[s.showToolbar?(i(),o("view",xe,[e("view",Ce,[j(s.$slots,"toolbar-left",{},()=>[r.value.length>0?(i(),o("text",Se," 已选择 "+c(r.value.length)+" 项 ",1)):C("",!0)])]),e("view",Ue,[j(s.$slots,"toolbar-right",{},void 0)])])):C("",!0),e("view",Te,[s.loading?(i(),o("view",ze,n[4]||(n[4]=[e("view",{class:"loading-spinner"},null,-1),e("text",{class:"loading-text"},"加载中...",-1)]))):!s.data||s.data.length===0?(i(),o("view",Pe,[n[5]||(n[5]=e("text",{class:"empty-icon"},"📋",-1)),e("text",Ve,c(s.emptyText),1),j(s.$slots,"empty",{},void 0)])):(i(),o("view",Me,[x(T,{"scroll-x":"",class:"table-scroll"},{default:_(()=>[e("view",Re,[e("view",Ae,[e("view",Ie,[s.showSelection?(i(),o("view",De,[x(h,{checked:R.value,indeterminate:A.value,onChange:G},null,8,["checked","indeterminate"])])):C("",!0),(i(!0),o(W,null,Y(s.columns,d=>(i(),o("view",{key:d.key,class:M(["table-cell",`cell-${d.key}`,{sortable:d.sortable}]),style:ne(z(d)),onClick:S=>y(d)},[e("text",Fe,c(d.title),1),d.sortable?(i(),o("view",Oe,[e("text",{class:M(["arrow","arrow-up",{active:w.value===d.key&&p.value==="asc"}])},"▲",2),e("text",{class:M(["arrow","arrow-down",{active:w.value===d.key&&p.value==="desc"}])},"▼",2)])):C("",!0)],14,Be))),128)),s.showActions?(i(),o("view",Ke,n[6]||(n[6]=[e("text",{class:"cell-text"},"操作",-1)]))):C("",!0)])]),e("view",Ne,[(i(!0),o(W,null,Y(N.value,(d,S)=>(i(),o("view",{key:u(d,S),class:M(["table-row",{selected:U(d),hover:B.value===S}]),onMouseenter:f=>B.value=S,onMouseleave:n[1]||(n[1]=f=>B.value=-1),onClick:f=>H(d,S)},[s.showSelection?(i(),o("view",Le,[x(h,{checked:U(d),onChange:f=>J(d,f.detail.value),onClick:n[0]||(n[0]=oe(()=>{},["stop"]))},null,8,["checked","onChange"])])):C("",!0),(i(!0),o(W,null,Y(s.columns,f=>(i(),o("view",{key:f.key,class:M(["table-cell",`cell-${f.key}`]),style:ne(z(f))},[j(s.$slots,`cell-${f.key}`,{row:d,column:f,index:S},()=>[e("text",je,c(O(d,f)),1)],!0)],6))),128)),s.showActions?(i(),o("view",Ge,[j(s.$slots,"actions",{row:d,index:S},()=>[e("view",Je,[(i(!0),o(W,null,Y(s.actions,f=>(i(),o("button",{key:f.key,class:M(["action-btn",`btn-${f.type||"default"}`]),onClick:oe(se=>X(f,d,S),["stop"])},c(f.label),11,Qe))),128))])],!0)])):C("",!0)],42,Ee))),128))])])]),_:3})]))]),s.showPagination&&s.total>0?(i(),o("view",We,[e("view",Ye,[e("text",null,"共 "+c(s.total)+" 条记录",1)]),e("view",qe,[e("button",{class:"page-btn",disabled:s.currentPage===1,onClick:n[2]||(n[2]=d=>Q(s.currentPage-1))}," 上一页 ",8,He),e("text",Xe,c(s.currentPage)+" / "+c(k.value),1),e("button",{class:"page-btn",disabled:s.currentPage===k.value,onClick:n[3]||(n[3]=d=>Q(s.currentPage+1))}," 下一页 ",8,Ze)]),e("view",et,[x(I,{mode:"selector",range:s.pageSizeOptions,value:F.value,onChange:Z},{default:_(()=>[e("view",tt,c(s.pageSize)+" 条/页",1)]),_:1},8,["range","value"])])])):C("",!0)])}}}),at=ye(st,[["__scopeId","data-v-00d84253"]]),lt={class:"users-page"},nt={class:"page-header"},ot={class:"header-content"},it={class:"header-stats"},ct={class:"stat-item"},rt={class:"stat-value"},ut={class:"stat-item"},dt={class:"stat-value"},vt={class:"stat-item"},pt={class:"stat-value"},ht={class:"header-actions"},ft=["loading"],mt={class:"filters-section"},gt={class:"filters-row"},wt={class:"filter-item"},bt={class:"filter-item"},_t={class:"filter-picker"},kt={class:"filter-item"},yt={class:"filter-picker"},$t={class:"filter-item"},xt={class:"user-cell"},Ct={class:"user-avatar"},St=["src"],Ut={key:1,class:"avatar-placeholder"},Tt={class:"user-info"},zt={class:"user-name"},Pt={class:"user-email"},Vt={key:0,class:"user-phone"},Mt={class:"department-cell"},Rt={class:"date-cell"},At={class:"date-cell"},It={class:"actions-cell"},Dt=["onClick"],Bt=["onClick"],Ft=["onClick"],Ot=["onClick"],Kt=["onClick"],Nt=["onClick"],Et={class:"user-form"},Lt={class:"form-item"},jt={class:"form-item"},Gt={class:"form-item"},Jt={class:"form-item"},Qt={class:"form-picker"},Wt={class:"form-item"},Yt={class:"form-item"},qt={class:"form-checkbox"},Ht={class:"invite-form"},Xt={class:"form-item"},Zt={class:"form-item"},es={class:"form-picker"},as=ie({__name:"index",setup(te){ke();const m=be(),q=[{key:"user",title:"用户",width:"250px"},{key:"role",title:"角色",width:"120px",align:"center"},{key:"status",title:"状态",width:"100px",align:"center"},{key:"department",title:"部门",width:"120px"},{key:"last_login",title:"最后登录",width:"150px",sortable:!0},{key:"created_at",title:"创建时间",width:"150px",sortable:!0},{key:"actions",title:"操作",width:"250px",align:"center"}],v=g(""),b=g(""),r=g(0),w=g(0),p=g(1),B=g(20),N=g(!1),k=[{value:"",label:"全部角色"},{value:"admin",label:"系统管理员"},{value:"sales_manager",label:"销售经理"},{value:"sales_rep",label:"销售代表"},{value:"viewer",label:"查看者"}],F=[{value:"",label:"全部状态"},{value:"active",label:"活跃"},{value:"inactive",label:"停用"},{value:"pending",label:"待激活"},{value:"suspended",label:"暂停"}],R=g(!1),A=g(!1),u=g({email:"",name:"",role:"viewer",phone:"",department:"",position:"",send_invite:!0}),O=g(3),z=g(""),U=g(3);_e(()=>{y()});let G;const J=()=>{clearTimeout(G),G=setTimeout(()=>{p.value=1,y()},500)};async function y(){const l={page:p.value,pageSize:B.value};v.value&&(l.search=v.value),b.value&&(l.department=b.value);const t=k[r.value].value;t&&(l.role=t);const $=F[w.value].value;$&&(l.status=$),await m.fetchUsers(l)}function H(l){r.value=l.detail.value,p.value=1,y()}function X(l){w.value=l.detail.value,p.value=1,y()}function Q(){v.value="",b.value="",r.value=0,w.value=0,p.value=1,y()}function Z(l){p.value=l,y()}function s(l){y()}function n(l){uni.navigateTo({url:`/pages/admin/users/detail?id=${l.id}`})}function h(l){uni.navigateTo({url:`/pages/admin/users/edit?id=${l.id}`})}async function T(l){try{await m.activateUser(l.id),uni.showToast({title:"启用成功",icon:"success"}),y()}catch{uni.showToast({title:"启用失败",icon:"none"})}}async function I(l){uni.showModal({title:"确认禁用",content:`确定要禁用用户 ${l.name} 吗？`,success:async t=>{if(t.confirm)try{await m.deactivateUser(l.id),uni.showToast({title:"禁用成功",icon:"success"}),y()}catch{uni.showToast({title:"禁用失败",icon:"none"})}}})}async function d(l){uni.showModal({title:"重置密码",content:`确定要重置用户 ${l.name} 的密码吗？`,success:async t=>{if(t.confirm)try{const $=await m.resetUserPassword(l.id);uni.showModal({title:"密码重置成功",content:`临时密码：${$.temporary_password}
请通知用户尽快修改密码`,showCancel:!1})}catch{uni.showToast({title:"重置失败",icon:"none"})}}})}async function S(l){uni.showModal({title:"确认删除",content:`确定要删除用户 ${l.name} 吗？此操作不可撤销。`,success:async t=>{if(t.confirm)try{await m.deleteUser(l.id),uni.showToast({title:"删除成功",icon:"success"}),y()}catch{uni.showToast({title:"删除失败",icon:"none"})}}})}function f(){u.value={email:"",name:"",role:"viewer",phone:"",department:"",position:"",send_invite:!0},O.value=3,R.value=!0}function se(l){O.value=l.detail.value,u.value.role=k[l.detail.value+1].value}async function ce(){if(!u.value.name||!u.value.email){uni.showToast({title:"请填写必填项",icon:"none"});return}try{await m.createUser(u.value),uni.showToast({title:"添加成功",icon:"success"}),R.value=!1,y()}catch{uni.showToast({title:"添加失败",icon:"none"})}}function re(){R.value=!1}function ue(){z.value="",U.value=3,A.value=!0}function de(l){U.value=l.detail.value}async function ve(){if(!z.value){uni.showToast({title:"请输入邮箱",icon:"none"});return}const l=k[U.value+1].value;try{await m.inviteUser(z.value,l),uni.showToast({title:"邀请发送成功",icon:"success"}),A.value=!1}catch{uni.showToast({title:"邀请发送失败",icon:"none"})}}function pe(){A.value=!1}async function he(){N.value=!0;try{await m.exportUsers({role:k[r.value].value,status:F[w.value].value,search:v.value,department:b.value}),uni.showToast({title:"导出成功",icon:"success"})}catch{uni.showToast({title:"导出失败",icon:"none"})}finally{N.value=!1}}function ae(l){const t=new Date(l);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function fe(l){return{admin:"系统管理员",sales_manager:"销售经理",sales_rep:"销售代表",viewer:"查看者"}[l]||l}function me(l){return{active:"活跃",inactive:"停用",pending:"待激活",suspended:"暂停"}[l]||l}return(l,t)=>{const $=K("picker"),ge=K("checkbox"),le=K("modal");return i(),o("view",lt,[e("view",nt,[e("view",ot,[t[14]||(t[14]=e("text",{class:"page-title"},"用户管理",-1)),e("view",it,[e("text",ct,[e("text",rt,c(D(m).totalCount),1),t[11]||(t[11]=e("text",{class:"stat-label"},"总用户",-1))]),e("text",ut,[e("text",dt,c(D(m).statistics.active),1),t[12]||(t[12]=e("text",{class:"stat-label"},"活跃用户",-1))]),e("text",vt,[e("text",pt,c(D(m).statistics.admin+D(m).statistics.sales_manager),1),t[13]||(t[13]=e("text",{class:"stat-label"},"管理员",-1))])])]),e("view",ht,[e("button",{class:"action-btn add-btn",onClick:f},t[15]||(t[15]=[e("text",{class:"btn-icon"},"+",-1),ee(" 添加用户 ",-1)])),e("button",{class:"action-btn invite-btn",onClick:ue},t[16]||(t[16]=[e("text",{class:"btn-icon"},"📧",-1),ee(" 邀请用户 ",-1)])),e("button",{class:"action-btn export-btn",onClick:he,loading:N.value},t[17]||(t[17]=[e("text",{class:"btn-icon"},"📊",-1),ee(" 导出数据 ",-1)]),8,ft)])]),e("view",mt,[e("view",gt,[e("view",wt,[P(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>v.value=a),class:"search-input",placeholder:"搜索姓名、邮箱或手机号",onInput:J},null,544),[[V,v.value]])]),e("view",bt,[x($,{mode:"selector",range:k,"range-key":"label",value:r.value,onChange:H},{default:_(()=>[e("view",_t,[e("text",null,c(k[r.value].label),1),t[18]||(t[18]=e("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])]),e("view",kt,[x($,{mode:"selector",range:F,"range-key":"label",value:w.value,onChange:X},{default:_(()=>[e("view",yt,[e("text",null,c(F[w.value].label),1),t[19]||(t[19]=e("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])]),e("view",$t,[P(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>b.value=a),class:"search-input",placeholder:"部门筛选",onInput:J},null,544),[[V,b.value]])]),e("button",{class:"filter-reset",onClick:Q},"重置")])]),x(at,{columns:q,data:D(m).users,loading:D(m).loading,total:D(m).totalCount,"page-size":B.value,"current-page":p.value,"row-key":"id",onPageChange:Z,onSortChange:s},{user:_(({row:a})=>[e("view",xt,[e("view",Ct,[a.avatar?(i(),o("image",{key:0,src:a.avatar,class:"avatar-img"},null,8,St)):(i(),o("text",Ut,c(a.name.charAt(0).toUpperCase()),1))]),e("view",Tt,[e("text",zt,c(a.name),1),e("text",Pt,c(a.email),1),a.phone?(i(),o("text",Vt,c(a.phone),1)):C("",!0)])])]),role:_(({row:a})=>[e("view",{class:M(["role-badge",`role-${a.role}`])},[e("text",null,c(fe(a.role)),1)],2)]),status:_(({row:a})=>[e("view",{class:M(["status-badge",`status-${a.status}`])},[e("text",null,c(me(a.status)),1)],2)]),department:_(({row:a})=>[e("text",Mt,c(a.department||"-"),1)]),last_login:_(({row:a})=>[e("text",Rt,c(a.last_login_at?ae(a.last_login_at):"从未登录"),1)]),created_at:_(({row:a})=>[e("text",At,c(ae(a.created_at)),1)]),actions:_(({row:a})=>[e("view",It,[e("button",{class:"action-btn action-view",onClick:E=>n(a)},"查看",8,Dt),e("button",{class:"action-btn action-edit",onClick:E=>h(a)},"编辑",8,Bt),a.status==="active"?(i(),o("button",{key:0,class:"action-btn action-deactivate",onClick:E=>I(a)}," 禁用 ",8,Ft)):a.status==="inactive"?(i(),o("button",{key:1,class:"action-btn action-activate",onClick:E=>T(a)}," 启用 ",8,Ot)):C("",!0),e("button",{class:"action-btn action-reset",onClick:E=>d(a)}," 重置密码 ",8,Kt),a.role!=="admin"?(i(),o("button",{key:2,class:"action-btn action-delete",onClick:E=>S(a)}," 删除 ",8,Nt)):C("",!0)])]),_:1},8,["data","loading","total","page-size","current-page"]),x(le,{visible:R.value,"onUpdate:visible":t[8]||(t[8]=a=>R.value=a),title:"添加用户",onConfirm:ce,onCancel:re},{default:_(()=>[e("view",Et,[e("view",Lt,[t[20]||(t[20]=e("text",{class:"form-label"},"姓名 *",-1)),P(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>u.value.name=a),class:"form-input",placeholder:"请输入用户姓名"},null,512),[[V,u.value.name]])]),e("view",jt,[t[21]||(t[21]=e("text",{class:"form-label"},"邮箱 *",-1)),P(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>u.value.email=a),class:"form-input",placeholder:"请输入邮箱地址",type:"email"},null,512),[[V,u.value.email]])]),e("view",Gt,[t[22]||(t[22]=e("text",{class:"form-label"},"手机号",-1)),P(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>u.value.phone=a),class:"form-input",placeholder:"请输入手机号"},null,512),[[V,u.value.phone]])]),e("view",Jt,[t[24]||(t[24]=e("text",{class:"form-label"},"角色 *",-1)),x($,{mode:"selector",range:k.slice(1),"range-key":"label",value:O.value,onChange:se},{default:_(()=>{var a;return[e("view",Qt,[e("text",null,c(((a=k[O.value+1])==null?void 0:a.label)||"请选择角色"),1),t[23]||(t[23]=e("text",{class:"picker-arrow"},"▼",-1))])]}),_:1},8,["range","value"])]),e("view",Wt,[t[25]||(t[25]=e("text",{class:"form-label"},"部门",-1)),P(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>u.value.department=a),class:"form-input",placeholder:"请输入部门"},null,512),[[V,u.value.department]])]),e("view",Yt,[t[26]||(t[26]=e("text",{class:"form-label"},"职位",-1)),P(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>u.value.position=a),class:"form-input",placeholder:"请输入职位"},null,512),[[V,u.value.position]])]),e("view",qt,[x(ge,{modelValue:u.value.send_invite,"onUpdate:modelValue":t[7]||(t[7]=a=>u.value.send_invite=a),color:"#007AFF"},null,8,["modelValue"]),t[27]||(t[27]=e("text",{class:"checkbox-label"},"发送邀请邮件",-1))])])]),_:1},8,["visible"]),x(le,{visible:A.value,"onUpdate:visible":t[10]||(t[10]=a=>A.value=a),title:"邀请用户",onConfirm:ve,onCancel:pe},{default:_(()=>[e("view",Ht,[e("view",Xt,[t[28]||(t[28]=e("text",{class:"form-label"},"邮箱地址 *",-1)),P(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>z.value=a),class:"form-input",placeholder:"请输入邀请邮箱",type:"email"},null,512),[[V,z.value]])]),e("view",Zt,[t[30]||(t[30]=e("text",{class:"form-label"},"角色 *",-1)),x($,{mode:"selector",range:k.slice(1),"range-key":"label",value:U.value,onChange:de},{default:_(()=>{var a;return[e("view",es,[e("text",null,c(((a=k[U.value+1])==null?void 0:a.label)||"请选择角色"),1),t[29]||(t[29]=e("text",{class:"picker-arrow"},"▼",-1))])]}),_:1},8,["range","value"])]),t[31]||(t[31]=e("view",{class:"form-note"},[e("text",null,"邀请邮件将发送到指定邮箱，用户可通过邮件中的链接完成注册。")],-1))])]),_:1},8,["visible"])])}}});export{as as default};
