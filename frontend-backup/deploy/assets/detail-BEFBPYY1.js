import{d as C,I as M,r as m,o as T,E as $,c as a,b as c,j as D,a as t,t as o,n as R,e as F,F as B,f as I,k as Q,y as V,g as l,v as N,x as E,u as U}from"./index.standard-DHpxIVC0.js";const A={class:"quote-detail-page"},L={key:0,class:"loading-container"},z={key:1,class:"error-container"},H={class:"error-text"},K={key:2,class:"quote-content"},P={class:"detail-header"},Y={class:"header-info"},G={class:"quote-number"},J={class:"header-actions"},O={class:"detail-section"},W={class:"info-grid"},X={class:"info-item"},Z={class:"info-value"},tt={class:"info-item"},et={class:"info-value"},st={class:"info-item"},ot={class:"info-value"},it={class:"info-item"},at={class:"info-value"},lt={class:"info-item"},nt={class:"info-value"},ct={class:"detail-section"},ut={class:"products-table"},rt={class:"col col-product"},dt={class:"product-name"},vt={class:"product-sku"},_t={class:"col col-quantity"},mt={class:"col col-price"},xt={class:"col col-subtotal"},wt={class:"detail-section"},ft={class:"summary-grid"},pt={class:"summary-item"},yt={class:"summary-value"},bt={class:"summary-item"},ht={class:"summary-label"},gt={class:"summary-value"},kt={class:"summary-item summary-total"},jt={class:"summary-value"},qt={key:0,class:"detail-section"},St={class:"notes-content"},Ct={key:1,class:"detail-section"},Mt={class:"terms-content"},Tt={class:"detail-section"},$t={class:"timeline"},Dt={class:"timeline-item"},Rt={class:"timeline-content"},Ft={class:"timeline-date"},Bt={class:"timeline-user"},It={key:0,class:"timeline-item"},Qt={class:"timeline-content"},Vt={class:"timeline-date"},Nt={key:1,class:"timeline-item"},Et={class:"timeline-content"},Ut={class:"timeline-date"},At={class:"timeline-user"},Lt={key:2,class:"timeline-item"},zt={class:"timeline-content"},Ht={class:"timeline-date"},Kt={class:"timeline-user"},Pt={key:0,class:"timeline-reason"},Yt={class:"reject-modal"},Ot=C({__name:"detail",setup(Gt){const y=$();U();const f=M(),s=m(null),p=m(!1),u=m(""),r=m(!1),d=m("");T(()=>{const i=y.query.id;i?x(i):u.value="报价单ID不存在"});async function x(i){const e=i||y.query.id;if(!e){u.value="报价单ID不存在";return}p.value=!0,u.value="";try{const _=await f.fetchQuoteById(e);s.value=_}catch(_){u.value="加载报价单失败，请重试",console.error("Failed to load quote:",_)}finally{p.value=!1}}function b(){s.value&&uni.navigateTo({url:`/pages/admin/quotes/edit?id=${s.value.id}`})}async function h(){s.value&&uni.showModal({title:"确认批准",content:`确定要批准报价单 ${s.value.quote_number} 吗？`,success:async i=>{if(i.confirm)try{await f.approveQuote(s.value.id),uni.showToast({title:"批准成功",icon:"success"}),x()}catch{uni.showToast({title:"批准失败",icon:"none"})}}})}function g(){d.value="",r.value=!0}async function k(){if(s.value)try{await f.rejectQuote(s.value.id,d.value),uni.showToast({title:"拒绝成功",icon:"success"}),r.value=!1,x()}catch{uni.showToast({title:"拒绝失败",icon:"none"})}}function j(){r.value=!1,d.value=""}function q(){uni.showToast({title:"打印功能开发中",icon:"none"})}function v(i){return i.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function w(i){const e=new Date(i);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function S(i){return{draft:"草稿",submitted:"待审批",approved:"已批准",rejected:"已拒绝"}[i]||i}return(i,e)=>{const _=V("modal");return l(),a("view",A,[p.value?(l(),a("view",L,e[2]||(e[2]=[t("text",{class:"loading-text"},"加载中...",-1)]))):u.value?(l(),a("view",z,[t("text",H,o(u.value),1),t("button",{class:"retry-btn",onClick:x},"重试")])):s.value?(l(),a("view",K,[t("view",P,[t("view",Y,[t("text",G,o(s.value.quote_number),1),t("view",{class:R(["status-badge",`status-${s.value.status}`])},[t("text",null,o(S(s.value.status)),1)],2)]),t("view",J,[s.value.status==="submitted"?(l(),a("button",{key:0,class:"action-btn action-approve",onClick:h}," 批准报价 ")):c("",!0),s.value.status==="submitted"?(l(),a("button",{key:1,class:"action-btn action-reject",onClick:g}," 拒绝报价 ")):c("",!0),s.value.status==="draft"?(l(),a("button",{key:2,class:"action-btn action-edit",onClick:b}," 编辑报价 ")):c("",!0),t("button",{class:"action-btn action-print",onClick:q},"打印报价单")])]),t("view",O,[e[8]||(e[8]=t("text",{class:"section-title"},"客户信息",-1)),t("view",W,[t("view",X,[e[3]||(e[3]=t("text",{class:"info-label"},"客户姓名",-1)),t("text",Z,o(s.value.customer_name),1)]),t("view",tt,[e[4]||(e[4]=t("text",{class:"info-label"},"联系电话",-1)),t("text",et,o(s.value.customer_phone),1)]),t("view",st,[e[5]||(e[5]=t("text",{class:"info-label"},"电子邮箱",-1)),t("text",ot,o(s.value.customer_email||"-"),1)]),t("view",it,[e[6]||(e[6]=t("text",{class:"info-label"},"公司名称",-1)),t("text",at,o(s.value.customer_company||"-"),1)]),t("view",lt,[e[7]||(e[7]=t("text",{class:"info-label"},"送货地址",-1)),t("text",nt,o(s.value.delivery_address||"-"),1)])])]),t("view",ct,[e[10]||(e[10]=t("text",{class:"section-title"},"产品明细",-1)),t("view",ut,[e[9]||(e[9]=F('<view class="table-header"><text class="col col-product">产品</text><text class="col col-quantity">数量</text><text class="col col-price">单价</text><text class="col col-subtotal">小计</text></view>',1)),(l(!0),a(B,null,I(s.value.items,n=>(l(),a("view",{key:n.id,class:"table-row"},[t("view",rt,[t("text",dt,o(n.product_name),1),t("text",vt,"SKU: "+o(n.product_sku),1)]),t("text",_t,o(n.quantity),1),t("text",mt,"¥"+o(v(n.unit_price)),1),t("text",xt,"¥"+o(v(n.subtotal)),1)]))),128))])]),t("view",wt,[t("view",ft,[t("view",pt,[e[11]||(e[11]=t("text",{class:"summary-label"},"小计",-1)),t("text",yt,"¥"+o(v(s.value.subtotal)),1)]),t("view",bt,[t("text",ht,"税额 ("+o((s.value.tax_rate*100).toFixed(0))+"%)",1),t("text",gt,"¥"+o(v(s.value.tax_amount)),1)]),t("view",kt,[e[12]||(e[12]=t("text",{class:"summary-label"},"总计",-1)),t("text",jt,"¥"+o(v(s.value.total_amount)),1)])])]),s.value.notes?(l(),a("view",qt,[e[13]||(e[13]=t("text",{class:"section-title"},"备注信息",-1)),t("text",St,o(s.value.notes),1)])):c("",!0),s.value.terms_conditions?(l(),a("view",Ct,[e[14]||(e[14]=t("text",{class:"section-title"},"条款和条件",-1)),t("text",Mt,o(s.value.terms_conditions),1)])):c("",!0),t("view",Tt,[e[23]||(e[23]=t("text",{class:"section-title"},"时间线",-1)),t("view",$t,[t("view",Dt,[e[16]||(e[16]=t("view",{class:"timeline-dot"},null,-1)),t("view",Rt,[e[15]||(e[15]=t("text",{class:"timeline-title"},"创建时间",-1)),t("text",Ft,o(w(s.value.created_at)),1),t("text",Bt,o(s.value.created_by_name||"系统"),1)])]),s.value.submitted_at?(l(),a("view",It,[e[18]||(e[18]=t("view",{class:"timeline-dot"},null,-1)),t("view",Qt,[e[17]||(e[17]=t("text",{class:"timeline-title"},"提交审批",-1)),t("text",Vt,o(w(s.value.submitted_at)),1)])])):c("",!0),s.value.approved_at?(l(),a("view",Nt,[e[20]||(e[20]=t("view",{class:"timeline-dot timeline-dot-success"},null,-1)),t("view",Et,[e[19]||(e[19]=t("text",{class:"timeline-title"},"批准通过",-1)),t("text",Ut,o(w(s.value.approved_at)),1),t("text",At,o(s.value.approved_by_name||"系统"),1)])])):c("",!0),s.value.rejected_at?(l(),a("view",Lt,[e[22]||(e[22]=t("view",{class:"timeline-dot timeline-dot-danger"},null,-1)),t("view",zt,[e[21]||(e[21]=t("text",{class:"timeline-title"},"拒绝审批",-1)),t("text",Ht,o(w(s.value.rejected_at)),1),t("text",Kt,o(s.value.rejected_by_name||"系统"),1),s.value.rejection_reason?(l(),a("text",Pt," 原因："+o(s.value.rejection_reason),1)):c("",!0)])])):c("",!0)])])])):c("",!0),D(_,{visible:r.value,"onUpdate:visible":e[1]||(e[1]=n=>r.value=n),title:"拒绝报价单",onConfirm:k,onCancel:j},{default:Q(()=>[t("view",Yt,[e[24]||(e[24]=t("text",{class:"modal-label"},"拒绝原因（可选）：",-1)),N(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=n=>d.value=n),class:"reject-textarea",placeholder:"请输入拒绝原因...",maxlength:"200"},null,512),[[E,d.value]])])]),_:1},8,["visible"])])}}});export{Ot as default};
