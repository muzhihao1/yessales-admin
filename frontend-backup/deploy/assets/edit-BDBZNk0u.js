import{d as N,K as z,r as m,E as D,i as w,o as E,c as l,j as y,k as h,g as n,a as e,t as i,z as j,v,b as d,x as p,y as A,n as G}from"./index.standard-DHpxIVC0.js";import{A as J}from"./AdminLayout-CwVGqELj.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"product-edit-page"},H={class:"page-header"},Q={class:"page-title"},W={class:"edit-form admin-card"},X={class:"form-section"},Y={class:"admin-form-item"},Z={key:0,class:"form-error"},$={class:"admin-form-item"},ee={key:0,class:"form-error"},te={class:"admin-form-item"},se={class:"form-picker"},oe={key:0,class:"form-error"},ae={class:"form-row"},ie={class:"admin-form-item"},le={key:0,class:"form-error"},ne={class:"admin-form-item"},re={class:"form-picker"},ue={key:0,class:"form-error"},ce={class:"admin-form-item"},de={class:"form-section"},me={class:"image-upload"},ve={key:0,class:"image-preview"},pe=["src"],fe={class:"form-section"},ge={class:"admin-form-item"},xe={class:"switch-item"},_e=["checked"],we={class:"form-actions"},ye=["loading","disabled"],he=N({__name:"edit",setup(be){const f=z(),b=D(),u=m(b.params.id||b.query.id||""),g=w(()=>!!u.value),s=m({name:"",model:"",category:"",price:0,unit:"台",description:"",image_url:"",is_active:!0}),a=m({}),c=m(!1),x=["台球桌","地毯","球杆","台球","其他配件"],C=w(()=>x.indexOf(s.value.category||"")),_=["台","个","套","块","张","米","平方米"],T=w(()=>_.indexOf(s.value.unit||"台")),P=async()=>{if(!u.value)return;const o=await f.fetchProduct(u.value);o?s.value={...o}:(uni.showToast({title:"产品不存在",icon:"none"}),setTimeout(()=>{uni.navigateBack()},1500))},B=()=>{var o,t;return a.value={},(o=s.value.name)!=null&&o.trim()||(a.value.name="请输入产品名称"),(t=s.value.model)!=null&&t.trim()||(a.value.model="请输入产品型号"),s.value.category||(a.value.category="请选择产品分类"),(!s.value.price||s.value.price<=0)&&(a.value.price="请输入正确的价格"),s.value.unit||(a.value.unit="请选择单位"),Object.keys(a.value).length===0},I=o=>{s.value.category=x[o.detail.value]},S=o=>{s.value.unit=_[o.detail.value]},V=o=>{s.value.is_active=o.detail.value},q=()=>{uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:o=>{const t=o.tempFilePaths[0];M(t)}})},M=async o=>{uni.showLoading({title:"上传中..."});try{s.value.image_url=o,uni.hideLoading(),uni.showToast({title:"上传成功",icon:"success"})}catch{uni.hideLoading(),uni.showToast({title:"上传失败",icon:"none"})}},O=()=>{s.value.image_url=""},U=async()=>{if(B()){c.value=!0;try{let o;g.value?o=await f.updateProduct(u.value,s.value):o=await f.createProduct(s.value),o.success?(uni.showToast({title:g.value?"更新成功":"添加成功",icon:"success"}),setTimeout(()=>{uni.navigateBack()},1500)):uni.showToast({title:o.error||"操作失败",icon:"none"})}catch{uni.showToast({title:"操作失败",icon:"none"})}finally{c.value=!1}}},F=()=>{uni.showModal({title:"提示",content:"确定要放弃当前编辑吗？",success:o=>{o.confirm&&uni.navigateBack()}})},L=()=>{uni.navigateBack()};return E(()=>{u.value&&P()}),(o,t)=>{const k=A("picker");return n(),l("view",R,[y(J,null,{default:h(()=>[e("view",H,[e("text",Q,i(g.value?"编辑产品":"添加产品"),1),e("button",{class:"back-btn",onClick:L},t[4]||(t[4]=[e("text",null,"← 返回列表",-1)]))]),e("view",W,[e("form",{onSubmit:j(U,["prevent"])},[e("view",X,[t[13]||(t[13]=e("text",{class:"section-title"},"基本信息",-1)),e("view",Y,[t[5]||(t[5]=e("text",{class:"admin-form-label required"},"产品名称",-1)),v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>s.value.name=r),class:"admin-form-control",type:"text",placeholder:"请输入产品名称",maxlength:"100"},null,512),[[p,s.value.name]]),a.value.name?(n(),l("text",Z,i(a.value.name),1)):d("",!0)]),e("view",$,[t[6]||(t[6]=e("text",{class:"admin-form-label required"},"产品型号",-1)),v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>s.value.model=r),class:"admin-form-control",type:"text",placeholder:"请输入产品型号",maxlength:"50"},null,512),[[p,s.value.model]]),a.value.model?(n(),l("text",ee,i(a.value.model),1)):d("",!0)]),e("view",te,[t[8]||(t[8]=e("text",{class:"admin-form-label required"},"产品分类",-1)),y(k,{mode:"selector",range:x,value:C.value,onChange:I},{default:h(()=>[e("view",se,[e("text",{class:G(["picker-text",{placeholder:!s.value.category}])},i(s.value.category||"请选择产品分类"),3),t[7]||(t[7]=e("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"]),a.value.category?(n(),l("text",oe,i(a.value.category),1)):d("",!0)]),e("view",ae,[e("view",ie,[t[9]||(t[9]=e("text",{class:"admin-form-label required"},"价格",-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>s.value.price=r),class:"admin-form-control",type:"digit",placeholder:"0.00"},null,512),[[p,s.value.price,void 0,{number:!0}]]),a.value.price?(n(),l("text",le,i(a.value.price),1)):d("",!0)]),e("view",ne,[t[11]||(t[11]=e("text",{class:"admin-form-label required"},"单位",-1)),y(k,{mode:"selector",range:_,value:T.value,onChange:S},{default:h(()=>[e("view",re,[e("text",null,i(s.value.unit),1),t[10]||(t[10]=e("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"]),a.value.unit?(n(),l("text",ue,i(a.value.unit),1)):d("",!0)])]),e("view",ce,[t[12]||(t[12]=e("text",{class:"admin-form-label"},"产品描述",-1)),v(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=r=>s.value.description=r),class:"admin-form-control form-textarea",placeholder:"请输入产品描述",maxlength:"500"},null,512),[[p,s.value.description]])])]),e("view",de,[t[17]||(t[17]=e("text",{class:"section-title"},"产品图片",-1)),e("view",me,[s.value.image_url?(n(),l("view",ve,[e("image",{src:s.value.image_url,mode:"aspectFill"},null,8,pe),e("button",{class:"remove-btn",onClick:O},t[14]||(t[14]=[e("text",null,"×",-1)]))])):(n(),l("button",{key:1,class:"upload-btn",onClick:q},t[15]||(t[15]=[e("text",{class:"upload-icon"},"+",-1),e("text",{class:"upload-text"},"上传图片",-1)]))),t[16]||(t[16]=e("text",{class:"upload-tips"},"建议尺寸：800x800px，支持 JPG、PNG 格式",-1))])]),e("view",fe,[t[20]||(t[20]=e("text",{class:"section-title"},"状态设置",-1)),e("view",ge,[e("view",xe,[t[18]||(t[18]=e("text",{class:"switch-label"},"是否上架",-1)),e("switch",{checked:s.value.is_active,onChange:V,color:"#2563eb"},null,40,_e)]),t[19]||(t[19]=e("text",{class:"form-help"},"下架后产品将不在销售端显示",-1))])]),e("view",we,[e("button",{class:"admin-btn admin-btn-primary",type:"submit",loading:c.value,disabled:c.value},i(c.value?"保存中...":"保存"),9,ye),e("button",{class:"admin-btn admin-btn-default",onClick:F},"取消")])],32)])]),_:1})])}}}),Pe=K(he,[["__scopeId","data-v-60b0cb5f"]]);export{Pe as default};
