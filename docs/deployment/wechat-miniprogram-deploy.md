# 微信小程序发布流程

## 预备工作

### 1. 微信开发者账号设置
- [ ] 注册微信小程序开发者账号
- [ ] 获取小程序 AppID
- [ ] 配置小程序域名白名单
- [ ] 设置业务域名（Supabase API域名）

### 2. 本地开发环境
- [ ] 安装微信开发者工具
- [ ] 配置小程序项目信息
- [ ] 测试本地小程序开发

## 构建和发布流程

### 第一步：构建小程序版本
```bash
# 进入前端目录
cd frontend/

# 安装依赖
npm ci --legacy-peer-deps

# 构建微信小程序版本
npm run build:mp-weixin

# 检查构建结果
ls -la dist/build/mp-weixin/
```

### 第二步：导入微信开发者工具
1. 打开微信开发者工具
2. 选择"小程序" -> "导入"
3. 选择项目目录：`frontend/dist/build/mp-weixin/`
4. 填写项目信息：
   - AppID: 从微信公众平台获取
   - 项目名称: 耶氏台球报价系统
   - 开发模式: 小程序

### 第三步：测试和调试
- [ ] 在开发者工具中测试所有功能
- [ ] 检查网络请求是否正常
- [ ] 验证页面跳转和交互
- [ ] 测试销售端和管理端功能

### 第四步：上传审核
1. 在微信开发者工具中点击"上传"
2. 填写版本号和项目备注
3. 登录微信公众平台
4. 在"版本管理"中提交审核
5. 等待微信审核通过（通常1-3个工作日）

### 第五步：发布上线
- [ ] 审核通过后，在微信公众平台点击"发布"
- [ ] 设置小程序的基本信息和介绍
- [ ] 配置小程序类目和标签
- [ ] 发布成功后通知团队

## 域名配置要求

### 1. 服务器域名（request合法域名）
```
https://your-supabase-project.supabase.co
```

### 2. 业务域名
```
https://admin.yessales.cn
https://app.yessales.cn  
```

### 3. 上传文件域名
```
https://your-supabase-project.supabase.co
```

## 小程序特殊处理

### 1. 路由适配
小程序中需要将Web路由转换为小程序页面路径：
- `/pages/sales/index` -> `pages/sales/index`
- `/pages/admin/dashboard/index` -> `pages/admin/dashboard/index`

### 2. API请求处理
确保所有API请求使用HTTPS，并在微信公众平台配置域名白名单。

### 3. 存储适配
使用uni-app的存储API替代localStorage：
```javascript
// 使用uni.setStorage替代localStorage.setItem
uni.setStorage({
  key: 'key',
  data: 'value'
})
```

## 发布检查清单

### 发布前检查
- [ ] 所有页面在小程序中正常显示
- [ ] 网络请求功能正常
- [ ] 用户认证流程正常
- [ ] 文件上传功能正常
- [ ] 数据存储功能正常

### 发布后验证
- [ ] 在真实微信环境中测试
- [ ] 验证分享功能
- [ ] 检查性能和加载速度
- [ ] 收集用户反馈

## 后续维护

### 版本更新流程
1. 在项目中进行功能开发和测试
2. 重新构建小程序版本
3. 在微信开发者工具中测试
4. 上传新版本并提交审核
5. 审核通过后发布更新

### 监控和分析
- 使用微信小程序后台查看访问数据
- 监控用户使用情况和错误日志
- 定期收集用户反馈并优化体验