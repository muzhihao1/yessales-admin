# YesSales ç”Ÿäº§éƒ¨ç½²æ¸…å•

## æ¦‚è¿°

æœ¬æ¸…å•ç”¨äºç¡®ä¿ YesSales ç³»ç»Ÿåœ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå‰å®Œæˆæ‰€æœ‰å¿…è¦çš„å‡†å¤‡å·¥ä½œã€‚è¯·æŒ‰é¡ºåºé€é¡¹æ£€æŸ¥ã€‚

## éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### 1. ä»£ç å‡†å¤‡ âœ“

- [ ] æ‰€æœ‰åŠŸèƒ½å·²å¼€å‘å®Œæˆå¹¶é€šè¿‡æµ‹è¯•
- [ ] ä»£ç å·²é€šè¿‡ Code Review
- [ ] æ— æœªè§£å†³çš„ Critical/High çº§åˆ« Bug
- [ ] æ‰€æœ‰ä¸´æ—¶ä»£ç å’Œè°ƒè¯•ä¿¡æ¯å·²ç§»é™¤
- [ ] ç‰ˆæœ¬å·å·²æ›´æ–°ï¼ˆpackage.jsonï¼‰
- [ ] CHANGELOG å·²æ›´æ–°

### 2. ç¯å¢ƒé…ç½® âš™ï¸

#### 2.1 Supabase é…ç½®
- [ ] ç”Ÿäº§é¡¹ç›®å·²åˆ›å»º
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®ï¼š
  - [ ] `NEXT_PUBLIC_SUPABASE_URL`
  - [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`
  - [ ] `SUPABASE_SERVICE_ROLE_KEY`ï¼ˆä»…æœåŠ¡ç«¯ï¼‰
  - [ ] `DATABASE_URL`
- [ ] è‡ªå®šä¹‰åŸŸåå·²é…ç½®ï¼ˆå¦‚é€‚ç”¨ï¼‰

#### 2.2 ç¬¬ä¸‰æ–¹æœåŠ¡
- [ ] é’‰é’‰ Webhook å·²é…ç½®
- [ ] é‚®ä»¶æœåŠ¡å·²é…ç½®ï¼ˆå¦‚ä½¿ç”¨ï¼‰
- [ ] æ–‡ä»¶å­˜å‚¨æœåŠ¡å·²é…ç½®
- [ ] CDN å·²é…ç½®ï¼ˆå¦‚ä½¿ç”¨ï¼‰

### 3. æ•°æ®åº“éƒ¨ç½² ğŸ—„ï¸

- [ ] æ‰€æœ‰ migrations å·²å‡†å¤‡å°±ç»ª
- [ ] æ‰§è¡Œé¡ºåºï¼š
  ```bash
  # 1. åŸºç¡€è¡¨ç»“æ„
  supabase migration up 20250105_initial_schema.sql
  
  # 2. å®‰å…¨é…ç½®
  supabase migration up 20250106_security_policies.sql
  
  # 3. æ€§èƒ½ä¼˜åŒ–
  supabase migration up 20250107_performance_indexes.sql
  
  # 4. è§¦å‘å™¨å’Œå‡½æ•°
  supabase migration up 20250107_backup_triggers.sql
  
  # 5. ç›‘æ§ç³»ç»Ÿ
  supabase migration up 20250108_monitoring_tables.sql
  supabase migration up 20250108_monitoring_functions.sql
  ```
- [ ] åˆå§‹æ•°æ®å·²å‡†å¤‡ï¼ˆç®¡ç†å‘˜è´¦å·ã€åŸºç¡€é…ç½®ç­‰ï¼‰
- [ ] æ•°æ®åº“å¤‡ä»½ç­–ç•¥å·²é…ç½®
- [ ] æ•°æ®åº“è®¿é—®æƒé™å·²æ­£ç¡®è®¾ç½®

### 4. Edge Functions éƒ¨ç½² ğŸš€

- [ ] æ‰€æœ‰ Edge Functions å·²æµ‹è¯•
- [ ] éƒ¨ç½²å‘½ä»¤ï¼š
  ```bash
  # å¤‡ä»½å‡½æ•°
  supabase functions deploy database-backup
  supabase functions deploy backup-to-storage
  
  # ç›‘æ§å‡½æ•°
  supabase functions deploy collect-metrics
  supabase functions deploy check-alerts
  ```
- [ ] å‡½æ•°æƒé™å·²æ­£ç¡®é…ç½®
- [ ] å‡½æ•°ç¯å¢ƒå˜é‡å·²è®¾ç½®

### 5. åº”ç”¨éƒ¨ç½² ğŸ“±

#### 5.1 æ„å»ºæ£€æŸ¥
- [ ] ç”Ÿäº§æ„å»ºæˆåŠŸï¼š`npm run build`
- [ ] æ— æ„å»ºè­¦å‘Šæˆ–é”™è¯¯
- [ ] Bundle å¤§å°åœ¨åˆç†èŒƒå›´å†…
- [ ] æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬å·²é”å®šï¼ˆpackage-lock.jsonï¼‰

#### 5.2 éƒ¨ç½²é…ç½®
- [ ] éƒ¨ç½²å¹³å°å·²é€‰æ‹©ï¼ˆVercel/Netlify/å…¶ä»–ï¼‰
- [ ] ç¯å¢ƒå˜é‡å·²åœ¨éƒ¨ç½²å¹³å°é…ç½®
- [ ] è‡ªå®šä¹‰åŸŸåå·²é…ç½®
- [ ] SSL è¯ä¹¦å·²é…ç½®

### 6. å®‰å…¨æ£€æŸ¥ ğŸ”’

- [ ] æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
- [ ] RLS ç­–ç•¥å·²å¯ç”¨å¹¶æµ‹è¯•
- [ ] API å¯†é’¥å·²æ­£ç¡®ä¿æŠ¤
- [ ] CORS é…ç½®æ­£ç¡®
- [ ] è¾“å…¥éªŒè¯å·²å®æ–½
- [ ] SQL æ³¨å…¥é˜²æŠ¤å·²å®æ–½
- [ ] XSS é˜²æŠ¤å·²å®æ–½
- [ ] HTTPS å¼ºåˆ¶å¯ç”¨
- [ ] å®‰å…¨å“åº”å¤´å·²é…ç½®

### 7. æ€§èƒ½ä¼˜åŒ– âš¡

- [ ] æ•°æ®åº“ç´¢å¼•å·²åˆ›å»º
- [ ] æŸ¥è¯¢æ€§èƒ½å·²ä¼˜åŒ–
- [ ] å›¾ç‰‡å·²ä¼˜åŒ–å’Œå‹ç¼©
- [ ] é™æ€èµ„æºå·²å¯ç”¨ç¼“å­˜
- [ ] API å“åº”æ—¶é—´ç¬¦åˆè¦æ±‚ï¼ˆ< 2ç§’ï¼‰
- [ ] é¡µé¢åŠ è½½æ—¶é—´ç¬¦åˆè¦æ±‚ï¼ˆ< 3ç§’ï¼‰

### 8. ç›‘æ§é…ç½® ğŸ“Š

- [ ] ç›‘æ§ç³»ç»Ÿå·²éƒ¨ç½²
- [ ] å‘Šè­¦è§„åˆ™å·²é…ç½®
- [ ] é€šçŸ¥æ¸ é“å·²æµ‹è¯•
- [ ] å®šæ—¶ä»»åŠ¡å·²é…ç½®ï¼š
  ```sql
  -- pg_cron é…ç½®
  SELECT cron.schedule('collect-metrics', '*/5 * * * *', 'SELECT collect_metrics();');
  SELECT cron.schedule('check-alerts', '*/5 * * * *', 'SELECT check_alerts();');
  SELECT cron.schedule('cleanup-metrics', '0 2 * * *', 'SELECT cleanup_old_metrics();');
  ```
- [ ] æ—¥å¿—æ”¶é›†å·²é…ç½®

### 9. å¤‡ä»½å’Œæ¢å¤ ğŸ’¾

- [ ] è‡ªåŠ¨å¤‡ä»½å·²é…ç½®
- [ ] å¤‡ä»½å­˜å‚¨ä½ç½®å·²ç¡®è®¤
- [ ] æ¢å¤æµç¨‹å·²æµ‹è¯•
- [ ] å¤‡ä»½ç›‘æ§å·²å¯ç”¨
- [ ] ç¾éš¾æ¢å¤è®¡åˆ’å·²åˆ¶å®š

### 10. æ–‡æ¡£å‡†å¤‡ ğŸ“š

- [ ] API æ–‡æ¡£å·²æ›´æ–°
- [ ] ç”¨æˆ·æ‰‹å†Œå·²å‡†å¤‡
- [ ] ç®¡ç†å‘˜æ‰‹å†Œå·²å‡†å¤‡
- [ ] éƒ¨ç½²æ–‡æ¡£å·²å®Œæˆ
- [ ] æ•…éšœå¤„ç†æ‰‹å†Œå·²å‡†å¤‡

### 11. æµ‹è¯•éªŒè¯ âœ…

#### 11.1 åŠŸèƒ½æµ‹è¯•
- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•æµç¨‹
- [ ] äº§å“ç®¡ç†åŠŸèƒ½
- [ ] æŠ¥ä»·å•ç”ŸæˆåŠŸèƒ½
- [ ] æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½åŠŸèƒ½
- [ ] æƒé™æ§åˆ¶åŠŸèƒ½

#### 11.2 æ€§èƒ½æµ‹è¯•
- [ ] è´Ÿè½½æµ‹è¯•å·²å®Œæˆ
- [ ] å¹¶å‘ç”¨æˆ·æµ‹è¯•å·²å®Œæˆ
- [ ] å“åº”æ—¶é—´æµ‹è¯•å·²å®Œæˆ

#### 11.3 å®‰å…¨æµ‹è¯•
- [ ] æ¸—é€æµ‹è¯•å·²å®Œæˆï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] æƒé™è¶Šç•Œæµ‹è¯•å·²å®Œæˆ
- [ ] è¾“å…¥éªŒè¯æµ‹è¯•å·²å®Œæˆ

### 12. å‘å¸ƒå‡†å¤‡ ğŸ¯

- [ ] å‘å¸ƒæ—¶é—´å·²ç¡®å®š
- [ ] å‘å¸ƒé€šçŸ¥å·²å‡†å¤‡
- [ ] å›æ»šæ–¹æ¡ˆå·²å‡†å¤‡
- [ ] ç´§æ€¥è”ç³»äººå·²ç¡®å®š
- [ ] å‘å¸ƒåéªŒè¯è®¡åˆ’å·²åˆ¶å®š

## éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1: æ•°æ®åº“éƒ¨ç½²
```bash
# 1. å¤‡ä»½ç°æœ‰æ•°æ®ï¼ˆå¦‚æœ‰ï¼‰
pg_dump $OLD_DATABASE_URL > backup_$(date +%Y%m%d_%H%M%S).sql

# 2. æ‰§è¡Œ migrations
supabase db push

# 3. éªŒè¯è¡¨ç»“æ„
supabase db diff

# 4. å¯¼å…¥åˆå§‹æ•°æ®
psql $DATABASE_URL < initial_data.sql
```

### æ­¥éª¤ 2: Edge Functions éƒ¨ç½²
```bash
# 1. éƒ¨ç½²æ‰€æœ‰å‡½æ•°
supabase functions deploy --all

# 2. éªŒè¯å‡½æ•°çŠ¶æ€
supabase functions list
```

### æ­¥éª¤ 3: åº”ç”¨éƒ¨ç½²
```bash
# 1. æ„å»ºåº”ç”¨
npm run build

# 2. éƒ¨ç½²åˆ° Vercelï¼ˆç¤ºä¾‹ï¼‰
vercel --prod

# 3. éªŒè¯éƒ¨ç½²
curl https://your-domain.com/api/health
```

### æ­¥éª¤ 4: éƒ¨ç½²åéªŒè¯
```bash
# 1. æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€
curl https://your-domain.com/api/health

# 2. æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
npm run test:e2e

# 3. æ£€æŸ¥ç›‘æ§æŒ‡æ ‡
SELECT * FROM system_metrics ORDER BY created_at DESC LIMIT 10;
```

## å›æ»šæ–¹æ¡ˆ

å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜ï¼Œæ‰§è¡Œä»¥ä¸‹å›æ»šæ­¥éª¤ï¼š

1. **åº”ç”¨å›æ»š**ï¼š
   ```bash
   # Vercel å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
   vercel rollback
   ```

2. **æ•°æ®åº“å›æ»š**ï¼š
   ```bash
   # æ¢å¤å¤‡ä»½
   psql $DATABASE_URL < backup_latest.sql
   ```

3. **Edge Functions å›æ»š**ï¼š
   ```bash
   # éƒ¨ç½²ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„å‡½æ•°
   git checkout [previous-tag]
   supabase functions deploy --all
   ```

## ç´§æ€¥è”ç³»äºº

- æŠ€æœ¯è´Ÿè´£äººï¼š[å§“å] - [ç”µè¯]
- è¿ç»´è´Ÿè´£äººï¼š[å§“å] - [ç”µè¯]
- äº§å“è´Ÿè´£äººï¼š[å§“å] - [ç”µè¯]

## æ£€æŸ¥ç¡®è®¤

- [ ] æˆ‘å·²å®Œæˆæ‰€æœ‰æ£€æŸ¥é¡¹
- [ ] æ‰€æœ‰æµ‹è¯•å·²é€šè¿‡
- [ ] å›æ»šæ–¹æ¡ˆå·²å‡†å¤‡å°±ç»ª
- [ ] å›¢é˜Ÿå·²å‡†å¤‡å°±ç»ª

**éƒ¨ç½²è´Ÿè´£äººç­¾å­—**ï¼š________________

**æ—¥æœŸ**ï¼š________________