// ===================================
// 响应式设计工具集
// 为Terminal 2提供移动端适配支持
// ===================================

@import './variables.scss';

// ========== 媒体查询Mixins ==========

// 最小宽度断点 (Mobile First)
@mixin media-min($breakpoint) {
  @media (min-width: $breakpoint) {
    @content;
  }
}

// 最大宽度断点
@mixin media-max($breakpoint) {
  @media (max-width: $breakpoint - 1px) {
    @content;
  }
}

// 区间断点
@mixin media-between($min-breakpoint, $max-breakpoint) {
  @media (min-width: $min-breakpoint) and (max-width: $max-breakpoint - 1px) {
    @content;
  }
}

// 预定义设备断点
@mixin mobile-only {
  @include media-max($breakpoint-md) {
    @content;
  }
}

@mixin tablet-up {
  @include media-min($breakpoint-lg) {
    @content;
  }
}

@mixin desktop-up {
  @include media-min($breakpoint-xl) {
    @content;
  }
}

@mixin large-desktop-up {
  @include media-min($breakpoint-2xl) {
    @content;
  }
}

// 设备方向
@mixin landscape {
  @media (orientation: landscape) {
    @content;
  }
}

@mixin portrait {
  @media (orientation: portrait) {
    @content;
  }
}

// 高分辨率屏幕
@mixin retina {
  @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    @content;
  }
}

// ========== 触摸设备适配 ==========

// 触摸设备检测
@mixin touch-device {
  @media (hover: none) and (pointer: coarse) {
    @content;
  }
}

// 非触摸设备
@mixin hover-device {
  @media (hover: hover) and (pointer: fine) {
    @content;
  }
}

// 触摸友好的尺寸
@mixin touch-target($size: $touch-target-min) {
  min-width: $size;
  min-height: $size;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  
  // 在触摸设备上稍微增大
  @include touch-device {
    min-width: max($size, $touch-target-comfortable);
    min-height: max($size, $touch-target-comfortable);
  }
}

// 触摸反馈
@mixin touch-feedback($scale: 0.95, $duration: 0.1s) {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  transition: transform #{$duration} ease;
  
  &:active {
    transform: scale($scale);
  }
}

// ========== 容器和布局 ==========

// 响应式容器
@mixin responsive-container($max-width: $container-xl) {
  width: 100%;
  max-width: $max-width;
  margin-left: auto;
  margin-right: auto;
  padding-left: $mobile-padding-x;
  padding-right: $mobile-padding-x;
  
  @include media-min($breakpoint-lg) {
    padding-left: $spacing-lg;
    padding-right: $spacing-lg;
  }
}

// 安全区域内边距
@mixin safe-area-padding {
  padding-left: max($mobile-padding-x, $safe-area-left);
  padding-right: max($mobile-padding-x, $safe-area-right);
  padding-top: max($mobile-padding-y, $safe-area-top);
  padding-bottom: max($mobile-padding-y, $safe-area-bottom);
}

// 键盘适配
@mixin keyboard-aware-padding {
  padding-bottom: $keyboard-avoidance-padding;
  
  &.keyboard-open {
    padding-bottom: $keyboard-avoidance-padding * 2;
  }
}

// ========== 响应式网格 ==========

// 响应式网格布局
@mixin responsive-grid($mobile-cols: 1, $tablet-cols: 2, $desktop-cols: 3, $gap: $spacing-md) {
  display: grid;
  gap: $gap;
  grid-template-columns: repeat($mobile-cols, 1fr);
  
  @include media-min($breakpoint-lg) {
    grid-template-columns: repeat($tablet-cols, 1fr);
  }
  
  @include media-min($breakpoint-xl) {
    grid-template-columns: repeat($desktop-cols, 1fr);
  }
}

// 自适应网格
@mixin adaptive-grid($min-width: 280px, $gap: $spacing-md) {
  display: grid;
  gap: $gap;
  grid-template-columns: repeat(auto-fit, minmax($min-width, 1fr));
}

// ========== 文字和排版 ==========

// 响应式文字大小
@mixin responsive-text($mobile-size, $desktop-size: null, $line-height: 1.5) {
  @if $desktop-size {
    font-size: clamp($mobile-size, 2.5vw, $desktop-size);
  } @else {
    font-size: $mobile-size;
  }
  line-height: $line-height;
}

// 文字截断
@mixin text-ellipsis($lines: 1) {
  @if $lines == 1 {
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  } @else {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: $lines;
    overflow: hidden;
  }
}

// 可读性优化
@mixin readable-text {
  line-height: 1.6;
  letter-spacing: 0.01em;
  word-spacing: 0.02em;
  
  // 移动端字体稍小
  @include mobile-only {
    font-size: 0.9em;
    line-height: 1.5;
  }
}

// ========== 滚动优化 ==========

// 平滑滚动
@mixin smooth-scroll {
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

// 隐藏滚动条但保持功能
@mixin hide-scrollbar {
  scrollbar-width: none;
  -ms-overflow-style: none;
  
  &::-webkit-scrollbar {
    display: none;
  }
}

// 自定义滚动条
@mixin custom-scrollbar($width: 8px, $track-color: $border-color-lighter, $thumb-color: $border-color) {
  scrollbar-width: thin;
  scrollbar-color: $thumb-color $track-color;
  
  &::-webkit-scrollbar {
    width: $width;
    height: $width;
  }
  
  &::-webkit-scrollbar-track {
    background: $track-color;
    border-radius: #{$width / 2};
  }
  
  &::-webkit-scrollbar-thumb {
    background: $thumb-color;
    border-radius: #{$width / 2};
    
    &:hover {
      background: darken($thumb-color, 10%);
    }
  }
}

// ========== 性能优化 ==========

// GPU加速
@mixin gpu-accelerated {
  transform: translate3d(0, 0, 0);
  will-change: transform;
}

// 减少动画复杂度
@mixin reduced-motion-safe {
  @media (prefers-reduced-motion: reduce) {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
    @content;
  }
}

// ========== 可访问性 ==========

// 焦点样式
@mixin focus-visible($color: $primary-color, $width: 2px) {
  &:focus-visible {
    outline: #{$width} solid $color;
    outline-offset: 2px;
  }
}

// 高对比度模式支持
@mixin high-contrast {
  @media (prefers-contrast: high) {
    @content;
  }
}

// 暗黑模式支持
@mixin dark-mode {
  @media (prefers-color-scheme: dark) {
    @content;
  }
}

// ========== 实用工具类生成器 ==========

// 生成响应式工具类
@mixin generate-responsive-utilities($property, $values, $prefix: '') {
  @each $name, $value in $values {
    .#{$prefix}#{$name} {
      #{$property}: #{$value};
    }
    
    .#{$prefix}#{$name}-sm {
      @include media-min($breakpoint-sm) {
        #{$property}: #{$value};
      }
    }
    
    .#{$prefix}#{$name}-md {
      @include media-min($breakpoint-md) {
        #{$property}: #{$value};
      }
    }
    
    .#{$prefix}#{$name}-lg {
      @include media-min($breakpoint-lg) {
        #{$property}: #{$value};
      }
    }
    
    .#{$prefix}#{$name}-xl {
      @include media-min($breakpoint-xl) {
        #{$property}: #{$value};
      }
    }
  }
}

// ========== 调试工具 ==========

// 响应式调试
@mixin debug-breakpoints {
  &::before {
    content: 'XS';
    position: fixed;
    top: 10px;
    right: 10px;
    background: red;
    color: white;
    padding: 5px;
    z-index: 9999;
    font-size: 12px;
    
    @include media-min($breakpoint-sm) {
      content: 'SM';
    }
    
    @include media-min($breakpoint-md) {
      content: 'MD';
    }
    
    @include media-min($breakpoint-lg) {
      content: 'LG';
    }
    
    @include media-min($breakpoint-xl) {
      content: 'XL';
    }
    
    @include media-min($breakpoint-2xl) {
      content: '2XL';
    }
  }
}