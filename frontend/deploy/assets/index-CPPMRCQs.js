import{d as Y,r as y,i as T,w as ae,c as l,b as d,g as a,n as M,a as t,t as u,J as N,F as O,f as R,v as G,x as j,j as A,y as J,A as le,K as Ce,o as Se,k as F,G as v,m as se}from"./index.standard-DHpxIVC0.js";import{A as Te}from"./AdminLayout-CwVGqELj.js";import{u as Ie,T as Pe,D as Be,B as De,c as Ae,a as K}from"./common-actions-DhrMkVRx.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Me={class:"dialog-header"},Le={key:0,class:"header-icon"},Ve={class:"icon-text"},Ee={class:"dialog-title"},Oe={class:"dialog-content"},Re={key:0,class:"dialog-message"},ze={key:1,class:"warning-section"},Ue={class:"warning-text"},Fe={key:2,class:"details-section"},qe={class:"details-list"},Ke={key:3,class:"input-section"},Ne={class:"input-label"},Ge=["placeholder"],je=["placeholder"],Je={key:2,class:"checkbox-group"},Ye={class:"checkbox-label"},He={key:3,class:"input-error"},Qe={key:4,class:"affected-items"},We={class:"affected-title"},Xe={class:"affected-list"},Ze={key:0,class:"more-items"},et={class:"dialog-actions"},tt=["disabled"],st=["disabled"],at={key:0,class:"btn-spinner"},lt=Y({__name:"EnhancedConfirmationDialog",props:{visible:{type:Boolean},title:{},message:{},severity:{default:"info"},icon:{},showClose:{type:Boolean,default:!0},warning:{},details:{},inputRequired:{type:Boolean},inputType:{default:"text"},inputLabel:{},inputPlaceholder:{},inputValidation:{},confirmationText:{},affectedItems:{},maxDisplayItems:{default:5},operationText:{default:"处理"},confirmText:{},cancelText:{},processing:{type:Boolean},processingText:{default:"处理中..."},closeOnBackdrop:{type:Boolean,default:!0}},emits:["confirm","cancel","update:visible"],setup(q,{emit:c}){const i=q,k=c,h=y(""),b=y(!1),x=y(""),_=T(()=>({info:"ℹ️",warning:"⚠️",danger:"🚨",success:"✅"})[i.severity]),B=T(()=>i.affectedItems?i.affectedItems.slice(0,i.maxDisplayItems).map(r=>{var p;return typeof r=="string"?r:r.name||((p=r.id)==null?void 0:p.toString())||"未知项目"}):[]),C=T(()=>i.processing?!1:i.inputRequired?i.inputType==="checkbox"?b.value:i.confirmationText?h.value.toLowerCase().trim()===i.confirmationText.toLowerCase().trim():i.inputValidation?!i.inputValidation(h.value):h.value.trim().length>0:!0);ae(()=>i.visible,e=>{e&&(h.value="",b.value=!1,x.value="")});function $(){if(C.value){if(i.inputRequired&&i.inputValidation){const e=i.inputValidation(h.value);if(e){x.value=e;return}}k("confirm",h.value)}}function I(){k("cancel"),k("update:visible",!1)}function D(){i.closeOnBackdrop&&!i.processing&&I()}function S(){if(x.value="",i.inputValidation){const e=i.inputValidation(h.value);e&&(x.value=e)}}function L(e){b.value=e.detail?e.detail.value:e.target.checked}return(e,r)=>{const p=J("checkbox");return e.visible?(a(),l("view",{key:0,class:M(["enhanced-confirmation-dialog",{show:e.visible}])},[t("view",{class:"dialog-backdrop",onClick:D}),t("view",{class:M(["dialog-container",[`severity-${e.severity}`,{"input-mode":e.inputRequired}]])},[t("view",Me,[e.icon||_.value?(a(),l("view",Le,[t("text",Ve,u(e.icon||_.value),1)])):d("",!0),t("text",Ee,u(e.title),1),e.showClose?(a(),l("button",{key:1,class:"close-btn",onClick:I},r[3]||(r[3]=[t("text",null,"✕",-1)]))):d("",!0)]),t("view",Oe,[e.message?(a(),l("text",Re,u(e.message),1)):d("",!0),N(e.$slots,"content",{},void 0),e.warning?(a(),l("view",ze,[r[4]||(r[4]=t("view",{class:"warning-header"},[t("text",{class:"warning-icon"},"⚠️"),t("text",{class:"warning-title"},"注意事项")],-1)),t("text",Ue,u(e.warning),1)])):d("",!0),e.details&&e.details.length>0?(a(),l("view",Fe,[r[5]||(r[5]=t("text",{class:"details-title"},"详细信息：",-1)),t("view",qe,[(a(!0),l(O,null,R(e.details,(g,P)=>(a(),l("text",{key:P,class:"detail-item"}," • "+u(g),1))),128))])])):d("",!0),e.inputRequired?(a(),l("view",Ke,[t("text",Ne,u(e.inputLabel||"请输入以确认操作"),1),e.inputType==="text"?G((a(),l("input",{key:0,"onUpdate:modelValue":r[0]||(r[0]=g=>h.value=g),class:"confirmation-input",placeholder:e.inputPlaceholder,onInput:S},null,40,Ge)),[[j,h.value]]):e.inputType==="textarea"?G((a(),l("textarea",{key:1,"onUpdate:modelValue":r[1]||(r[1]=g=>h.value=g),class:"confirmation-textarea",placeholder:e.inputPlaceholder,onInput:S},null,40,je)),[[j,h.value]]):e.inputType==="checkbox"?(a(),l("view",Je,[A(p,{modelValue:b.value,"onUpdate:modelValue":r[2]||(r[2]=g=>b.value=g),class:"confirmation-checkbox",onChange:L},null,8,["modelValue"]),t("text",Ye,u(e.inputPlaceholder||"我已确认此操作"),1)])):d("",!0),x.value?(a(),l("text",He,u(x.value),1)):d("",!0)])):d("",!0),e.affectedItems&&e.affectedItems.length>0?(a(),l("view",Qe,[t("text",We,"将要"+u(e.operationText)+"的项目 ("+u(e.affectedItems.length)+"个)：",1),t("view",Xe,[(a(!0),l(O,null,R(B.value,(g,P)=>(a(),l("text",{key:P,class:"affected-item"},u(g),1))),128)),e.affectedItems.length>e.maxDisplayItems?(a(),l("text",Ze," ...以及其他 "+u(e.affectedItems.length-e.maxDisplayItems)+" 个项目 ",1)):d("",!0)])])):d("",!0)]),t("view",et,[N(e.$slots,"actions",{confirm:$,cancel:I},()=>[t("button",{class:"dialog-btn secondary",onClick:I,disabled:e.processing},u(e.cancelText||"取消"),9,tt),t("button",{class:M(["dialog-btn primary",[`severity-${e.severity}`]]),onClick:$,disabled:!C.value||e.processing},[e.processing?(a(),l("view",at)):d("",!0),t("text",null,u(e.processing?e.processingText:e.confirmText||"确认"),1)],10,st)])])],2)],2)):d("",!0)}}}),nt=H(lt,[["__scopeId","data-v-d2ebb33b"]]),ot={class:"modal-header"},it={class:"header-left"},rt={class:"status-icon"},ut={class:"header-text"},ct={class:"modal-title"},dt={class:"modal-subtitle"},pt={class:"modal-content"},vt={key:0,class:"progress-section"},gt={class:"progress-header"},mt={class:"progress-title"},ht={class:"progress-stats"},ft={class:"progress-bar-container"},wt={key:0,class:"current-step"},yt={key:1,class:"steps-section"},bt={class:"steps-list"},kt={class:"step-icon"},_t={key:0},$t={key:1},xt={key:2},Ct={key:3},St={class:"step-content"},Tt={class:"step-title"},It={key:0,class:"step-description"},Pt={key:1,class:"step-error"},Bt={key:2,class:"results-section"},Dt={key:0,class:"result-summary"},At={key:0,class:"summary-item success"},Mt={class:"summary-text"},Lt={key:1,class:"summary-item error"},Vt={class:"summary-text"},Et={key:2,class:"summary-item warning"},Ot={class:"summary-text"},Rt={key:3,class:"summary-item skipped"},zt={class:"summary-text"},Ut={key:1,class:"error-details"},Ft={class:"error-list"},qt={class:"error-message"},Kt={key:0,class:"error-item-name"},Nt={key:2,class:"download-section"},Gt={class:"download-list"},jt=["onClick"],Jt={class:"download-name"},Yt={class:"download-size"},Ht={class:"modal-actions"},Qt=["disabled"],Wt={key:0,class:"btn-spinner"},Xt=Y({__name:"OperationProgressModal",props:{visible:{type:Boolean},title:{},subtitle:{},showProgress:{type:Boolean,default:!0},progress:{default:0},total:{default:100},determinate:{type:Boolean,default:!0},progressTitle:{},currentStepText:{},steps:{},currentStepIndex:{default:-1},processing:{type:Boolean},currentStatus:{default:"processing"},results:{},downloadLinks:{},canClose:{type:Boolean,default:!0},canCancel:{type:Boolean,default:!0},canRetry:{type:Boolean,default:!0},maxErrorDisplay:{default:5}},emits:["close","cancel","retry","download","update:visible"],setup(q,{emit:c}){const i=q,k=c,h=y(!1),b=y(!1),x=T(()=>({processing:"⏳",completed:"✅",error:"❌",cancelled:"⏹️"})[i.currentStatus]||"⏳"),_=T(()=>i.determinate?i.total===0?0:Math.round(i.progress/i.total*100):100),B=T(()=>i.determinate?`${i.progress}/${i.total} (${_.value}%)`:"进行中..."),C=T(()=>{var e;return(e=i.results)!=null&&e.errors?h.value?i.results.errors:i.results.errors.slice(0,i.maxErrorDisplay):[]});ae(()=>i.currentStatus,e=>{e!=="processing"&&(b.value=!1)});function $(){k("close"),k("update:visible",!1)}function I(){i.processing?(b.value=!0,k("cancel")):$()}function D(){k("retry")}function S(e){k("download",e),e.url&&console.log("Download file:",e.name,e.url)}function L(e){if(!e)return"";const r=["B","KB","MB","GB"];let p=0,g=e;for(;g>=1024&&p<r.length-1;)g/=1024,p++;return`${g.toFixed(1)} ${r[p]}`}return(e,r)=>e.visible?(a(),l("view",{key:0,class:M(["operation-progress-modal",{show:e.visible}])},[r[11]||(r[11]=t("view",{class:"modal-backdrop"},null,-1)),t("view",{class:M(["modal-container",[`status-${e.currentStatus}`]])},[t("view",ot,[t("view",it,[t("text",rt,u(x.value),1),t("view",ut,[t("text",ct,u(e.title),1),t("text",dt,u(e.subtitle),1)])]),e.canClose&&!e.processing?(a(),l("button",{key:0,class:"close-btn",onClick:$},r[1]||(r[1]=[t("text",null,"✕",-1)]))):d("",!0)]),t("view",pt,[e.showProgress?(a(),l("view",vt,[t("view",gt,[t("text",mt,u(e.progressTitle),1),t("text",ht,u(B.value),1)]),t("view",ft,[t("view",{class:M(["progress-bar",{indeterminate:!e.determinate}]),style:le({width:_.value+"%"})},null,6)]),e.currentStepText?(a(),l("text",wt,u(e.currentStepText),1)):d("",!0)])):d("",!0),e.steps&&e.steps.length>0?(a(),l("view",yt,[r[2]||(r[2]=t("text",{class:"steps-title"},"操作步骤:",-1)),t("view",bt,[(a(!0),l(O,null,R(e.steps,(p,g)=>(a(),l("view",{key:g,class:M(["step-item",[`status-${p.status||"pending"}`,{current:g===e.currentStepIndex}]])},[t("view",kt,[p.status==="completed"?(a(),l("text",_t,"✅")):p.status==="error"?(a(),l("text",$t,"❌")):p.status==="processing"?(a(),l("text",xt,"⏳")):(a(),l("text",Ct,"⚪"))]),t("view",St,[t("text",Tt,u(p.title),1),p.description?(a(),l("text",It,u(p.description),1)):d("",!0),p.error?(a(),l("text",Pt,u(p.error),1)):d("",!0)])],2))),128))])])):d("",!0),e.results?(a(),l("view",Bt,[e.results.success!==void 0?(a(),l("view",Dt,[e.results.success>0?(a(),l("view",At,[r[3]||(r[3]=t("text",{class:"summary-icon"},"✅",-1)),t("text",Mt,"成功: "+u(e.results.success)+" 项",1)])):d("",!0),e.results.error>0?(a(),l("view",Lt,[r[4]||(r[4]=t("text",{class:"summary-icon"},"❌",-1)),t("text",Vt,"失败: "+u(e.results.error)+" 项",1)])):d("",!0),e.results.warning>0?(a(),l("view",Et,[r[5]||(r[5]=t("text",{class:"summary-icon"},"⚠️",-1)),t("text",Ot,"警告: "+u(e.results.warning)+" 项",1)])):d("",!0),e.results.skipped>0?(a(),l("view",Rt,[r[6]||(r[6]=t("text",{class:"summary-icon"},"⏭️",-1)),t("text",zt,"跳过: "+u(e.results.skipped)+" 项",1)])):d("",!0)])):d("",!0),e.results.errors&&e.results.errors.length>0?(a(),l("view",Ut,[r[7]||(r[7]=t("text",{class:"error-title"},"错误详情:",-1)),t("view",Ft,[(a(!0),l(O,null,R(C.value,(p,g)=>(a(),l("view",{key:g,class:"error-item"},[t("text",qt,u(p.message||p),1),p.item?(a(),l("text",Kt,"项目: "+u(p.item),1)):d("",!0)]))),128)),e.results.errors.length>e.maxErrorDisplay?(a(),l("button",{key:0,class:"show-more-errors",onClick:r[0]||(r[0]=p=>h.value=!h.value)},u(h.value?"收起":`查看全部 ${e.results.errors.length} 个错误`),1)):d("",!0)])])):d("",!0),e.downloadLinks&&e.downloadLinks.length>0?(a(),l("view",Nt,[r[9]||(r[9]=t("text",{class:"download-title"},"下载文件:",-1)),t("view",Gt,[(a(!0),l(O,null,R(e.downloadLinks,(p,g)=>(a(),l("button",{key:g,class:"download-btn",onClick:P=>S(p)},[r[8]||(r[8]=t("text",{class:"download-icon"},"📄",-1)),t("text",Jt,u(p.name),1),t("text",Yt,u(L(p.size)),1)],8,jt))),128))])])):d("",!0)])):d("",!0),N(e.$slots,"content",{},void 0)]),t("view",Ht,[N(e.$slots,"actions",{close:$,cancel:I,retry:D},()=>[e.processing&&e.canCancel?(a(),l("button",{key:0,class:"action-btn secondary",onClick:I,disabled:b.value},[b.value?(a(),l("view",Wt)):d("",!0),t("text",null,u(b.value?"取消中...":"取消操作"),1)],8,Qt)):d("",!0),e.currentStatus==="error"&&e.canRetry?(a(),l("button",{key:1,class:"action-btn retry",onClick:D},r[10]||(r[10]=[t("text",null,"重试操作",-1)]))):d("",!0),e.canClose?(a(),l("button",{key:2,class:"action-btn primary",onClick:$},[t("text",null,u(e.processing?"后台运行":"关闭"),1)])):d("",!0)])])],2)],2)):d("",!0)}}),Zt=H(Xt,[["__scopeId","data-v-517426d2"]]),es={class:"products-page"},ts={class:"filter-section admin-card"},ss={class:"filter-row"},as={class:"filter-item filter-search"},ls={class:"filter-item"},ns={class:"filter-picker"},os={class:"filter-item"},is={class:"filter-picker"},rs={class:"enhanced-table admin-card"},us={class:"table-header"},cs={class:"header-row"},ds={key:0,class:"header-selector"},ps=["onClick"],vs={class:"header-title"},gs={key:0,class:"sort-icon"},ms={class:"table-body"},hs=["src"],fs={key:1,class:"product-image-placeholder"},ws={class:"product-info"},ys={class:"product-name"},bs={class:"product-model"},ks={key:2,class:"empty-state"},_s={key:0,class:"table-pagination"},$s={class:"pagination-info"},xs={class:"pagination-controls"},Cs=["disabled"],Ss=["disabled"],Ts={key:0,class:"error-message"},Is=Y({__name:"index",setup(q){const c=Ce(),{selectedItems:i,selectAllChecked:k,selectAllIndeterminate:h,toggleSelection:b,selectAll:x,clearSelection:_}=Ie(),B=y(""),C=y(""),$=T(()=>["全部分类",...c.productCategories]),I=T(()=>{const n=$.value.indexOf(C.value);return n>=0?n:0}),D=[{value:null,label:"全部状态"},{value:!0,label:"在售"},{value:!1,label:"已下架"}],S=y(0),L=[{key:"image",title:"图片",width:"80px",align:"center"},{key:"name",title:"产品信息",width:"200px"},{key:"category",title:"分类",width:"120px"},{key:"price",title:"价格",width:"120px",align:"right",sortable:!0},{key:"unit",title:"单位",width:"80px",align:"center"},{key:"status",title:"状态",width:"100px",align:"center"},{key:"created_at",title:"创建时间",width:"160px",sortable:!0,formatter:n=>{const o=new Date(n);return`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")}`}}],e=L.map(n=>({key:n.key,label:n.title,width:n.width,align:n.align,sortable:n.sortable,type:n.key==="image"?"image":n.key==="price"?"price":n.key==="created_at"?"date":n.key==="status"?"status":"text"})),r=[K.products.view,K.products.edit,K.products.images,K.products.delete],p=Ae.products,g=y(""),P=y("asc"),U=y(!1),V=y(0),E=y(""),w=y({visible:!1,title:"",message:"",severity:"info",warning:"",details:[],affectedItems:[],operationText:"",confirmAction:null}),s=y({visible:!1,title:"",subtitle:"",currentStatus:"processing",progress:0,total:100,steps:[],currentStepIndex:0,results:null,downloadLinks:[]}),Q=T(()=>Math.ceil(c.total/c.pageSize));function ne(n,o){b(o.id)}function oe(n){uni.navigateTo({url:`/pages/admin/products/detail?id=${n.id}`})}function ie(n,o){switch(n){case"view":uni.navigateTo({url:`/pages/admin/products/detail?id=${o.id}`});break;case"edit":uni.navigateTo({url:`/pages/admin/products/edit?id=${o.id}`});break;case"images":uni.navigateTo({url:`/pages/admin/products/images?id=${o.id}`});break;case"delete":ge(o);break;default:console.warn("Unknown action:",n)}}function W(n){const o=n.detail?n.detail.value:n;x(c.filteredProducts.map(f=>f.id),o)}function re(n){g.value===n?P.value=P.value==="asc"?"desc":"asc":(g.value=n,P.value="asc"),c.setPage(1)}function ue(n){return g.value!==n?"↕":P.value==="asc"?"↑":"↓"}function X(n){c.setPage(n)}async function ce(n,o){switch(n){case"export":await Z();break;case"enable":await de();break;case"disable":await pe();break;case"delete":await ve();break}}async function Z(){const n=i.value.length;s.value={visible:!0,title:"批量导出产品",subtitle:`正在导出 ${n} 个产品到Excel文件`,currentStatus:"processing",progress:0,total:100,steps:[{title:"准备数据",status:"processing",description:"收集选中的产品信息"},{title:"生成Excel",status:"pending",description:"创建Excel文件并格式化数据"},{title:"文件打包",status:"pending",description:"压缩文件并准备下载"},{title:"完成导出",status:"pending",description:"导出完成，准备下载文件"}],currentStepIndex:0,results:null,downloadLinks:[]};try{s.value.progress=25,s.value.steps[0].status="completed",s.value.steps[1].status="processing",s.value.currentStepIndex=1,await new Promise(f=>setTimeout(f,800)),s.value.progress=60,s.value.steps[1].status="completed",s.value.steps[2].status="processing",s.value.currentStepIndex=2;const o=await c.exportProducts(i.value);s.value.progress=85,s.value.steps[2].status="completed",s.value.steps[3].status="processing",s.value.currentStepIndex=3,await new Promise(f=>setTimeout(f,500)),s.value.progress=100,s.value.steps[3].status="completed",s.value.currentStatus="completed",s.value.subtitle=`成功导出 ${n} 个产品`,s.value.results={success:n,error:0,warning:0,skipped:0},s.value.downloadLinks=[{name:`产品导出_${new Date().toISOString().split("T")[0]}.xlsx`,url:(o==null?void 0:o.downloadUrl)||"#",size:Math.floor(Math.random()*5e5)+1e5,type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}],_()}catch{s.value.currentStatus="error",s.value.subtitle="导出过程中发生错误",s.value.steps[s.value.currentStepIndex].status="error",s.value.steps[s.value.currentStepIndex].error="导出失败，请重试或联系技术支持",s.value.results={success:0,error:n,errors:[{message:"网络连接超时，请检查网络状态"},{message:"服务器暂时无法处理请求"},{message:"部分产品数据格式异常"}]}}}async function de(){try{U.value=!0,V.value=50,E.value=`启用 ${i.value.length} 个产品...`,await c.batchUpdateStatus(i.value,!0),V.value=100,E.value="启用完成",uni.showToast({title:`成功启用 ${i.value.length} 个产品`,icon:"success"}),_()}catch{uni.showToast({title:"批量启用失败",icon:"none"})}finally{setTimeout(()=>{U.value=!1,V.value=0,E.value=""},1e3)}}async function pe(){try{U.value=!0,V.value=50,E.value=`停用 ${i.value.length} 个产品...`,await c.batchUpdateStatus(i.value,!1),V.value=100,E.value="停用完成",uni.showToast({title:`成功停用 ${i.value.length} 个产品`,icon:"success"}),_()}catch{uni.showToast({title:"批量停用失败",icon:"none"})}finally{setTimeout(()=>{U.value=!1,V.value=0,E.value=""},1e3)}}async function ve(){const n=i.value.length,o=c.filteredProducts.filter(f=>i.value.includes(f.id));w.value={visible:!0,title:"批量删除产品确认",message:`您确定要删除选中的 ${n} 个产品吗？此操作不可撤销。`,severity:"danger",warning:"批量删除将永久移除这些产品的所有信息，包括关联的图片和历史数据。",details:["所有选中产品的基础信息将被永久删除","关联的产品图片将被移除","历史报价中的产品信息将保留但标记为已删除","删除操作将记录在系统审计日志中","此操作完成后无法撤销"],affectedItems:o.map(f=>`${f.name} (${f.model})`),operationText:"删除",confirmAction:async()=>{try{w.value.visible=!1,s.value={visible:!0,title:"批量删除产品",subtitle:`正在删除 ${n} 个产品`,currentStatus:"processing",progress:0,total:100,steps:[{title:"验证权限",status:"processing",description:"检查删除权限和依赖关系"},{title:"备份数据",status:"pending",description:"创建删除前的数据备份"},{title:"删除产品",status:"pending",description:"从数据库中移除产品记录"},{title:"清理资源",status:"pending",description:"删除相关图片和文件"}],currentStepIndex:0,results:null,downloadLinks:[]},s.value.progress=25,s.value.steps[0].status="completed",s.value.steps[1].status="processing",s.value.currentStepIndex=1,await new Promise(f=>setTimeout(f,500)),s.value.progress=50,s.value.steps[1].status="completed",s.value.steps[2].status="processing",s.value.currentStepIndex=2,await c.batchDeleteProducts(i.value),s.value.progress=85,s.value.steps[2].status="completed",s.value.steps[3].status="processing",s.value.currentStepIndex=3,await new Promise(f=>setTimeout(f,300)),s.value.progress=100,s.value.steps[3].status="completed",s.value.currentStatus="completed",s.value.subtitle=`成功删除 ${n} 个产品`,s.value.results={success:n,error:0,warning:0,skipped:0},_()}catch{s.value.currentStatus="error",s.value.subtitle="批量删除失败",s.value.steps[s.value.currentStepIndex].status="error",s.value.steps[s.value.currentStepIndex].error="删除操作失败，请重试",s.value.results={success:0,error:n,errors:[{message:"部分产品存在依赖关系，无法删除"},{message:"网络连接异常，请检查网络状态"}]}}}}}async function ge(n){w.value={visible:!0,title:"确认删除产品",message:`您确定要删除产品"${n.name}"吗？此操作不可撤销。`,severity:"danger",warning:"删除后将无法恢复该产品的所有信息，包括关联的报价记录。",details:["产品的所有基础信息将被永久删除","关联的图片文件将被移除","历史报价中的产品信息将保留但无法编辑","删除操作将记录在系统日志中"],affectedItems:[n.name],operationText:"删除",confirmAction:async()=>{try{const o=await c.deleteProduct(n.id);o.success?(uni.showToast({title:"产品删除成功",icon:"success"}),w.value.visible=!1):uni.showToast({title:o.error||"删除失败",icon:"none"})}catch{uni.showToast({title:"删除操作失败",icon:"none"})}}}}const ee=()=>{c.searchKeyword=B.value,c.setPage(1)},me=n=>{const o=n.detail.value;C.value=o===0?"":$.value[o],c.categoryFilter=C.value,c.setPage(1)},he=n=>{S.value=n.detail.value,c.statusFilter=D[S.value].value,c.setPage(1)},fe=()=>{B.value="",C.value="",S.value=0,c.resetFilters()},te=()=>{uni.navigateTo({url:"/pages/admin/products/edit"})};function we(){w.value.confirmAction&&w.value.confirmAction()}function ye(){w.value.visible=!1,w.value.confirmAction=null}function be(){s.value.visible=!1}function ke(){console.log("Cancelling operation..."),s.value.currentStatus="cancelled",s.value.subtitle="操作已取消"}function _e(){s.value.title.includes("导出")&&Z()}function $e(n){console.log("Download file:",n.name),uni.showToast({title:"开始下载文件",icon:"success"})}return Se(()=>{c.fetchProducts()}),(n,o)=>{const f=J("picker"),xe=J("checkbox");return a(),l("view",es,[A(Te,null,{default:F(()=>[t("view",{class:"page-header"},[o[6]||(o[6]=t("view",{class:"header-left"},[t("text",{class:"page-title"},"产品管理"),t("text",{class:"page-subtitle"},"管理台球桌、地毯和配件产品")],-1)),t("view",{class:"header-right"},[t("button",{class:"admin-btn admin-btn-primary",onClick:te},o[5]||(o[5]=[t("text",null,"+ 添加产品",-1)]))])]),t("view",ts,[t("view",ss,[t("view",as,[G(t("input",{"onUpdate:modelValue":o[0]||(o[0]=m=>B.value=m),class:"search-input",type:"text",placeholder:"搜索产品名称或型号",onConfirm:ee},null,544),[[j,B.value]]),t("button",{class:"search-btn",onClick:ee},"搜索")]),t("view",ls,[A(f,{mode:"selector",range:$.value,value:I.value,onChange:me},{default:F(()=>[t("view",ns,[t("text",null,u(C.value||"全部分类"),1),o[7]||(o[7]=t("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["range","value"])]),t("view",os,[A(f,{mode:"selector",range:D,"range-key":"label",value:S.value,onChange:he},{default:F(()=>[t("view",is,[t("text",null,u(D[S.value].label),1),o[8]||(o[8]=t("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])]),t("button",{class:"filter-reset",onClick:fe},"重置")])]),t("view",rs,[t("view",us,[t("view",cs,[v(i).length>0?(a(),l("view",ds,[A(xe,{checked:v(k),indeterminate:v(h),onChange:W},null,8,["checked","indeterminate"])])):d("",!0),(a(),l(O,null,R(L,m=>t("view",{key:m.key,class:M(["header-cell",[`align-${m.align||"left"}`,{sortable:m.sortable}]]),style:le({width:m.width,flex:m.flex}),onClick:z=>m.sortable&&re(m.key)},[t("text",vs,u(m.title),1),m.sortable?(a(),l("text",gs,u(ue(m.key)),1)):d("",!0)],14,ps)),64))])]),t("view",ms,[v(c).isLoading?(a(),se(Pe,{key:0,rows:v(c).pageSize,columns:L.length,"has-selection":!0,"show-header":!1},null,8,["rows","columns"])):(a(!0),l(O,{key:1},R(v(c).filteredProducts,m=>(a(),se(Be,{key:m.id,item:m,columns:v(e),selectable:!0,selected:v(i).includes(m.id),actions:r,"touch-optimized":!0,onSelect:ne,onClick:oe,onAction:ie},{"cell-image":F(({item:z})=>[z.image_url?(a(),l("image",{key:0,src:z.image_url,mode:"aspectFill",class:"product-image"},null,8,hs)):(a(),l("view",fs,o[9]||(o[9]=[t("text",null,"📷",-1)])))]),"cell-name":F(({item:z})=>[t("view",ws,[t("text",ys,u(z.name),1),t("text",bs,"型号: "+u(z.model),1)])]),_:2},1032,["item","columns","selected"]))),128)),!v(c).isLoading&&v(c).filteredProducts.length===0?(a(),l("view",ks,[o[10]||(o[10]=t("text",{class:"empty-text"},"暂无产品数据",-1)),t("button",{class:"empty-action",onClick:te},"添加产品")])):d("",!0)]),v(c).total>v(c).pageSize?(a(),l("view",_s,[t("view",$s," 共 "+u(v(c).total)+" 条，第 "+u(v(c).currentPage)+"/"+u(Q.value)+" 页 ",1),t("view",xs,[t("button",{class:"pagination-btn",disabled:v(c).currentPage<=1,onClick:o[1]||(o[1]=m=>X(v(c).currentPage-1))}," 上一页 ",8,Cs),t("button",{class:"pagination-btn",disabled:v(c).currentPage>=Q.value,onClick:o[2]||(o[2]=m=>X(v(c).currentPage+1))}," 下一页 ",8,Ss)])])):d("",!0)]),A(De,{"selected-count":v(i).length,operations:v(p),"show-progress":U.value,"current-progress":V.value,"progress-text":E.value,"select-all-checked":v(k),"select-all-indeterminate":v(h),onOperation:ce,onClearSelection:v(_),onSelectAll:W},null,8,["selected-count","operations","show-progress","current-progress","progress-text","select-all-checked","select-all-indeterminate","onClearSelection"]),v(c).error?(a(),l("view",Ts,[t("text",null,u(v(c).error),1)])):d("",!0),A(nt,{visible:w.value.visible,title:w.value.title,message:w.value.message,severity:w.value.severity,warning:w.value.warning,details:w.value.details,"affected-items":w.value.affectedItems,"operation-text":w.value.operationText,onConfirm:we,onCancel:ye,"onUpdate:visible":o[3]||(o[3]=m=>w.value.visible=m)},null,8,["visible","title","message","severity","warning","details","affected-items","operation-text"]),A(Zt,{visible:s.value.visible,title:s.value.title,subtitle:s.value.subtitle,"current-status":s.value.currentStatus,progress:s.value.progress,total:s.value.total,steps:s.value.steps,"current-step-index":s.value.currentStepIndex,results:s.value.results,"download-links":s.value.downloadLinks,"can-cancel":s.value.currentStatus==="processing",onClose:be,onCancel:ke,onRetry:_e,onDownload:$e,"onUpdate:visible":o[4]||(o[4]=m=>s.value.visible=m)},null,8,["visible","title","subtitle","current-status","progress","total","steps","current-step-index","results","download-links","can-cancel"])]),_:1})])}}}),Ms=H(Is,[["__scopeId","data-v-4354c210"]]);export{Ms as default};
