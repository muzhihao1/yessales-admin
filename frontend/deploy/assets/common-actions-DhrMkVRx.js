import{d as N,c as o,b as w,F as B,f as L,a as b,g as l,A as V,n as $,r as M,i as _,o as Y,M as J,m as D,y as E,t as x,j as P,z as U,J as le,p as H,P as oe,w as ne,k as ae,T as re,h as ie}from"./index.standard-DHpxIVC0.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"table-loading-skeleton"},ue={key:0,class:"skeleton-row skeleton-header"},de={key:0,class:"skeleton-checkbox"},fe={key:1,class:"skeleton-actions"},he={key:0,class:"skeleton-checkbox"},pe={key:1,class:"skeleton-actions"},ve=N({__name:"TableLoadingSkeleton",props:{rows:{default:5},columns:{default:()=>["name","status","date","value"]},showHeader:{type:Boolean,default:!0},hasSelection:{type:Boolean,default:!0},hasActions:{type:Boolean,default:!0},size:{default:"medium"}},setup(u){const t=i=>({name:"25%",status:"15%",date:"20%",value:"15%",email:"25%",phone:"20%",company:"20%",category:"15%",price:"15%",quantity:"10%"})[i]||"20%",n=i=>({name:"skeleton-text-long",email:"skeleton-text-long",company:"skeleton-text-long",status:"skeleton-text-short",date:"skeleton-text-medium",value:"skeleton-text-short",price:"skeleton-text-short",phone:"skeleton-text-medium",category:"skeleton-text-short",quantity:"skeleton-text-short"})[i]||"skeleton-text-medium";return(i,a)=>(l(),o("view",ce,[i.showHeader?(l(),o("view",ue,[i.hasSelection?(l(),o("view",de)):w("",!0),(l(!0),o(B,null,L(i.columns,c=>(l(),o("view",{class:"skeleton-cell",key:c,style:V({width:t(c)})},a[0]||(a[0]=[b("view",{class:"skeleton-text skeleton-text-header"},null,-1)]),4))),128)),i.hasActions?(l(),o("view",fe,a[1]||(a[1]=[b("view",{class:"skeleton-text skeleton-text-small"},null,-1)]))):w("",!0)])):w("",!0),(l(!0),o(B,null,L(i.rows,c=>(l(),o("view",{class:"skeleton-row skeleton-body",key:c},[i.hasSelection?(l(),o("view",he,a[2]||(a[2]=[b("view",{class:"skeleton-checkbox-box"},null,-1)]))):w("",!0),(l(!0),o(B,null,L(i.columns,v=>(l(),o("view",{class:"skeleton-cell",key:v,style:V({width:t(v)})},[b("view",{class:$(["skeleton-text",n(v)])},null,2)],4))),128)),i.hasActions?(l(),o("view",pe,[(l(),o(B,null,L(3,v=>b("view",{class:"skeleton-action-btn",key:v})),64))])):w("",!0)]))),128))]))}}),st=R(ve,[["__scopeId","data-v-38937225"]]),W=async u=>{const{title:t,content:n,showCancel:i=!0,cancelText:a="取消",confirmText:c="确定",type:v="info"}=u;return new Promise(C=>{if(typeof uni<"u"&&uni.showModal)uni.showModal({title:t,content:n,showCancel:i,cancelText:a,confirmText:c,success:m=>{C({confirm:m.confirm||!1,cancel:m.cancel||!1})},fail:()=>{C({confirm:!1,cancel:!0})}});else{const m=window.confirm(`${t}

${n}`);C({confirm:m,cancel:!m})}})},F=(u,t="success",n=2e3)=>{typeof uni<"u"&&uni.showToast?uni.showToast({title:u,icon:t==="error"?"error":t==="success"?"success":"none",duration:n}):(console.log(`[${t.toUpperCase()}] ${u}`),t==="error"?console.error(u):t==="warning"?console.warn(u):console.info(u))},ye=["disabled","onClick"],ge={key:1,class:"btn-text"},me={key:2,class:"loading-indicator"},ke=["onClick"],we={key:1,class:"btn-text"},be={key:0,class:"dropdown-menu"},Ce=["onClick"],$e={class:"item-text"},_e={key:0,class:"more-menu"},xe=["onClick"],Se={class:"item-text"},ze=N({__name:"ActionButtonGroup",props:{actions:{default:()=>[]},item:{},size:{default:"medium"},direction:{default:"horizontal"},maxVisible:{default:4},showText:{type:Boolean,default:!1},touchOptimized:{type:Boolean,default:!0}},emits:["action"],setup(u,{emit:t}){const n=u,i=t,a=M(null),c=M(!1),v=_(()=>n.actions.filter(r=>!r.hidden)),C=_(()=>n.maxVisible<=0?v.value:v.value.slice(0,n.maxVisible)),m=_(()=>n.maxVisible<=0?[]:v.value.slice(n.maxVisible)),h=_(()=>m.value.length>0),k=()=>({small:14,medium:16,large:18})[n.size],S=r=>r.disabled?"var(--text-color-disabled)":{default:"var(--text-color-secondary)",primary:"var(--color-primary)",success:"var(--color-success)",warning:"var(--color-warning)",danger:"var(--color-error)"}[r.type||"default"],s=async r=>{if(!(r.disabled||r.loading))try{if(r.requiresConfirmation){const O=r.confirmTitle||"确认操作",T=r.confirmMessage||`确定要执行"${r.label}"操作吗？`;if(!(await W({title:O,content:T,showCancel:!0,confirmColor:r.type==="danger"?"#e53e3e":"#007aff"})).confirm)return}a.value=null,c.value=!1,i("action",r.key,n.item)}catch(O){console.error("操作执行失败:",O)}},y=r=>{a.value=a.value===r?null:r,c.value=!1},A=()=>{c.value=!c.value,a.value=null},g=r=>{r.target.closest(".action-button-group")||(a.value=null,c.value=!1)};return Y(()=>{document.addEventListener("click",g)}),J(()=>{document.removeEventListener("click",g)}),(r,O)=>{const T=E("uni-icons");return l(),o("view",{class:$(["action-button-group",[`direction-${r.direction}`,`size-${r.size}`,{"touch-optimized":r.touchOptimized}]])},[(l(!0),o(B,null,L(C.value,d=>(l(),o(B,{key:d.key},[d.dropdown?(l(),o("view",{key:1,class:$(["dropdown-wrapper",{"dropdown-open":a.value===d.key}])},[b("button",{class:$(["action-btn btn-dropdown",`btn-${d.type||"default"}`]),onClick:z=>y(d.key)},[d.icon?(l(),D(T,{key:0,type:d.icon,size:k(),color:S(d)},null,8,["type","size","color"])):w("",!0),r.showText?(l(),o("text",we,x(d.label),1)):w("",!0),P(T,{type:"down",size:12,class:$(["dropdown-arrow",{"arrow-up":a.value===d.key}])},null,8,["class"])],10,ke),a.value===d.key?(l(),o("view",be,[(l(!0),o(B,null,L(d.dropdown,z=>(l(),o("view",{key:z.key,class:$(["dropdown-item",`item-${z.type||"default"}`]),onClick:j=>s(z)},[z.icon?(l(),D(T,{key:0,type:z.icon,size:16,color:S(z)},null,8,["type","color"])):w("",!0),b("text",$e,x(z.label),1)],10,Ce))),128))])):w("",!0)],2)):(l(),o("button",{key:0,class:$(["action-btn",[`btn-${d.type||"default"}`,{"btn-loading":d.loading,"btn-disabled":d.disabled}]]),disabled:d.disabled||d.loading,onClick:z=>s(d)},[d.icon?(l(),D(T,{key:0,type:d.icon,size:k(),color:S(d)},null,8,["type","size","color"])):w("",!0),r.showText?(l(),o("text",ge,x(d.label),1)):w("",!0),d.loading?(l(),o("view",me,[P(T,{type:"spinner-cycle",size:k()},null,8,["size"])])):w("",!0)],10,ye))],64))),128)),h.value?(l(),o("view",{key:0,class:$(["more-actions",{"more-open":c.value}])},[b("button",{class:"action-btn btn-more",onClick:A},[P(T,{type:"more-filled",size:k()},null,8,["size"])]),c.value?(l(),o("view",_e,[(l(!0),o(B,null,L(m.value,d=>(l(),o("view",{key:d.key,class:$(["more-item",`item-${d.type||"default"}`]),onClick:z=>s(d)},[d.icon?(l(),D(T,{key:0,type:d.icon,size:16,color:S(d)},null,8,["type","color"])):w("",!0),b("text",Se,x(d.label),1)],10,xe))),128))])):w("",!0)],2)):w("",!0)],2)}}}),Te=R(ze,[["__scopeId","data-v-d960438d"]]),Be={class:"cell-content"},Me=["src"],Ae={key:2,class:"cell-price"},Oe={key:3,class:"cell-date"},Le=["onClick"],Pe={key:0,class:"expand-toggle"},Ie={key:5,class:"cell-text"},De={key:1,class:"row-cell row-actions"},Ve=N({__name:"DataTableRow",props:{item:{},columns:{},selectable:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},actions:{default:()=>[]},size:{default:"medium"},touchOptimized:{type:Boolean,default:!0},actionButtonSize:{default:"small"},maxVisibleActions:{default:3},virtualIndex:{default:void 0},virtualHeight:{default:void 0}},emits:["select","click","action","height-change"],setup(u,{emit:t}){const n=u,i=t,a=M(new Set),c=M(),v=_(()=>n.virtualIndex!==void 0),C=_(()=>v.value?{height:n.virtualHeight?`${n.virtualHeight}px`:"auto",transform:n.virtualIndex!==void 0?`translateY(${n.virtualIndex*(n.virtualHeight||60)}px)`:"none",position:"absolute",top:0,left:0,right:0,zIndex:1}:{}),m=oe("statusConfig",{}),h=e=>e.split(".").reduce((p,I)=>p==null?void 0:p[I],n.item),k=e=>e.toLowerCase().includes("status")||e.toLowerCase().includes("state"),S=e=>e.toLowerCase().includes("image")||e.toLowerCase().includes("avatar")||e.toLowerCase().includes("photo"),s=e=>e.toLowerCase().includes("price")||e.toLowerCase().includes("amount")||e.toLowerCase().includes("cost"),y=e=>e.toLowerCase().includes("time")||e.toLowerCase().includes("date")||e.toLowerCase().includes("created")||e.toLowerCase().includes("updated"),A=e=>{const p=h(e);return typeof p=="string"&&p.length>50},g=e=>({pending:"warning",approved:"success",rejected:"danger",draft:"default",active:"success",inactive:"default",disabled:"danger",available:"success",unavailable:"warning",discontinued:"danger",success:"success",warning:"warning",error:"danger",info:"info",...m})[e]||"default",r=e=>({pending:"待处理",approved:"已通过",rejected:"已拒绝",draft:"草稿",active:"启用",inactive:"未激活",disabled:"禁用",available:"可用",unavailable:"不可用",discontinued:"停产",success:"成功",warning:"警告",error:"错误",info:"信息"})[e]||e,O=e=>{const p=typeof e=="string"?parseFloat(e):e;return isNaN(p)?"0.00":p.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2})},T=e=>{if(!e)return"-";const p=new Date(e);if(isNaN(p.getTime()))return e;const I=p.getFullYear(),f=String(p.getMonth()+1).padStart(2,"0"),G=String(p.getDate()).padStart(2,"0"),te=String(p.getHours()).padStart(2,"0"),se=String(p.getMinutes()).padStart(2,"0");return`${I}-${f}-${G} ${te}:${se}`},d=(e,p)=>typeof e!="string"?String(e||""):e.length>p?e.substring(0,p)+"...":e,z=e=>{const p=h(e);return typeof p=="string"&&p.length>50},j=e=>{a.value.has(e)?a.value.delete(e):a.value.add(e)},K=()=>{n.disabled||i("click",n.item)},Q=e=>{i("select",e.detail.value,n.item)},X=e=>{i("action",e,n.item)},Z=e=>{e.target.src="/static/images/placeholder.png"},ee=()=>{if(!v.value||!c.value)return;const e=new ResizeObserver(p=>{for(const I of p){const f=I.contentRect.height;f&&n.item.id&&i("height-change",n.item.id,f)}});return e.observe(c.value),()=>{e.disconnect()}};let q=null;return Y(()=>{v.value&&(q=ee())}),J(()=>{q==null||q()}),(e,p)=>{const I=E("checkbox");return l(),o("view",{ref_key:"rowRef",ref:c,class:$(["data-table-row",[{"row-selected":e.selected,"row-hover":!e.disabled,"row-disabled":e.disabled,"touch-optimized":e.touchOptimized,"virtual-row":v.value},`size-${e.size}`]]),style:V(C.value),onClick:K},[e.selectable?(l(),o("view",{key:0,class:"row-cell row-selector",onClick:p[0]||(p[0]=U(()=>{},["stop"]))},[P(I,{checked:e.selected,disabled:e.disabled,onChange:Q,class:$({"checkbox-touch":e.touchOptimized})},null,8,["checked","disabled","class"])])):w("",!0),(l(!0),o(B,null,L(e.columns,f=>(l(),o("view",{key:f.key,class:$(["row-cell",[`cell-${f.key}`,`align-${f.align||"left"}`,{"cell-sortable":f.sortable}]]),style:V({width:f.width,flex:f.flex})},[le(e.$slots,`cell-${f.key}`,{item:e.item,column:f,value:h(f.key)},()=>[b("view",Be,[k(f.key)?(l(),o("view",{key:0,class:$(["status-tag",`status-${g(h(f.key))}`])},x(r(h(f.key))),3)):S(f.key)?(l(),o("image",{key:1,src:h(f.key),class:$(["cell-image",{"image-placeholder":!h(f.key)}]),mode:"aspectFit",onError:Z},null,42,Me)):s(f.key)?(l(),o("text",Ae," ¥"+x(O(h(f.key))),1)):y(f.key)?(l(),o("text",Oe,x(T(h(f.key))),1)):A(f.key)?(l(),o("text",{key:4,class:$(["cell-long-text",{"text-expanded":a.value.has(f.key)}]),onClick:U(G=>j(f.key),["stop"])},[H(x(a.value.has(f.key)?h(f.key):d(h(f.key),50))+" ",1),z(f.key)?(l(),o("text",Pe,x(a.value.has(f.key)?"收起":"展开"),1)):w("",!0)],10,Le)):(l(),o("text",Ie,x(h(f.key)||"-"),1))])])],6))),128)),e.actions&&e.actions.length>0?(l(),o("view",De,[P(Te,{actions:e.actions,item:e.item,size:e.actionButtonSize,"touch-optimized":e.touchOptimized,"max-visible":e.maxVisibleActions,onAction:X},null,8,["actions","item","size","touch-optimized","max-visible"])])):w("",!0)],6)}}}),lt=R(Ve,[["__scopeId","data-v-2d69f3b9"]]),qe={key:0,class:"batch-operation-bar"},Ee={class:"batch-info"},Fe={class:"selection-text"},Ne={class:"selection-count"},Re={class:"batch-operations"},He=["disabled","onClick"],We={key:1,class:"loading-spinner"},je={class:"btn-text"},Ge={key:2,class:"progress-badge"},Ue={key:0,class:"progress-container"},Ye={class:"progress-bar"},Je={class:"progress-text"},Ke=N({__name:"BatchOperationBar",props:{selectedCount:{default:0},operations:{default:()=>[]},showProgress:{type:Boolean,default:!1},currentProgress:{default:0},progressText:{default:""},selectAllChecked:{type:Boolean,default:!1},selectAllIndeterminate:{type:Boolean,default:!1},maxWidth:{default:"100%"}},emits:["operation","clearSelection","selectAll"],setup(u,{expose:t,emit:n}){const i=u,a=n,c=M(new Set),v=_(()=>i.operations.filter(s=>!s.hidden)),C=async s=>{if(!(s.disabled||c.value.has(s.key)))try{if(s.requiresConfirmation){const y=s.confirmTitle||"确认批量操作",A=s.confirmMessage||`确定要对选中的 ${i.selectedCount} 个项目执行"${s.label}"操作吗？`;if(!(await W({title:y,content:A,showCancel:!0,confirmColor:s.type==="danger"?"#e53e3e":"#007aff"})).confirm)return}c.value.add(s.key),a("operation",s.key,i.selectedCount),i.selectedCount>1&&F(`开始${s.label} ${i.selectedCount} 个项目...`)}catch(y){console.error("批量操作失败:",y),F(`${s.label}失败`,"error")}},m=s=>{c.value.delete(s)},h=()=>{c.value.clear()},k=s=>{a("selectAll",s.detail.value)},S=()=>{a("clearSelection")};return ne(()=>i.currentProgress,(s,y)=>{y>0&&s===0&&setTimeout(()=>{h()},500)}),t({clearOperationLoading:m,clearAllLoading:h}),(s,y)=>{const A=E("checkbox"),g=E("uni-icons");return l(),D(re,{name:"batch-bar"},{default:ae(()=>[s.selectedCount>0?(l(),o("view",qe,[b("view",Ee,[P(A,{checked:s.selectAllChecked,indeterminate:s.selectAllIndeterminate,onChange:k,class:"batch-select-all"},null,8,["checked","indeterminate"]),b("text",Fe,[y[0]||(y[0]=H(" 已选择 ",-1)),b("text",Ne,x(s.selectedCount),1),y[1]||(y[1]=H(" 项 ",-1))]),b("button",{class:"clear-selection",onClick:S},[P(g,{type:"close",size:"14"}),y[2]||(y[2]=b("text",null,"清空",-1))])]),b("view",Re,[(l(!0),o(B,null,L(v.value,r=>(l(),o("button",{key:r.key,class:$(["operation-btn",[`btn-${r.type||"default"}`,{"btn-loading":c.value.has(r.key)}]]),disabled:r.disabled||c.value.has(r.key),onClick:O=>C(r)},[r.icon&&!c.value.has(r.key)?(l(),D(g,{key:0,type:r.icon,size:"16"},null,8,["type"])):w("",!0),c.value.has(r.key)?(l(),o("view",We,[P(g,{type:"spinner-cycle",size:"16"})])):w("",!0),b("text",je,x(r.label),1),s.showProgress&&r.progress!==void 0?(l(),o("view",Ge,x(r.progress)+"% ",1)):w("",!0)],10,He))),128))]),s.showProgress&&s.currentProgress>0?(l(),o("view",Ue,[b("view",Ye,[b("view",{class:"progress-fill",style:V({width:s.currentProgress+"%"})},null,4)]),b("text",Je,x(s.progressText),1)])):w("",!0)])):w("",!0)]),_:1})}}}),ot=R(Ke,[["__scopeId","data-v-12bf8cdb"]]);function Qe(){const u=M(new Set),t=M(!1),n=M(!1),i=_(()=>u.value.size),a=_(()=>i.value>0),c=s=>u.value.has(s),v=s=>{u.value.has(s)?u.value.delete(s):u.value.add(s),h()},C=s=>{t.value?u.value.clear():s.forEach(y=>u.value.add(y.id)),h()},m=()=>{u.value.clear(),h()},h=()=>{const s=u.value.size;t.value=s>0&&n.value===!1,n.value=s>0&&!t.value},k=s=>{const y=u.value.size;y===0?(t.value=!1,n.value=!1):y===s?(t.value=!0,n.value=!1):(t.value=!1,n.value=!0)},S=s=>s.filter(y=>u.value.has(y.id));return{selectedIds:_(()=>Array.from(u.value)),selectedCount:i,hasSelection:a,selectAll:t,indeterminate:n,isSelected:c,toggleSelection:v,toggleSelectAll:C,clearSelection:m,updateSelectAllStateWithTotal:k,getSelectedItems:S}}function Xe(){const u=M(!1),t=M(0);return{loading:u,progress:t,executeBatchOperation:async(i,a,c,v)=>{var C;if(i.requiresConfirmation!==!1){const m=i.confirmMessage||`确定要对选中的 ${a.length} 个项目执行"${i.label}"操作吗？`;if(!(await W({title:"确认批量操作",content:m,showCancel:!0})).confirm)return!1}try{if(u.value=!0,t.value=0,v!=null&&v.showProgress){const m=Math.ceil(a.length/10)||1,h=[];for(let k=0;k<a.length;k+=m)h.push(a.slice(k,k+m));for(let k=0;k<h.length;k++)await c(h[k]),t.value=Math.round((k+1)/h.length*100),(C=v.onProgress)==null||C.call(v,k+1,h.length)}else await c(a),t.value=100;return F(`成功${i.label} ${a.length} 个项目`),!0}catch(m){return console.error("批量操作失败:",m),F(`${i.label}操作失败`,"error"),!1}finally{u.value=!1,t.value=0}}}}function Ze(u){const t=ie({items:[],loading:!1,error:null,total:0,currentPage:1,pageSize:20,sortBy:null,sortOrder:"asc",filters:{},...u}),n=g=>{t.loading=g,g&&(t.error=null)},i=g=>{t.error=g,t.loading=!1},a=(g,r)=>{t.items=g,t.total=r??g.length,t.loading=!1,t.error=null},c=g=>{t.sortBy===g?t.sortOrder=t.sortOrder==="asc"?"desc":"asc":(t.sortBy=g,t.sortOrder="asc")},v=g=>{t.filters={...t.filters,...g},t.currentPage=1},C=()=>{t.filters={},t.currentPage=1},m=g=>{t.currentPage=g},h=g=>{t.pageSize=g,t.currentPage=1},k=()=>{},S=_(()=>t.items.length>0),s=_(()=>!t.loading&&t.items.length===0),y=_(()=>Math.ceil(t.total/t.pageSize)),A=_(()=>t.currentPage<y.value);return{state:t,setLoading:n,setError:i,setData:a,updateSort:c,updateFilters:v,clearFilters:C,updatePage:m,updatePageSize:h,refresh:k,hasData:S,isEmpty:s,totalPages:y,hasMore:A}}function nt(u,t){const n=Qe(),i=Xe(),a=Ze(u);return{...n,...i,...a,onDataChange:c=>{n.updateSelectAllStateWithTotal(c.length)},refreshWithClearSelection:()=>{n.clearSelection()},virtualScrolling:null,visibleItems:_(()=>[]),scrollToItem:()=>{},scrollToIndex:()=>{},onVisibleItemsChange:()=>{}}}const at={quotes:{view:{key:"view",label:"查看详情",icon:"eye",type:"default"},edit:{key:"edit",label:"修改",icon:"compose",type:"default"},approve:{key:"approve",label:"审批通过",icon:"checkmarkempty",type:"primary"},reject:{key:"reject",label:"驳回",icon:"close",type:"warning"}},products:{view:{key:"view",label:"查看",icon:"eye",type:"default"},edit:{key:"edit",label:"编辑",icon:"compose",type:"default"},images:{key:"images",label:"图片管理",icon:"image",type:"default"},delete:{key:"delete",label:"删除",icon:"trash",type:"danger",requiresConfirmation:!0}},customers:{view:{key:"view",label:"查看",icon:"eye",type:"default"},export:{key:"export",label:"导出",icon:"download",type:"default"}}},rt={quotes:[{key:"export",label:"导出选中",icon:"download",type:"default"},{key:"delete",label:"批量删除",icon:"trash",type:"danger",requiresConfirmation:!0},{key:"approve",label:"批量审批",icon:"checkmarkempty",type:"primary"}],products:[{key:"export",label:"导出选中",icon:"download",type:"default"},{key:"delete",label:"批量删除",icon:"trash",type:"danger",requiresConfirmation:!0}],customers:[{key:"export",label:"导出选中",icon:"download",type:"default"}]};export{ot as B,lt as D,st as T,at as a,rt as c,nt as u};
