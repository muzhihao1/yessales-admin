const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.standard-DHpxIVC0.js","assets/index-CIRSQFo7.css"])))=>i.map(i=>d[i]);
import{_ as Z,H as ee,r as n,i as y}from"./index.standard-DHpxIVC0.js";async function T(){var o;try{const{ApiService:u}=await Z(async()=>{const{ApiService:s}=await import("./index.standard-DHpxIVC0.js").then(l=>l.$);return{ApiService:s}},__vite__mapDeps([0,1])),d=await u.healthCheck();return d.success&&((o=d.data)==null?void 0:o.status)==="healthy"?(console.log("✅ API健康检查通过"),!0):(console.warn("⚠️ API健康检查失败:",d),!1)}catch(u){return console.error("❌ API健康检查异常:",u),!1}}const ne=Object.freeze(Object.defineProperty({__proto__:null,checkApiHealth:T},Symbol.toStringTag,{value:"Module"})),ae=ee("app",()=>{const o=n(!0),u=n(!0),d=n(null),s=n(!1),l=n(new Set),h=n("加载中..."),S=n(null),p=n([]),r=n({autoSave:!0,offlineMode:!1,notificationsEnabled:!0,cacheEnabled:!0,debugMode:!1,pageSize:20}),v=n([]),C=n(!1),w=n(""),I=n(""),f=n([]),i=n([]),g=n(!1),k=n(null),x=n({platform:"",version:"",brand:"",model:"",screenWidth:0,screenHeight:0,pixelRatio:1,statusBarHeight:0,navigationBarHeight:0}),E=y(()=>l.value.size>0||s.value),H=y(()=>f.value.filter(e=>!e.read)),R=y(()=>H.value.length>0),z=y(()=>!o.value||r.value.offlineMode),L=y(()=>i.value.length>0);function A(e){const t=!o.value;o.value=e,d.value=new Date,e&&t?(c({type:"success",title:"网络已连接",message:"正在同步离线数据..."}),b()):e||c({type:"warning",title:"网络已断开",message:"应用将以离线模式运行",persistent:!0})}async function _(){try{const e=uni.getNetworkType();if(e&&A(e.networkType!=="none"),o.value){const t=await T();u.value=t,t||c({type:"warning",title:"API服务异常",message:"部分功能可能受限"})}}catch(e){console.error("Network check failed:",e),u.value=!1}}function $(e,t){e?l.value.add(e):s.value=!0,t&&(h.value=t)}function B(e){e?l.value.delete(e):s.value=!1,l.value.size===0&&!s.value&&(h.value="加载中...")}function j(){s.value=!1,l.value.clear(),h.value="加载中..."}function N(e){const t={...e,timestamp:new Date};S.value=t,p.value.unshift(t),p.value.length>50&&(p.value=p.value.slice(0,50)),c({type:"error",title:"系统错误",message:e.message,persistent:!0})}function F(){S.value=null}function W(e){r.value={...r.value,...e},uni.setStorageSync("app_settings",r.value),D()}function D(){console.log("✅ 应用设置已更新")}function M(){try{const e=uni.getStorageSync("app_settings");e&&(r.value={...r.value,...e},D())}catch(e){console.error("Failed to load settings:",e)}}function c(e){const t=`notification_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={id:t,...e,timestamp:new Date,read:!1};f.value.unshift(a),e.persistent||setTimeout(()=>{O(t)},3e3),r.value.notificationsEnabled&&uni.showToast({title:e.title,icon:e.type==="success"?"success":"none",duration:e.persistent?5e3:2e3})}function G(e){const t=f.value.find(a=>a.id===e);t&&(t.read=!0)}function O(e){const t=f.value.findIndex(a=>a.id===e);t>-1&&f.value.splice(t,1)}function U(){f.value=[]}function V(e){const t=e.id||`modal_${Date.now()}`;return v.value.push({id:t,component:e.component,props:e.props,options:e.options}),t}function q(e){if(e){const t=v.value.findIndex(a=>a.id===e);t>-1&&v.value.splice(t,1)}else v.value.pop()}function J(){v.value=[]}function K(e){const t=`sync_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;i.value.push({id:t,...e,timestamp:new Date,retryCount:0}),o.value&&!g.value&&b()}async function b(){if(!(g.value||i.value.length===0)){g.value=!0;try{const e=[...i.value];for(const t of e)try{const a=i.value.findIndex(m=>m.id===t.id);a>-1&&i.value.splice(a,1)}catch{if(t.retryCount++,t.retryCount>3){const m=i.value.findIndex(Y=>Y.id===t.id);m>-1&&i.value.splice(m,1),c({type:"error",title:"数据同步失败",message:`操作 ${t.action} 同步失败，已跳过`})}}k.value=new Date,i.value.length===0&&c({type:"success",title:"数据同步完成",message:"所有离线数据已同步"})}catch(e){console.error("Sync failed:",e),c({type:"error",title:"同步异常",message:"数据同步过程中发生错误"})}finally{g.value=!1}}}function P(){try{const e=uni.getSystemInfoSync();x.value={platform:e.platform||"",version:e.system||"",brand:e.brand||"",model:e.model||"",screenWidth:e.screenWidth||0,screenHeight:e.screenHeight||0,pixelRatio:e.pixelRatio||1,statusBarHeight:e.statusBarHeight||0,navigationBarHeight:44}}catch(e){console.error("Failed to get system info:",e)}}function Q(e){I.value=w.value,w.value=e}async function X(){try{M(),P(),await _(),uni.onNetworkStatusChange(e=>{A(e.isConnected)}),setInterval(()=>{o.value&&_()},3e4),console.log("✅ App store initialized")}catch(e){console.error("❌ App initialization failed:",e),N({code:"INIT_FAILED",message:"应用初始化失败",details:e})}}return{isOnline:o,apiHealthy:u,lastNetworkCheck:d,globalLoading:s,loadingTasks:l,loadingMessage:h,globalError:S,errorHistory:p,settings:r,modalStack:v,sidebarCollapsed:C,currentRoute:w,previousRoute:I,notifications:f,pendingSyncActions:i,syncInProgress:g,lastSyncTime:k,systemInfo:x,hasActiveLoading:E,unreadNotifications:H,hasUnreadNotifications:R,isOfflineMode:z,hasPendingSync:L,setOnlineStatus:A,checkNetworkStatus:_,startLoading:$,stopLoading:B,clearAllLoading:j,setGlobalError:N,clearGlobalError:F,updateSettings:W,loadSettings:M,showNotification:c,markNotificationAsRead:G,removeNotification:O,clearAllNotifications:U,openModal:V,closeModal:q,closeAllModals:J,addPendingSync:K,syncOfflineData:b,updateSystemInfo:P,setCurrentRoute:Q,initializeApp:X}});export{ne as i,ae as u};
