import{d as E,i as k,c as l,n as y,a as t,b as d,A as F,t as o,g as i,O as X,r as w,o as Z,E as tt,j as x,G as et,F as V,f as N,k as M,y as j,v as st,x as ot,u as at}from"./index.standard-DHpxIVC0.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const it={class:"card-content"},nt={class:"data-wrapper"},ct={class:"value-section"},ut={class:"value"},rt={key:0,class:"unit"},dt={class:"label"},vt={key:0,class:"trend-wrapper"},_t={class:"trend-arrow"},ft={class:"trend-value"},mt={key:0,class:"trend-label"},pt={key:0,class:"card-loading"},wt=E({__name:"StatCard",props:{label:{},value:{},icon:{default:"📊"},unit:{},theme:{default:"default"},iconColor:{},iconBgColor:{},trend:{},trendLabel:{},showTrend:{type:Boolean,default:!0},clickable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},prefix:{},suffix:{},decimal:{default:0},thousandSeparator:{type:Boolean,default:!0}},emits:["click"],setup(D,{emit:$}){const n=D,s=$,b={primary:{color:"#2563eb",bgColor:"#eff6ff"},success:{color:"#22c55e",bgColor:"#f0fdf4"},warning:{color:"#f59e0b",bgColor:"#fffbeb"},danger:{color:"#ef4444",bgColor:"#fef2f2"},info:{color:"#6366f1",bgColor:"#eef2ff"},default:{color:"#6b7280",bgColor:"#f3f4f6"}},_=k(()=>{if(typeof n.value=="string")return n.value;let c=n.value;n.decimal>0&&(c=Number(c.toFixed(n.decimal)));let r=c.toString();if(n.thousandSeparator){const h=r.split(".");h[0]=h[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),r=h.join(".")}return n.prefix&&(r=n.prefix+r),n.suffix&&(r=r+n.suffix),r}),v=k(()=>n.trend===void 0||n.trend===0?"neutral":n.trend>0?"up":"down"),f=k(()=>v.value==="up"?"↑":v.value==="down"?"↓":"→"),m=k(()=>n.iconColor||b[n.theme].color),p=k(()=>n.iconBgColor||b[n.theme].bgColor),C=()=>{n.clickable&&!n.loading&&s("click")};return(c,r)=>(i(),l("view",{class:y(["stat-card",`stat-card-${c.theme}`,{clickable:c.clickable}]),onClick:C},[r[1]||(r[1]=t("view",{class:"card-bg-decoration"},null,-1)),t("view",it,[t("view",{class:"icon-wrapper",style:F({backgroundColor:p.value})},[t("text",{class:"icon",style:F({color:m.value})},o(c.icon),5)],4),t("view",nt,[t("view",ct,[t("text",ut,o(_.value),1),c.unit?(i(),l("text",rt,o(c.unit),1)):d("",!0)]),t("text",dt,o(c.label),1)]),c.showTrend&&c.trend!==void 0?(i(),l("view",vt,[t("view",{class:y(["trend-indicator",v.value])},[t("text",_t,o(f.value),1),t("text",ft,o(Math.abs(c.trend))+"%",1)],2),c.trendLabel?(i(),l("text",mt,o(c.trendLabel),1)):d("",!0)])):d("",!0)]),c.loading?(i(),l("view",pt,r[0]||(r[0]=[t("view",{class:"loading-overlay"},null,-1),t("view",{class:"loading-spinner"},null,-1)]))):d("",!0)],2))}}),q=lt(wt,[["__scopeId","data-v-c69e991c"]]),xt={class:"customer-detail-page"},bt={key:0,class:"loading-container"},ht={key:1,class:"error-container"},gt={class:"error-text"},yt={key:2,class:"customer-content"},Ct={class:"detail-header"},kt={class:"header-info"},$t={class:"customer-name"},St={class:"customer-badges"},qt={class:"detail-section"},Mt={class:"info-grid"},Dt={class:"info-item"},Tt={class:"info-value"},Bt={class:"info-item"},Lt={class:"info-value"},At={class:"info-item"},It={class:"info-value"},Ft={class:"info-item"},Vt={class:"info-value"},Nt={key:0,class:"info-item"},jt={class:"info-value"},Et={key:1,class:"info-item"},Ot={class:"info-value"},Qt={class:"info-item"},zt={class:"info-value"},Rt={class:"info-item"},Ut={class:"info-value"},Yt={class:"info-item full-width"},Gt={class:"info-value"},Ht={class:"detail-section"},Jt={class:"stats-grid"},Kt={key:0,class:"detail-section"},Pt={class:"info-grid"},Wt={class:"info-item"},Xt={class:"info-value"},Zt={class:"info-item"},te={class:"info-value"},ee={key:1,class:"detail-section"},se={class:"notes-content"},oe={class:"detail-section"},ae={class:"section-header"},le={class:"section-count"},ie={key:0,class:"quotes-list"},ne=["onClick"],ce={class:"quote-main"},ue={class:"quote-number"},re={class:"quote-amount"},de={class:"quote-details"},ve={class:"quote-items"},_e={class:"quote-date"},fe={key:1,class:"empty-state"},me={class:"detail-section"},pe={class:"section-header"},we={class:"section-count"},xe={key:0,class:"activities-list"},be={class:"activity-icon"},he={class:"activity-content"},ge={class:"activity-description"},ye={class:"activity-date"},Ce={key:0,class:"activity-user"},ke={key:1,class:"empty-state"},$e={class:"detail-section"},Se={class:"timeline"},qe={class:"timeline-item"},Me={class:"timeline-content"},De={class:"timeline-date"},Te={class:"timeline-user"},Be={key:0,class:"timeline-item"},Le={class:"timeline-content"},Ae={class:"timeline-date"},Ie={class:"timeline-user"},Fe={key:1,class:"timeline-item"},Ve={class:"timeline-content"},Ne={class:"timeline-date"},je={class:"contact-form"},Ee={class:"form-item"},Oe={class:"form-picker"},Qe={class:"form-item"},ze={class:"form-item"},Re={class:"form-picker"},He=E({__name:"detail",setup(D){const $=tt();at();const n=X(),s=w(null),b=w(!1),_=w(""),v=w(!1),f=w(0),m=w(""),p=w(""),C=[{value:"contact_made",label:"电话联系"},{value:"quote_created",label:"报价沟通"},{value:"customer_updated",label:"信息更新"}];Z(()=>{const a=$.query.id;a?c(a):_.value="客户ID不存在"});async function c(a){const e=a||$.query.id;if(!e){_.value="客户ID不存在";return}b.value=!0,_.value="";try{const g=await n.fetchCustomerById(e,!0,!0);s.value=g}catch(g){_.value="加载客户信息失败，请重试",console.error("Failed to load customer:",g)}finally{b.value=!1}}function r(){s.value&&uni.navigateTo({url:`/pages/admin/customers/edit?id=${s.value.id}`})}function h(){s.value&&uni.navigateTo({url:`/pages/admin/quotes/edit?customer_id=${s.value.id}`})}function O(a){uni.navigateTo({url:`/pages/admin/quotes/detail?id=${a.id}`})}function Q(){f.value=0,m.value="",p.value=new Date().toISOString().split("T")[0],v.value=!0}function z(a){f.value=a.detail.value}function R(a){p.value=a.detail.value}async function U(){if(!s.value||!m.value){uni.showToast({title:"请填写活动描述",icon:"none"});return}try{const a=C[f.value].value;await n.addCustomerActivity(s.value.id,{type:a,description:m.value,metadata:{contact_date:p.value}}),uni.showToast({title:"活动记录成功",icon:"success"}),v.value=!1,c()}catch{uni.showToast({title:"记录活动失败",icon:"none"})}}function Y(){v.value=!1}function T(a){return a.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function B(a){const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function S(a){const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function G(a){return{individual:"个人客户",business:"企业客户"}[a]||a}function H(a){return{active:"活跃",inactive:"停用",potential:"潜在客户",blacklist:"黑名单"}[a]||a}function L(a){return{walk_in:"到店咨询",referral:"朋友推荐",online:"网络咨询",phone:"电话咨询",exhibition:"展会",other:"其他"}[a]||a}function J(a){return{phone:"电话",wechat:"微信",email:"邮件"}[a]||a}function K(a){return{draft:"草稿",submitted:"待审批",approved:"已批准",rejected:"已拒绝"}[a]||a}function P(a){return{quote_created:"📝",quote_approved:"✅",quote_rejected:"❌",customer_updated:"✏️",contact_made:"📞"}[a]||"📋"}return(a,e)=>{var A,I;const g=j("picker"),W=j("modal");return i(),l("view",xt,[b.value?(i(),l("view",bt,e[2]||(e[2]=[t("text",{class:"loading-text"},"加载中...",-1)]))):_.value?(i(),l("view",ht,[t("text",gt,o(_.value),1),t("button",{class:"retry-btn",onClick:c},"重试")])):s.value?(i(),l("view",yt,[t("view",Ct,[t("view",kt,[t("text",$t,o(et(n).getCustomerDisplayName(s.value)),1),t("view",St,[t("view",{class:y(["type-badge",`type-${s.value.customer_type}`])},[t("text",null,o(G(s.value.customer_type)),1)],2),t("view",{class:y(["status-badge",`status-${s.value.status}`])},[t("text",null,o(H(s.value.status)),1)],2),t("view",{class:y(["source-badge",`source-${s.value.source}`])},[t("text",null,o(L(s.value.source)),1)],2)])]),t("view",{class:"header-actions"},[t("button",{class:"action-btn action-edit",onClick:r},"编辑客户"),t("button",{class:"action-btn action-quote",onClick:h},"新建报价"),t("button",{class:"action-btn action-contact",onClick:Q},"记录联系")])]),t("view",qt,[e[12]||(e[12]=t("text",{class:"section-title"},"基本信息",-1)),t("view",Mt,[t("view",Dt,[e[3]||(e[3]=t("text",{class:"info-label"},"客户姓名",-1)),t("text",Tt,o(s.value.name),1)]),t("view",Bt,[e[4]||(e[4]=t("text",{class:"info-label"},"联系电话",-1)),t("text",Lt,o(s.value.phone),1)]),t("view",At,[e[5]||(e[5]=t("text",{class:"info-label"},"电子邮箱",-1)),t("text",It,o(s.value.email||"-"),1)]),t("view",Ft,[e[6]||(e[6]=t("text",{class:"info-label"},"微信号",-1)),t("text",Vt,o(s.value.wechat_id||"-"),1)]),s.value.customer_type==="business"?(i(),l("view",Nt,[e[7]||(e[7]=t("text",{class:"info-label"},"公司名称",-1)),t("text",jt,o(s.value.company||"-"),1)])):d("",!0),s.value.customer_type==="business"?(i(),l("view",Et,[e[8]||(e[8]=t("text",{class:"info-label"},"营业执照",-1)),t("text",Ot,o(s.value.business_license||"-"),1)])):d("",!0),t("view",Qt,[e[9]||(e[9]=t("text",{class:"info-label"},"所在城市",-1)),t("text",zt,o(s.value.city||"-"),1)]),t("view",Rt,[e[10]||(e[10]=t("text",{class:"info-label"},"所在区域",-1)),t("text",Ut,o(s.value.district||"-"),1)]),t("view",Yt,[e[11]||(e[11]=t("text",{class:"info-label"},"详细地址",-1)),t("text",Gt,o(s.value.address||"-"),1)])])]),t("view",Ht,[e[13]||(e[13]=t("text",{class:"section-title"},"业务统计",-1)),t("view",Jt,[x(q,{title:"总报价数",value:s.value.total_quotes||0,icon:"📄",theme:"primary"},null,8,["value"]),x(q,{title:"成交金额",value:T(s.value.total_amount||0),icon:"💰",theme:"success"},null,8,["value"]),x(q,{title:"最后报价",value:s.value.last_quote_at?B(s.value.last_quote_at):"无记录",icon:"📅",theme:"info"},null,8,["value"]),x(q,{title:"客户来源",value:L(s.value.source),icon:"📍",theme:"default"},null,8,["value"])])]),s.value.preferred_contact_method?(i(),l("view",Kt,[e[16]||(e[16]=t("text",{class:"section-title"},"联系偏好",-1)),t("view",Pt,[t("view",Wt,[e[14]||(e[14]=t("text",{class:"info-label"},"偏好联系方式",-1)),t("text",Xt,o(J(s.value.preferred_contact_method)),1)]),t("view",Zt,[e[15]||(e[15]=t("text",{class:"info-label"},"联系时间偏好",-1)),t("text",te,o(s.value.contact_time_preference||"-"),1)])])])):d("",!0),s.value.notes?(i(),l("view",ee,[e[17]||(e[17]=t("text",{class:"section-title"},"备注信息",-1)),t("text",se,o(s.value.notes),1)])):d("",!0),t("view",oe,[t("view",ae,[e[18]||(e[18]=t("text",{class:"section-title"},"报价历史",-1)),t("text",le,"("+o(((A=s.value.quotes)==null?void 0:A.length)||0)+")",1)]),s.value.quotes&&s.value.quotes.length>0?(i(),l("view",ie,[(i(!0),l(V,null,N(s.value.quotes,u=>(i(),l("view",{key:u.id,class:"quote-item",onClick:Ue=>O(u)},[t("view",ce,[t("text",ue,o(u.quote_number),1),t("text",re,"¥"+o(T(u.total_amount)),1)]),t("view",de,[t("text",ve,o(u.items_count)+" 个产品",1),t("text",_e,o(B(u.created_at)),1)]),t("view",{class:y(["quote-status",`status-${u.status}`])},[t("text",null,o(K(u.status)),1)],2)],8,ne))),128))])):(i(),l("view",fe,[e[19]||(e[19]=t("text",{class:"empty-text"},"暂无报价记录",-1)),t("button",{class:"empty-action",onClick:h},"创建第一个报价")]))]),t("view",me,[t("view",pe,[e[20]||(e[20]=t("text",{class:"section-title"},"最近活动",-1)),t("text",we,"("+o(((I=s.value.recent_activities)==null?void 0:I.length)||0)+")",1)]),s.value.recent_activities&&s.value.recent_activities.length>0?(i(),l("view",xe,[(i(!0),l(V,null,N(s.value.recent_activities,u=>(i(),l("view",{key:u.id,class:"activity-item"},[t("view",be,[t("text",null,o(P(u.type)),1)]),t("view",he,[t("text",ge,o(u.description),1),t("text",ye,o(S(u.created_at)),1),u.created_by?(i(),l("text",Ce," 操作人: "+o(u.created_by||"系统"),1)):d("",!0)])]))),128))])):(i(),l("view",ke,e[21]||(e[21]=[t("text",{class:"empty-text"},"暂无活动记录",-1)])))]),t("view",$e,[e[28]||(e[28]=t("text",{class:"section-title"},"客户时间线",-1)),t("view",Se,[t("view",qe,[e[23]||(e[23]=t("view",{class:"timeline-dot"},null,-1)),t("view",Me,[e[22]||(e[22]=t("text",{class:"timeline-title"},"客户创建",-1)),t("text",De,o(S(s.value.created_at)),1),t("text",Te,"创建人: "+o(s.value.created_by_name||"系统"),1)])]),s.value.updated_at!==s.value.created_at?(i(),l("view",Be,[e[25]||(e[25]=t("view",{class:"timeline-dot timeline-dot-info"},null,-1)),t("view",Le,[e[24]||(e[24]=t("text",{class:"timeline-title"},"信息更新",-1)),t("text",Ae,o(S(s.value.updated_at)),1),t("text",Ie,"更新人: "+o(s.value.updated_by_name||"系统"),1)])])):d("",!0),s.value.last_quote_at?(i(),l("view",Fe,[e[27]||(e[27]=t("view",{class:"timeline-dot timeline-dot-success"},null,-1)),t("view",Ve,[e[26]||(e[26]=t("text",{class:"timeline-title"},"最后报价",-1)),t("text",Ne,o(S(s.value.last_quote_at)),1)])])):d("",!0)])])])):d("",!0),x(W,{visible:v.value,"onUpdate:visible":e[1]||(e[1]=u=>v.value=u),title:"记录联系活动",onConfirm:U,onCancel:Y},{default:M(()=>[t("view",je,[t("view",Ee,[e[30]||(e[30]=t("text",{class:"form-label"},"活动类型",-1)),x(g,{mode:"selector",range:C,"range-key":"label",value:f.value,onChange:z},{default:M(()=>[t("view",Oe,[t("text",null,o(C[f.value].label),1),e[29]||(e[29]=t("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])]),t("view",Qe,[e[31]||(e[31]=t("text",{class:"form-label"},"活动描述",-1)),st(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=u=>m.value=u),class:"form-textarea",placeholder:"请输入联系内容和结果...",maxlength:"500"},null,512),[[ot,m.value]])]),t("view",ze,[e[33]||(e[33]=t("text",{class:"form-label"},"联系时间",-1)),x(g,{mode:"date",value:p.value,onChange:R},{default:M(()=>[t("view",Re,[t("text",null,o(p.value||"选择日期"),1),e[32]||(e[32]=t("text",{class:"picker-arrow"},"▼",-1))])]),_:1},8,["value"])])])]),_:1},8,["visible"])])}}});export{He as default};
